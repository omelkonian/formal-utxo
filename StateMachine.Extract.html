<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>StateMachine.Extract</title><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css'/><style>.github-fork-ribbon:before { background-color: #333; }</style><link rel="stylesheet" href="css/Agda.css"></head><body><a class='github-fork-ribbon'href='https://github.com/omelkonian/formal-utxo/tree/master/StateMachine/Extract.agda'data-ribbon='Source code on Github' title='Source code on Github'>Source code on Github</a><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Data.Nat.Induction.html" class="Module">Data.Nat.Induction</a> <a id="32" class="Keyword">using</a> <a id="38" class="Symbol">(</a><a id="39" href="Data.Nat.Induction.html#2311" class="Function">&lt;-wellFounded</a><a id="52" class="Symbol">)</a>
<a id="54" class="Keyword">open</a> <a id="59" class="Keyword">import</a> <a id="66" href="Data.List.Membership.Propositional.Properties.html" class="Module">Data.List.Membership.Propositional.Properties</a> <a id="112" class="Keyword">using</a> <a id="118" class="Symbol">(</a><a id="119" href="Data.List.Membership.Propositional.Properties.html#8500" class="Function">∈-filter⁺</a><a id="128" class="Symbol">)</a>

<a id="131" class="Keyword">open</a> <a id="136" class="Keyword">import</a> <a id="143" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="156" class="Keyword">open</a> <a id="161" class="Keyword">import</a> <a id="168" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="184" class="Keyword">open</a> <a id="189" class="Keyword">import</a> <a id="196" href="Prelude.Maybes.html" class="Module">Prelude.Maybes</a>
<a id="211" class="Keyword">open</a> <a id="216" class="Keyword">import</a> <a id="223" href="Prelude.Lists.html" class="Module">Prelude.Lists</a>
<a id="237" class="Keyword">open</a> <a id="242" class="Keyword">import</a> <a id="249" href="Prelude.Lists.Postulates.html" class="Module">Prelude.Lists.Postulates</a>
<a id="274" class="Comment">-- open import Prelude.Membership</a>
<a id="308" class="Keyword">open</a> <a id="313" href="Prelude.Init.html#7133" class="Module">L.Mem</a>
<a id="319" class="Keyword">open</a> <a id="324" class="Keyword">import</a> <a id="331" href="Prelude.Nats.Postulates.html" class="Module">Prelude.Nats.Postulates</a>
<a id="355" class="Keyword">open</a> <a id="360" class="Keyword">import</a> <a id="367" href="Prelude.Ord.html" class="Module">Prelude.Ord</a>

<a id="380" class="Keyword">open</a> <a id="385" class="Keyword">import</a> <a id="392" href="UTxO.Hashing.html" class="Module">UTxO.Hashing</a>
<a id="405" class="Keyword">open</a> <a id="410" class="Keyword">import</a> <a id="417" href="UTxO.Value.html" class="Module">UTxO.Value</a>
<a id="428" class="Keyword">open</a> <a id="433" class="Keyword">import</a> <a id="440" href="UTxO.Types.html" class="Module">UTxO.Types</a> <a id="451" class="Keyword">hiding</a> <a id="458" class="Symbol">(</a><a id="459" href="UTxO.Types.html#925" class="InductiveConstructor">I</a><a id="460" class="Symbol">)</a>
<a id="462" class="Keyword">open</a> <a id="467" class="Keyword">import</a> <a id="474" href="UTxO.TxUtilities.html" class="Module">UTxO.TxUtilities</a>
<a id="491" class="Keyword">open</a> <a id="496" class="Keyword">import</a> <a id="503" href="UTxO.Validity.html" class="Module">UTxO.Validity</a>
<a id="517" class="Keyword">open</a> <a id="522" class="Keyword">import</a> <a id="529" href="UTxO.GlobalPreservation.html" class="Module">UTxO.GlobalPreservation</a>
<a id="553" class="Keyword">open</a> <a id="558" class="Keyword">import</a> <a id="565" href="StateMachine.Base.html" class="Module">StateMachine.Base</a> <a id="583" class="Keyword">hiding</a> <a id="590" class="Symbol">(</a><a id="591" href="StateMachine.Base.html#2155" class="Field">origin</a><a id="597" class="Symbol">)</a>

<a id="600" class="Keyword">module</a> <a id="607" href="StateMachine.Extract.html" class="Module">StateMachine.Extract</a>
  <a id="630" class="Symbol">{</a><a id="631" href="StateMachine.Extract.html#631" class="Bound">S</a> <a id="633" href="StateMachine.Extract.html#633" class="Bound">I</a> <a id="635" class="Symbol">:</a> <a id="637" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="640" class="Symbol">}</a> <a id="642" class="Symbol">{{</a><a id="644" href="StateMachine.Extract.html#644" class="Bound">_</a> <a id="646" class="Symbol">:</a> <a id="648" href="UTxO.Types.html#1155" class="Record">IsData</a> <a id="655" href="StateMachine.Extract.html#631" class="Bound">S</a><a id="656" class="Symbol">}}</a> <a id="659" class="Symbol">{{</a><a id="661" href="StateMachine.Extract.html#661" class="Bound">_</a> <a id="663" class="Symbol">:</a> <a id="665" href="UTxO.Types.html#1155" class="Record">IsData</a> <a id="672" href="StateMachine.Extract.html#633" class="Bound">I</a><a id="673" class="Symbol">}}</a> <a id="676" class="Symbol">{</a><a id="677" href="StateMachine.Extract.html#677" class="Bound">sm</a> <a id="680" class="Symbol">:</a> <a id="682" href="StateMachine.Base.html#1973" class="Record">StateMachine</a> <a id="695" href="StateMachine.Extract.html#631" class="Bound">S</a> <a id="697" href="StateMachine.Extract.html#633" class="Bound">I</a><a id="698" class="Symbol">}</a>
  <a id="702" class="Symbol">{</a><a id="703" href="StateMachine.Extract.html#703" class="Bound">L</a> <a id="705" class="Symbol">:</a> <a id="707" href="Data.Product.html#1378" class="Function">∃</a> <a id="709" href="UTxO.Validity.html#2261" class="Datatype">ValidLedger</a><a id="720" class="Symbol">}</a> <a id="722" class="Symbol">{</a><a id="723" href="StateMachine.Extract.html#723" class="Bound">jo</a> <a id="726" class="Symbol">:</a> <a id="728" href="Data.Maybe.html#810" class="Function">Is-just</a> <a id="736" class="Symbol">(</a><a id="737" href="StateMachine.Base.html#2155" class="Field">StateMachine.origin</a> <a id="757" href="StateMachine.Extract.html#677" class="Bound">sm</a><a id="759" class="Symbol">)}</a>
  <a id="764" class="Keyword">where</a>

<a id="771" class="Keyword">open</a> <a id="776" href="StateMachine.Base.html#2219" class="Module">CEM</a> <a id="780" class="Symbol">{</a><a id="781" class="Argument">sm</a> <a id="784" class="Symbol">=</a> <a id="786" href="StateMachine.Extract.html#677" class="Bound">sm</a><a id="788" class="Symbol">}</a>
<a id="790" class="Keyword">open</a> <a id="795" class="Keyword">import</a> <a id="802" href="StateMachine.Properties.html" class="Module">StateMachine.Properties</a> <a id="826" class="Symbol">{</a><a id="827" class="Argument">sm</a> <a id="830" class="Symbol">=</a> <a id="832" href="StateMachine.Extract.html#677" class="Bound">sm</a><a id="834" class="Symbol">}</a>
<a id="836" class="Keyword">open</a> <a id="841" class="Keyword">import</a> <a id="848" href="StateMachine.Inductive.html" class="Module">StateMachine.Inductive</a> <a id="871" class="Symbol">{</a><a id="872" class="Argument">sm</a> <a id="875" class="Symbol">=</a> <a id="877" href="StateMachine.Extract.html#677" class="Bound">sm</a><a id="879" class="Symbol">}</a>

<a id="882" class="Keyword">open</a> <a id="887" href="UTxO.Value.html#5940" class="Module">FocusTokenClass</a> <a id="903" href="StateMachine.Base.html#3143" class="Function">nftₛₘ</a>
<a id="909" class="Keyword">open</a> <a id="914" class="Keyword">import</a> <a id="921" href="UTxO.TokenProvenance.html" class="Module">UTxO.TokenProvenance</a> <a id="942" href="StateMachine.Base.html#3143" class="Function">nftₛₘ</a>
<a id="948" class="Keyword">open</a> <a id="953" class="Keyword">import</a> <a id="960" href="UTxO.TokenProvenanceNF.html" class="Module">UTxO.TokenProvenanceNF</a> <a id="983" href="StateMachine.Base.html#3143" class="Function">nftₛₘ</a>
<a id="989" class="Keyword">open</a> <a id="994" class="Keyword">import</a> <a id="1001" href="StateMachine.Initiality.html" class="Module">StateMachine.Initiality</a> <a id="1025" class="Symbol">{</a><a id="1026" class="Argument">sm</a> <a id="1029" class="Symbol">=</a> <a id="1031" href="StateMachine.Extract.html#677" class="Bound">sm</a><a id="1033" class="Symbol">}</a>

<a id="1036" class="Keyword">private</a>
  <a id="1046" class="Keyword">variable</a>
    <a id="1059" href="StateMachine.Extract.html#1059" class="Generalizable">tx</a> <a id="1062" class="Symbol">:</a> <a id="1064" href="UTxO.Types.html#7568" class="Record">Tx</a>
    <a id="1071" href="StateMachine.Extract.html#1071" class="Generalizable">n</a>  <a id="1074" class="Symbol">:</a> <a id="1076" href="UTxO.Value.html#506" class="Function">Quantity</a>

<a id="outputs◆"></a><a id="1086" href="StateMachine.Extract.html#1086" class="Function">outputs◆</a> <a id="1095" class="Symbol">:</a> <a id="1097" href="UTxO.Types.html#7568" class="Record">Tx</a> <a id="1100" class="Symbol">→</a> <a id="1102" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="1107" href="UTxO.Types.html#4814" class="Record">TxOutput</a>
<a id="1116" href="StateMachine.Extract.html#1086" class="Function">outputs◆</a> <a id="1125" class="Symbol">=</a> <a id="1127" href="Data.List.Base.html#8101" class="Function">filter</a> <a id="1134" class="Symbol">(</a><a id="1135" href="UTxO.Value.html#6073" class="Function Operator">◆∈?_</a> <a id="1140" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1142" href="UTxO.Types.html#4906" class="Field">value</a><a id="1147" class="Symbol">)</a> <a id="1149" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1151" href="UTxO.Types.html#7700" class="Field">outputs</a>

<a id="ams-outputs◆"></a><a id="1160" href="StateMachine.Extract.html#1160" class="Function">ams-outputs◆</a> <a id="1173" class="Symbol">:</a> <a id="1175" class="Symbol">∀</a> <a id="1177" class="Symbol">{</a><a id="1178" href="StateMachine.Extract.html#1178" class="Bound">tx</a><a id="1180" class="Symbol">}</a>
  <a id="1184" class="Symbol">→</a> <a id="1186" href="StateMachine.Extract.html#1178" class="Bound">tx</a> <a id="1189" href="UTxO.Validity.html#4108" class="Function Operator">∈′</a> <a id="1192" href="StateMachine.Extract.html#703" class="Bound">L</a>
  <a id="1196" class="Symbol">→</a> <a id="1198" href="Prelude.Lists.Singletons.html#2208" class="Function">AtMostSingleton</a> <a id="1214" class="Symbol">(</a><a id="1215" href="StateMachine.Extract.html#1086" class="Function">outputs◆</a> <a id="1224" href="StateMachine.Extract.html#1178" class="Bound">tx</a><a id="1226" class="Symbol">)</a>
<a id="1228" href="StateMachine.Extract.html#1160" class="Function">ams-outputs◆</a> <a id="1241" class="Symbol">{</a><a id="1242" href="StateMachine.Extract.html#1242" class="Bound">tx</a><a id="1244" class="Symbol">}</a> <a id="1246" href="StateMachine.Extract.html#1246" class="Bound">tx∈</a>
  <a id="1252" class="Keyword">with</a> <a id="1257" href="StateMachine.Extract.html#1257" class="Bound">l′</a> <a id="1260" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1262" href="StateMachine.Extract.html#1262" class="Bound">l≺</a>  ← <a id="1268" href="Prelude.Lists.html#1536" class="Function">∈⇒Suffix</a> <a id="1277" href="StateMachine.Extract.html#1246" class="Bound">tx∈</a>
  <a id="1283" class="Symbol">=</a> <a id="1285" href="StateMachine.Extract.html#1839" class="Function">qed</a>
  <a id="1291" class="Keyword">where</a>
    <a id="1301" class="Keyword">open</a> <a id="1306" href="Data.Nat.Properties.html#12487" class="Module">≤-Reasoning</a>

    <a id="1323" href="StateMachine.Extract.html#1323" class="Function">l</a>  <a id="1326" class="Symbol">=</a> <a id="1328" href="StateMachine.Extract.html#1242" class="Bound">tx</a> <a id="1331" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="1333" href="StateMachine.Extract.html#1257" class="Bound">l′</a>
    <a id="1340" href="StateMachine.Extract.html#1340" class="Function">vl</a> <a id="1343" class="Symbol">=</a> <a id="1345" href="UTxO.Validity.html#5268" class="Function">≼⇒valid</a> <a id="1353" class="Symbol">(</a><a id="1354" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1360" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="1361" class="Symbol">)</a> <a id="1363" href="StateMachine.Extract.html#1262" class="Bound">l≺</a>

    <a id="1371" href="StateMachine.Extract.html#1371" class="Function">∑forge≤1</a> <a id="1380" class="Symbol">:</a> <a id="1382" href="UTxO.Validity.html#10557" class="Function">NonFungible</a> <a id="1394" class="Symbol">(_</a> <a id="1397" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1399" href="StateMachine.Extract.html#1340" class="Function">vl</a><a id="1401" class="Symbol">)</a> <a id="1403" href="StateMachine.Base.html#3143" class="Function">nftₛₘ</a>
    <a id="1413" href="StateMachine.Extract.html#1371" class="Function">∑forge≤1</a> <a id="1422" class="Symbol">=</a> <a id="1424" href="StateMachine.Base.html#8811" class="Function">JustOrigin.nf</a> <a id="1438" href="StateMachine.Extract.html#723" class="Bound">jo</a> <a id="1441" class="Symbol">(_</a> <a id="1444" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1446" href="StateMachine.Extract.html#1340" class="Function">vl</a><a id="1448" class="Symbol">)</a>

    <a id="1455" href="StateMachine.Extract.html#1455" class="Function">∑≥ᶜ</a> <a id="1459" class="Symbol">:</a> <a id="1461" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="1463" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="1465" href="UTxO.Value.html#2582" class="Function">∑</a> <a id="1467" href="StateMachine.Extract.html#1323" class="Function">l</a> <a id="1469" href="UTxO.Types.html#7735" class="Field">forge</a> <a id="1475" href="UTxO.Value.html#2341" class="Function Operator">≥ᶜ</a> <a id="1478" href="UTxO.Value.html#2582" class="Function">∑</a> <a id="1480" class="Symbol">(</a><a id="1481" href="UTxO.Types.html#7700" class="Field">outputs</a> <a id="1489" href="StateMachine.Extract.html#1242" class="Bound">tx</a><a id="1491" class="Symbol">)</a> <a id="1493" href="UTxO.Types.html#4906" class="Field">value</a>
    <a id="1503" href="StateMachine.Extract.html#1455" class="Function">∑≥ᶜ</a> <a id="1507" class="Keyword">rewrite</a> <a id="1515" href="UTxO.GlobalPreservation.html#730" class="Function">globalPreservation</a> <a id="1534" class="Symbol">{</a><a id="1535" class="Argument">vl</a> <a id="1538" class="Symbol">=</a> <a id="1540" href="StateMachine.Extract.html#1340" class="Function">vl</a><a id="1542" class="Symbol">}</a> <a id="1544" class="Symbol">=</a> <a id="1546" href="UTxO.TxUtilities.html#1400" class="Function">∑utxo≥∑out</a> <a id="1557" href="StateMachine.Extract.html#1242" class="Bound">tx</a> <a id="1560" href="StateMachine.Extract.html#1257" class="Bound">l′</a>

    <a id="1568" href="StateMachine.Extract.html#1568" class="Function">∑≥</a> <a id="1571" class="Symbol">:</a> <a id="1573" href="UTxO.Value.html#2582" class="Function">∑</a> <a id="1575" href="StateMachine.Extract.html#1323" class="Function">l</a> <a id="1577" href="UTxO.Types.html#7735" class="Field">forge</a> <a id="1583" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="1585" href="Prelude.Ord.Core.html#289" class="Function Operator">≥</a> <a id="1587" href="UTxO.Value.html#2582" class="Function">∑</a> <a id="1589" class="Symbol">(</a><a id="1590" href="StateMachine.Extract.html#1086" class="Function">outputs◆</a> <a id="1599" href="StateMachine.Extract.html#1242" class="Bound">tx</a><a id="1601" class="Symbol">)</a> <a id="1603" href="UTxO.Types.html#4906" class="Field">value</a> <a id="1609" href="UTxO.Value.html#5983" class="Function Operator">◆</a>
    <a id="1615" href="StateMachine.Extract.html#1568" class="Function">∑≥</a> <a id="1618" class="Symbol">=</a> <a id="1620" href="Relation.Binary.Reasoning.Base.Triple.html#3019" class="Function Operator">begin</a> <a id="1626" href="UTxO.Value.html#2582" class="Function">∑</a> <a id="1628" class="Symbol">(</a><a id="1629" href="StateMachine.Extract.html#1086" class="Function">outputs◆</a> <a id="1638" href="StateMachine.Extract.html#1242" class="Bound">tx</a><a id="1640" class="Symbol">)</a> <a id="1642" href="UTxO.Types.html#4906" class="Field">value</a> <a id="1648" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="1650" href="Relation.Binary.Reasoning.Base.Triple.html#4527" class="Function">≡⟨</a> <a id="1653" href="UTxO.Value.html#7094" class="Function">∑-filter-◆</a> <a id="1664" class="Symbol">{</a><a id="1665" class="Argument">xs</a> <a id="1668" class="Symbol">=</a> <a id="1670" href="UTxO.Types.html#7700" class="Field">outputs</a> <a id="1678" href="StateMachine.Extract.html#1242" class="Bound">tx</a><a id="1680" class="Symbol">}</a> <a id="1682" class="Symbol">{</a><a id="1683" class="Argument">fv</a> <a id="1686" class="Symbol">=</a> <a id="1688" href="UTxO.Types.html#4906" class="Field">value</a><a id="1693" class="Symbol">}</a> <a id="1695" href="Relation.Binary.Reasoning.Base.Triple.html#4527" class="Function">⟩</a>
               <a id="1712" href="UTxO.Value.html#2582" class="Function">∑</a> <a id="1714" class="Symbol">(</a><a id="1715" href="UTxO.Types.html#7700" class="Field">outputs</a> <a id="1723" href="StateMachine.Extract.html#1242" class="Bound">tx</a><a id="1725" class="Symbol">)</a> <a id="1727" href="UTxO.Types.html#4906" class="Field">value</a> <a id="1733" href="UTxO.Value.html#5983" class="Function Operator">◆</a>  <a id="1736" href="Relation.Binary.Reasoning.Base.Triple.html#3754" class="Function">≤⟨</a> <a id="1739" href="UTxO.Value.html#6208" class="Function">≥ᶜ-◆</a> <a id="1744" class="Symbol">{</a><a id="1745" class="Argument">x</a> <a id="1747" class="Symbol">=</a> <a id="1749" href="UTxO.Value.html#2582" class="Function">∑</a> <a id="1751" href="StateMachine.Extract.html#1323" class="Function">l</a> <a id="1753" href="UTxO.Types.html#7735" class="Field">forge</a><a id="1758" class="Symbol">}</a> <a id="1760" class="Symbol">{</a><a id="1761" class="Argument">y</a> <a id="1763" class="Symbol">=</a> <a id="1765" href="UTxO.Value.html#2582" class="Function">∑</a> <a id="1767" class="Symbol">(</a><a id="1768" href="UTxO.Types.html#7700" class="Field">outputs</a> <a id="1776" href="StateMachine.Extract.html#1242" class="Bound">tx</a><a id="1778" class="Symbol">)</a> <a id="1780" href="UTxO.Types.html#4906" class="Field">value</a><a id="1785" class="Symbol">}</a> <a id="1787" href="StateMachine.Extract.html#1455" class="Function">∑≥ᶜ</a> <a id="1791" href="Relation.Binary.Reasoning.Base.Triple.html#3754" class="Function">⟩</a>
               <a id="1808" href="UTxO.Value.html#2582" class="Function">∑</a> <a id="1810" href="StateMachine.Extract.html#1323" class="Function">l</a> <a id="1812" href="UTxO.Types.html#7735" class="Field">forge</a> <a id="1818" href="UTxO.Value.html#5983" class="Function Operator">◆</a>             <a id="1832" href="Relation.Binary.Reasoning.Base.Triple.html#5128" class="Function Operator">∎</a>

    <a id="1839" href="StateMachine.Extract.html#1839" class="Function">qed</a> <a id="1843" class="Symbol">:</a> <a id="1845" href="Prelude.Lists.Singletons.html#2208" class="Function">AtMostSingleton</a> <a id="1861" class="Symbol">(</a><a id="1862" href="StateMachine.Extract.html#1086" class="Function">outputs◆</a> <a id="1871" href="StateMachine.Extract.html#1242" class="Bound">tx</a><a id="1873" class="Symbol">)</a>
    <a id="1879" href="StateMachine.Extract.html#1839" class="Function">qed</a> <a id="1883" class="Keyword">with</a> <a id="1888" href="StateMachine.Extract.html#1086" class="Function">outputs◆</a> <a id="1897" href="StateMachine.Extract.html#1242" class="Bound">tx</a> <a id="1900" class="Symbol">|</a> <a id="1902" href="Data.List.Relation.Unary.All.Properties.html#21572" class="Function">L.All.all-filter</a> <a id="1919" class="Symbol">(</a><a id="1920" href="UTxO.Value.html#6073" class="Function Operator">◆∈?_</a> <a id="1925" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1927" href="UTxO.Types.html#4906" class="Field">value</a><a id="1932" class="Symbol">)</a> <a id="1934" class="Symbol">(</a><a id="1935" href="UTxO.Types.html#7700" class="Field">outputs</a> <a id="1943" href="StateMachine.Extract.html#1242" class="Bound">tx</a><a id="1945" class="Symbol">)</a> <a id="1947" class="Symbol">|</a> <a id="1949" href="StateMachine.Extract.html#1568" class="Function">∑≥</a>
    <a id="1956" href="StateMachine.Extract.html#1839" class="Function">...</a> <a id="1960" class="Symbol">|</a> <a id="1962" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>         <a id="1973" class="Symbol">|</a> <a id="1975" href="Data.List.Relation.Unary.All.html#1516" class="InductiveConstructor">[]</a>            <a id="1989" class="Symbol">|</a> <a id="1991" class="Symbol">_</a>   <a id="1995" class="Symbol">=</a> <a id="1997" href="Agda.Builtin.Unit.html#195" class="InductiveConstructor">tt</a>
    <a id="2004" href="StateMachine.Extract.html#1839" class="Function">...</a> <a id="2008" class="Symbol">|</a> <a id="2010" class="Symbol">_</a> <a id="2012" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2014" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>     <a id="2021" class="Symbol">|</a> <a id="2023" class="Symbol">_</a> <a id="2025" href="Data.List.Relation.Unary.All.html#1533" class="InductiveConstructor Operator">∷</a> <a id="2027" class="Symbol">_</a>         <a id="2037" class="Symbol">|</a> <a id="2039" class="Symbol">_</a>   <a id="2043" class="Symbol">=</a> <a id="2045" href="Agda.Builtin.Unit.html#195" class="InductiveConstructor">tt</a>
    <a id="2052" href="StateMachine.Extract.html#1839" class="Function">...</a> <a id="2056" class="Symbol">|</a> <a id="2058" href="StateMachine.Extract.html#2058" class="Bound">x</a> <a id="2060" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2062" href="StateMachine.Extract.html#2062" class="Bound">y</a> <a id="2064" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2066" href="StateMachine.Extract.html#2066" class="Bound">os</a> <a id="2069" class="Symbol">|</a> <a id="2071" href="StateMachine.Extract.html#2071" class="Bound">◆∈x</a> <a id="2075" href="Data.List.Relation.Unary.All.html#1533" class="InductiveConstructor Operator">∷</a> <a id="2077" href="StateMachine.Extract.html#2077" class="Bound">◆∈y</a> <a id="2081" href="Data.List.Relation.Unary.All.html#1533" class="InductiveConstructor Operator">∷</a> <a id="2083" class="Symbol">_</a> <a id="2085" class="Symbol">|</a> <a id="2087" href="StateMachine.Extract.html#2087" class="Bound">∑≥′</a> <a id="2091" class="Symbol">=</a> <a id="2093" href="Data.Empty.html#637" class="Function">⊥-elim</a> <a id="2100" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="2102" href="Prelude.Nats.Postulates.html#564" class="Postulate">¬i≥x+y</a> <a id="2109" href="StateMachine.Extract.html#1371" class="Function">∑forge≤1</a> <a id="2118" href="StateMachine.Extract.html#2071" class="Bound">◆∈x</a> <a id="2122" href="StateMachine.Extract.html#2077" class="Bound">◆∈y</a> <a id="2126" href="StateMachine.Extract.html#2387" class="Function">i≥x+y</a>
      <a id="2138" class="Keyword">where</a>
        <a id="2152" href="StateMachine.Extract.html#2152" class="Function">⊆-helper</a> <a id="2161" class="Symbol">:</a> <a id="2163" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2169" href="StateMachine.Extract.html#2058" class="Bound">x</a> <a id="2171" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="2173" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2175" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2181" href="StateMachine.Extract.html#2062" class="Bound">y</a> <a id="2183" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="2185" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2187" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="2190" href="Data.List.Relation.Binary.Subset.Setoid.html#748" class="Function Operator">⊆</a> <a id="2192" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2198" href="StateMachine.Extract.html#2058" class="Bound">x</a> <a id="2200" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="2202" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2204" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2210" href="StateMachine.Extract.html#2062" class="Bound">y</a> <a id="2212" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="2214" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2216" href="Data.List.Base.html#1553" class="Function">map</a> <a id="2220" class="Symbol">(</a><a id="2221" href="UTxO.Value.html#5983" class="Function Operator">_◆</a> <a id="2224" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2226" href="UTxO.Types.html#4906" class="Field">value</a><a id="2231" class="Symbol">)</a> <a id="2233" href="StateMachine.Extract.html#2066" class="Bound">os</a>
        <a id="2244" href="StateMachine.Extract.html#2152" class="Function">⊆-helper</a> <a id="2253" class="Symbol">(</a><a id="2254" href="Data.List.Relation.Unary.Any.html#1228" class="InductiveConstructor">here</a> <a id="2259" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a><a id="2263" class="Symbol">)</a>         <a id="2273" class="Symbol">=</a> <a id="2275" href="Data.List.Relation.Unary.Any.html#1228" class="InductiveConstructor">here</a> <a id="2280" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>
        <a id="2293" href="StateMachine.Extract.html#2152" class="Function">⊆-helper</a> <a id="2302" class="Symbol">(</a><a id="2303" href="Data.List.Relation.Unary.Any.html#1281" class="InductiveConstructor">there</a> <a id="2309" class="Symbol">(</a><a id="2310" href="Data.List.Relation.Unary.Any.html#1228" class="InductiveConstructor">here</a> <a id="2315" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a><a id="2319" class="Symbol">))</a> <a id="2322" class="Symbol">=</a> <a id="2324" href="Data.List.Relation.Unary.Any.html#1281" class="InductiveConstructor">there</a> <a id="2330" class="Symbol">(</a><a id="2331" href="Data.List.Relation.Unary.Any.html#1228" class="InductiveConstructor">here</a> <a id="2336" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a><a id="2340" class="Symbol">)</a>
        <a id="2350" href="StateMachine.Extract.html#2152" class="Function">⊆-helper</a> <a id="2359" class="Symbol">(</a><a id="2360" href="Data.List.Relation.Unary.Any.html#1281" class="InductiveConstructor">there</a> <a id="2366" class="Symbol">(</a><a id="2367" href="Data.List.Relation.Unary.Any.html#1281" class="InductiveConstructor">there</a> <a id="2373" class="Symbol">()))</a>

        <a id="2387" href="StateMachine.Extract.html#2387" class="Function">i≥x+y</a> <a id="2393" class="Symbol">:</a> <a id="2395" href="UTxO.Value.html#2582" class="Function">∑</a> <a id="2397" href="StateMachine.Extract.html#1323" class="Function">l</a> <a id="2399" href="UTxO.Types.html#7735" class="Field">forge</a> <a id="2405" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="2407" href="Prelude.Ord.Core.html#289" class="Function Operator">≥</a> <a id="2409" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2415" href="StateMachine.Extract.html#2058" class="Bound">x</a> <a id="2417" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="2419" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">+</a> <a id="2421" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2427" href="StateMachine.Extract.html#2062" class="Bound">y</a> <a id="2429" href="UTxO.Value.html#5983" class="Function Operator">◆</a>
        <a id="2439" href="StateMachine.Extract.html#2387" class="Function">i≥x+y</a> <a id="2445" class="Symbol">=</a>
          <a id="2457" href="Relation.Binary.Reasoning.Base.Triple.html#3019" class="Function Operator">begin</a>
            <a id="2475" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2481" href="StateMachine.Extract.html#2058" class="Bound">x</a> <a id="2483" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="2485" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">+</a> <a id="2487" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2493" href="StateMachine.Extract.html#2062" class="Bound">y</a> <a id="2495" href="UTxO.Value.html#5983" class="Function Operator">◆</a>
          <a id="2507" href="Relation.Binary.Reasoning.Base.Triple.html#4527" class="Function">≡⟨</a> <a id="2510" href="Relation.Binary.PropositionalEquality.Core.html#1139" class="Function">cong</a> <a id="2515" class="Symbol">(</a><a id="2516" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2522" href="StateMachine.Extract.html#2058" class="Bound">x</a> <a id="2524" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="2526" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">+_</a><a id="2528" class="Symbol">)</a> <a id="2530" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="2532" href="Relation.Binary.PropositionalEquality.Core.html#1693" class="Function">sym</a> <a id="2536" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="2538" href="Data.Nat.Properties.html#13227" class="Function">Nat.+-identityʳ</a> <a id="2554" class="Symbol">(</a><a id="2555" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2561" href="StateMachine.Extract.html#2062" class="Bound">y</a> <a id="2563" href="UTxO.Value.html#5983" class="Function Operator">◆</a><a id="2564" class="Symbol">)</a> <a id="2566" href="Relation.Binary.Reasoning.Base.Triple.html#4527" class="Function">⟩</a>
            <a id="2580" href="Prelude.Lists.Sums.html#295" class="Function">∑ℕ</a> <a id="2583" class="Symbol">(</a><a id="2584" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2590" href="StateMachine.Extract.html#2058" class="Bound">x</a> <a id="2592" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="2594" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2596" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2602" href="StateMachine.Extract.html#2062" class="Bound">y</a> <a id="2604" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="2606" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2608" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="2610" class="Symbol">)</a>
          <a id="2622" href="Relation.Binary.Reasoning.Base.Triple.html#3754" class="Function">≤⟨</a> <a id="2625" href="Prelude.Lists.Postulates.html#1609" class="Postulate">∑ℕ-⊆</a> <a id="2630" href="StateMachine.Extract.html#2152" class="Function">⊆-helper</a> <a id="2639" href="Relation.Binary.Reasoning.Base.Triple.html#3754" class="Function">⟩</a>
            <a id="2653" href="Prelude.Lists.Sums.html#295" class="Function">∑ℕ</a> <a id="2656" class="Symbol">(</a><a id="2657" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2663" href="StateMachine.Extract.html#2058" class="Bound">x</a> <a id="2665" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="2667" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2669" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2675" href="StateMachine.Extract.html#2062" class="Bound">y</a> <a id="2677" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="2679" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2681" href="Data.List.Base.html#1553" class="Function">map</a> <a id="2685" class="Symbol">(</a><a id="2686" href="UTxO.Value.html#5983" class="Function Operator">_◆</a> <a id="2689" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2691" href="UTxO.Types.html#4906" class="Field">value</a><a id="2696" class="Symbol">)</a> <a id="2698" href="StateMachine.Extract.html#2066" class="Bound">os</a><a id="2700" class="Symbol">)</a>
          <a id="2712" href="Relation.Binary.Reasoning.Base.Triple.html#4527" class="Function">≡⟨</a> <a id="2715" href="Relation.Binary.PropositionalEquality.Core.html#1693" class="Function">sym</a> <a id="2719" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="2721" href="UTxO.Value.html#6756" class="Function">∑-◆</a> <a id="2725" class="Symbol">{</a><a id="2726" class="Argument">xs</a> <a id="2729" class="Symbol">=</a> <a id="2731" href="StateMachine.Extract.html#2058" class="Bound">x</a> <a id="2733" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2735" href="StateMachine.Extract.html#2062" class="Bound">y</a> <a id="2737" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2739" href="StateMachine.Extract.html#2066" class="Bound">os</a><a id="2741" class="Symbol">}</a> <a id="2743" class="Symbol">{</a><a id="2744" class="Argument">f</a> <a id="2746" class="Symbol">=</a> <a id="2748" href="UTxO.Types.html#4906" class="Field">value</a><a id="2753" class="Symbol">}</a> <a id="2755" href="Relation.Binary.Reasoning.Base.Triple.html#4527" class="Function">⟩</a>
            <a id="2769" href="UTxO.Value.html#2582" class="Function">∑</a> <a id="2771" class="Symbol">(</a><a id="2772" href="StateMachine.Extract.html#2058" class="Bound">x</a> <a id="2774" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2776" href="StateMachine.Extract.html#2062" class="Bound">y</a> <a id="2778" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2780" href="StateMachine.Extract.html#2066" class="Bound">os</a><a id="2782" class="Symbol">)</a> <a id="2784" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2790" href="UTxO.Value.html#5983" class="Function Operator">◆</a>
          <a id="2802" href="Relation.Binary.Reasoning.Base.Triple.html#3754" class="Function">≤⟨</a> <a id="2805" href="StateMachine.Extract.html#2087" class="Bound">∑≥′</a> <a id="2809" href="Relation.Binary.Reasoning.Base.Triple.html#3754" class="Function">⟩</a>
            <a id="2823" href="UTxO.Value.html#2582" class="Function">∑</a> <a id="2825" href="StateMachine.Extract.html#1323" class="Function">l</a> <a id="2827" href="UTxO.Types.html#7735" class="Field">forge</a> <a id="2833" href="UTxO.Value.html#5983" class="Function Operator">◆</a>
          <a id="2845" href="Relation.Binary.Reasoning.Base.Triple.html#5128" class="Function Operator">∎</a>

<a id="2848" class="Keyword">data</a> <a id="X¹"></a><a id="2853" href="StateMachine.Extract.html#2853" class="Datatype">X¹</a> <a id="2856" class="Symbol">:</a> <a id="2858" href="UTxO.Types.html#7568" class="Record">Tx</a> <a id="2861" class="Symbol">→</a> <a id="2863" href="UTxO.Types.html#7568" class="Record">Tx</a> <a id="2866" class="Symbol">→</a> <a id="2868" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2872" class="Keyword">where</a>

  <a id="X¹.root"></a><a id="2881" href="StateMachine.Extract.html#2881" class="InductiveConstructor">root</a> <a id="2886" class="Symbol">:</a>

      <a id="2895" class="Symbol">(</a><a id="2896" href="StateMachine.Extract.html#2896" class="Bound">tx</a> <a id="2899" class="Symbol">:</a> <a id="2901" href="UTxO.Types.html#7568" class="Record">Tx</a><a id="2903" class="Symbol">)</a>
    <a id="2909" class="Symbol">→</a> <a id="2911" class="Symbol">(</a><a id="2912" href="StateMachine.Extract.html#2912" class="Bound">tx∈</a> <a id="2916" class="Symbol">:</a> <a id="2918" href="StateMachine.Extract.html#2896" class="Bound">tx</a> <a id="2921" href="UTxO.Validity.html#4108" class="Function Operator">∈′</a> <a id="2924" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="2925" class="Symbol">)</a>
    <a id="2931" class="Symbol">→</a> <a id="2933" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="2935" class="Symbol">(</a><a id="2936" href="StateMachine.Base.html#2583" class="Function">policyₛₘ</a> <a id="2945" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="2947" class="Keyword">record</a> <a id="2954" class="Symbol">{</a><a id="2955" href="UTxO.Types.html#5388" class="Field">thisTx</a> <a id="2962" class="Symbol">=</a> <a id="2964" href="StateMachine.Base.html#3044" class="Function">ℂ</a><a id="2965" class="Symbol">;</a> <a id="2967" href="UTxO.Types.html#5368" class="Field">txInfo</a> <a id="2974" class="Symbol">=</a> <a id="2976" href="UTxO.TxUtilities.html#5856" class="Function">mkTxInfo</a> <a id="2985" class="Symbol">(</a><a id="2986" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="2992" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="2994" href="Prelude.Lists.html#1536" class="Function">∈⇒Suffix</a> <a id="3003" href="StateMachine.Extract.html#2912" class="Bound">tx∈</a><a id="3006" class="Symbol">)</a> <a id="3008" href="StateMachine.Extract.html#2896" class="Bound">tx</a><a id="3010" class="Symbol">})</a>
      <a id="3019" class="Comment">-----------------------------------------------------------------------------</a>
    <a id="3101" class="Symbol">→</a> <a id="3103" href="StateMachine.Extract.html#2853" class="Datatype">X¹</a> <a id="3106" href="StateMachine.Extract.html#2896" class="Bound">tx</a> <a id="3109" href="StateMachine.Extract.html#2896" class="Bound">tx</a>

  <a id="X¹.cons"></a><a id="3115" href="StateMachine.Extract.html#3115" class="InductiveConstructor">cons</a> <a id="3120" class="Symbol">:</a> <a id="3122" class="Symbol">∀</a> <a id="3124" class="Symbol">{</a><a id="3125" href="StateMachine.Extract.html#3125" class="Bound">tx</a> <a id="3128" href="StateMachine.Extract.html#3128" class="Bound">tx′</a> <a id="3132" href="StateMachine.Extract.html#3132" class="Bound">tx″</a><a id="3135" class="Symbol">}</a>

    <a id="3142" class="Symbol">→</a> <a id="3144" href="StateMachine.Extract.html#2853" class="Datatype">X¹</a> <a id="3147" href="StateMachine.Extract.html#3125" class="Bound">tx</a> <a id="3150" href="StateMachine.Extract.html#3128" class="Bound">tx′</a>
    <a id="3158" class="Symbol">→</a> <a id="3160" href="StateMachine.Extract.html#3132" class="Bound">tx″</a> <a id="3164" href="UTxO.Validity.html#4108" class="Function Operator">∈′</a> <a id="3167" href="StateMachine.Extract.html#703" class="Bound">L</a>
    <a id="3173" class="Symbol">→</a> <a id="3175" href="StateMachine.Extract.html#3128" class="Bound">tx′</a> <a id="3179" href="UTxO.TokenProvenance.html#601" class="Function Operator">↝⟦</a> <a id="3182" class="Number">1</a> <a id="3184" href="UTxO.TokenProvenance.html#601" class="Function Operator">⟧</a> <a id="3186" href="StateMachine.Extract.html#3132" class="Bound">tx″</a>
      <a id="3196" class="Comment">--------------</a>
    <a id="3215" class="Symbol">→</a> <a id="3217" href="StateMachine.Extract.html#2853" class="Datatype">X¹</a> <a id="3220" href="StateMachine.Extract.html#3125" class="Bound">tx</a> <a id="3223" href="StateMachine.Extract.html#3132" class="Bound">tx″</a>

<a id="∣_∣ᵗ"></a><a id="3228" href="StateMachine.Extract.html#3228" class="Function Operator">∣_∣ᵗ</a> <a id="3233" class="Symbol">:</a> <a id="3235" href="UTxO.TokenProvenance.html#1293" class="Record">Trace</a> <a id="3241" href="StateMachine.Extract.html#703" class="Bound">L</a> <a id="3243" href="StateMachine.Extract.html#1059" class="Generalizable">tx</a> <a id="3246" href="StateMachine.Extract.html#1071" class="Generalizable">n</a> <a id="3248" class="Symbol">→</a> <a id="3250" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
<a id="3252" href="StateMachine.Extract.html#3228" class="Function Operator">∣_∣ᵗ</a> <a id="3257" class="Symbol">=</a> <a id="3259" href="Data.List.NonEmpty.Base.html#1381" class="Function">L.NE.length</a> <a id="3271" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="3273" href="UTxO.TokenProvenance.html#1350" class="Field">txs</a>

<a id="X→X¹"></a><a id="3278" href="StateMachine.Extract.html#3278" class="Function">X→X¹</a> <a id="3283" class="Symbol">:</a>
    <a id="3289" href="StateMachine.Extract.html#1071" class="Generalizable">n</a> <a id="3291" href="Prelude.Ord.Core.html#340" class="Function Operator">&gt;</a> <a id="3293" class="Number">0</a>
  <a id="3297" class="Symbol">→</a> <a id="3299" class="Symbol">(</a><a id="3300" href="StateMachine.Extract.html#3300" class="Bound">tr</a> <a id="3303" class="Symbol">:</a> <a id="3305" href="UTxO.TokenProvenance.html#1293" class="Record">Trace</a> <a id="3311" href="StateMachine.Extract.html#703" class="Bound">L</a> <a id="3313" href="StateMachine.Extract.html#1059" class="Generalizable">tx</a> <a id="3316" href="StateMachine.Extract.html#1071" class="Generalizable">n</a><a id="3317" class="Symbol">)</a>
  <a id="3321" class="Symbol">→</a> <a id="3323" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="3325" class="Symbol">(</a><a id="3326" href="StateMachine.Base.html#2583" class="Function">policyₛₘ</a> <a id="3335" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="3337" href="UTxO.TokenProvenance.html#8834" class="Function">mkPendingMPS</a> <a id="3350" class="Symbol">{</a><a id="3351" class="Argument">L</a> <a id="3353" class="Symbol">=</a> <a id="3355" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="3356" class="Symbol">}</a> <a id="3358" href="StateMachine.Extract.html#3300" class="Bound">tr</a> <a id="3361" href="StateMachine.Base.html#3044" class="Function">ℂ</a><a id="3362" class="Symbol">)</a>
    <a id="3368" class="Comment">-----------------------------------------</a>
  <a id="3412" class="Symbol">→</a> <a id="3414" href="StateMachine.Extract.html#2853" class="Datatype">X¹</a> <a id="3417" class="Symbol">(</a><a id="3418" href="UTxO.TokenProvenance.html#1624" class="Function">origin</a> <a id="3425" href="StateMachine.Extract.html#3300" class="Bound">tr</a><a id="3427" class="Symbol">)</a> <a id="3429" href="StateMachine.Extract.html#1059" class="Generalizable">tx</a>

<a id="3433" href="StateMachine.Extract.html#3278" class="Function">X→X¹</a> <a id="3438" class="Symbol">{</a><a id="3439" class="Argument">n</a> <a id="3441" class="Symbol">=</a> <a id="3443" href="StateMachine.Extract.html#3443" class="Bound">n</a><a id="3444" class="Symbol">}</a> <a id="3446" href="StateMachine.Extract.html#3446" class="Bound">n&gt;0</a> <a id="3450" href="StateMachine.Extract.html#3450" class="Bound">tr</a> <a id="3453" class="Symbol">=</a> <a id="3455" href="StateMachine.Extract.html#3606" class="Function">go</a> <a id="3458" href="StateMachine.Extract.html#3450" class="Bound">tr</a> <a id="3461" class="Symbol">(</a><a id="3462" href="Data.Nat.Induction.html#2311" class="Function">&lt;-wellFounded</a> <a id="3476" href="StateMachine.Extract.html#3228" class="Function Operator">∣</a> <a id="3478" href="StateMachine.Extract.html#3450" class="Bound">tr</a> <a id="3481" href="StateMachine.Extract.html#3228" class="Function Operator">∣ᵗ</a><a id="3483" class="Symbol">)</a>
  <a id="3487" class="Keyword">where</a>
    <a id="3497" class="Comment">-- NB: well-founded recursion used here, because Agda could not figure out tr′ is structurally smaller!!</a>
    <a id="3606" href="StateMachine.Extract.html#3606" class="Function">go</a> <a id="3609" class="Symbol">:</a> <a id="3611" class="Symbol">∀</a> <a id="3613" class="Symbol">(</a><a id="3614" href="StateMachine.Extract.html#3614" class="Bound">tr</a> <a id="3617" class="Symbol">:</a> <a id="3619" href="UTxO.TokenProvenance.html#1293" class="Record">Trace</a> <a id="3625" href="StateMachine.Extract.html#703" class="Bound">L</a> <a id="3627" href="StateMachine.Extract.html#1059" class="Generalizable">tx</a> <a id="3630" href="StateMachine.Extract.html#3443" class="Bound">n</a><a id="3631" class="Symbol">)</a> <a id="3633" class="Symbol">→</a> <a id="3635" href="Induction.WellFounded.html#1009" class="Datatype">Acc</a> <a id="3639" href="Prelude.Ord.Core.html#213" class="Field Operator">_&lt;_</a> <a id="3643" href="StateMachine.Extract.html#3228" class="Function Operator">∣</a> <a id="3645" href="StateMachine.Extract.html#3614" class="Bound">tr</a> <a id="3648" href="StateMachine.Extract.html#3228" class="Function Operator">∣ᵗ</a> <a id="3651" class="Symbol">→</a> <a id="3653" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="3655" class="Symbol">(</a><a id="3656" href="StateMachine.Base.html#2583" class="Function">policyₛₘ</a> <a id="3665" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="3667" href="UTxO.TokenProvenance.html#8834" class="Function">mkPendingMPS</a> <a id="3680" class="Symbol">{</a><a id="3681" class="Argument">L</a> <a id="3683" class="Symbol">=</a> <a id="3685" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="3686" class="Symbol">}</a> <a id="3688" href="StateMachine.Extract.html#3614" class="Bound">tr</a> <a id="3691" href="StateMachine.Base.html#3044" class="Function">ℂ</a><a id="3692" class="Symbol">)</a> <a id="3694" class="Symbol">→</a> <a id="3696" href="StateMachine.Extract.html#2853" class="Datatype">X¹</a> <a id="3699" class="Symbol">(</a><a id="3700" href="UTxO.TokenProvenance.html#1624" class="Function">origin</a> <a id="3707" href="StateMachine.Extract.html#3614" class="Bound">tr</a><a id="3709" class="Symbol">)</a> <a id="3711" href="StateMachine.Extract.html#1059" class="Generalizable">tx</a>
    <a id="3718" href="StateMachine.Extract.html#3606" class="Function">go</a> <a id="3721" class="Keyword">record</a> <a id="3728" class="Symbol">{</a><a id="3729" href="UTxO.TokenProvenance.html#1350" class="Field">txs</a> <a id="3733" class="Symbol">=</a> <a id="3735" href="StateMachine.Extract.html#3735" class="Bound">tx</a> <a id="3738" href="Data.List.NonEmpty.Base.html#1134" class="InductiveConstructor Operator">∷</a> <a id="3740" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="3742" class="Symbol">;</a> <a id="3744" href="UTxO.TokenProvenance.html#1372" class="Field">trace∈</a> <a id="3751" class="Symbol">=</a> <a id="3753" href="StateMachine.Extract.html#3753" class="Bound">tx∈</a> <a id="3757" href="Data.List.Relation.Unary.All.html#1533" class="InductiveConstructor Operator">∷</a> <a id="3759" href="Data.List.Relation.Unary.All.html#1516" class="InductiveConstructor">[]</a><a id="3761" class="Symbol">;</a> <a id="3763" href="UTxO.TokenProvenance.html#1402" class="Field">linked</a> <a id="3770" class="Symbol">=</a> <a id="3772" href="UTxO.TokenProvenance.html#874" class="InductiveConstructor">root</a> <a id="3777" class="DottedPattern Symbol">.</a><a id="3778" href="StateMachine.Extract.html#3735" class="DottedPattern Bound">tx</a> <a id="3781" class="Symbol">_;</a> <a id="3784" href="UTxO.TokenProvenance.html#1423" class="Field">head≡</a> <a id="3790" class="Symbol">=</a> <a id="3792" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a><a id="3796" class="Symbol">}</a> <a id="3798" class="Symbol">_</a> <a id="3800" href="StateMachine.Extract.html#3800" class="Bound">p≡</a>
      <a id="3809" class="Symbol">=</a> <a id="3811" href="StateMachine.Extract.html#2881" class="InductiveConstructor">root</a> <a id="3816" href="StateMachine.Extract.html#3735" class="Bound">tx</a> <a id="3819" href="StateMachine.Extract.html#3753" class="Bound">tx∈</a> <a id="3823" href="StateMachine.Extract.html#3800" class="Bound">p≡</a>
    <a id="3830" href="StateMachine.Extract.html#3606" class="Function">go</a> <a id="3833" class="Keyword">record</a> <a id="3840" class="Symbol">{</a><a id="3841" href="UTxO.TokenProvenance.html#1350" class="Field">txs</a> <a id="3845" class="Symbol">=</a> <a id="3847" href="StateMachine.Extract.html#3847" class="Bound">tx′</a> <a id="3851" href="Data.List.NonEmpty.Base.html#1134" class="InductiveConstructor Operator">∷</a> <a id="3853" class="Symbol">(</a><a id="3854" href="StateMachine.Extract.html#3854" class="Bound">tx</a> <a id="3857" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3859" href="StateMachine.Extract.html#3859" class="Bound">txs</a><a id="3862" class="Symbol">);</a> <a id="3865" href="UTxO.TokenProvenance.html#1372" class="Field">trace∈</a> <a id="3872" class="Symbol">=</a> <a id="3874" href="StateMachine.Extract.html#3874" class="Bound">tx∈</a> <a id="3878" href="Data.List.Relation.Unary.All.html#1533" class="InductiveConstructor Operator">∷</a> <a id="3880" href="StateMachine.Extract.html#3880" class="Bound">tr∈</a><a id="3883" class="Symbol">;</a> <a id="3885" href="UTxO.TokenProvenance.html#1402" class="Field">linked</a> <a id="3892" class="Symbol">=</a> <a id="3894" href="UTxO.TokenProvenance.html#964" class="InductiveConstructor">cons</a> <a id="3899" class="Symbol">{</a><a id="3900" href="StateMachine.Extract.html#3854" class="Bound">tx</a> <a id="3903" href="Data.List.NonEmpty.Base.html#1134" class="InductiveConstructor Operator">∷</a> <a id="3905" href="StateMachine.Extract.html#3859" class="Bound">txs</a><a id="3908" class="Symbol">}{</a><a id="3910" href="StateMachine.Extract.html#3847" class="Bound">tx′</a><a id="3913" class="Symbol">}</a> <a id="3915" href="StateMachine.Extract.html#3915" class="Bound">lnk</a> <a id="3919" href="StateMachine.Extract.html#3919" class="Bound">tx↝</a><a id="3922" class="Symbol">;</a> <a id="3924" href="UTxO.TokenProvenance.html#1423" class="Field">head≡</a> <a id="3930" class="Symbol">=</a> <a id="3932" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a><a id="3936" class="Symbol">}</a>
       <a id="3945" class="Symbol">(</a><a id="3946" href="Induction.WellFounded.html#1071" class="InductiveConstructor">acc</a> <a id="3950" href="StateMachine.Extract.html#3950" class="Bound">a</a><a id="3951" class="Symbol">)</a> <a id="3953" href="StateMachine.Extract.html#3953" class="Bound">p≡</a>
       <a id="3963" class="Keyword">rewrite</a> <a id="3971" href="Prelude.Lists.NonEmpty.html#1506" class="Function">last-∷</a> <a id="3978" class="Symbol">{</a><a id="3979" class="Argument">x</a> <a id="3981" class="Symbol">=</a> <a id="3983" href="StateMachine.Extract.html#3847" class="Bound">tx′</a><a id="3986" class="Symbol">}{</a><a id="3988" href="StateMachine.Extract.html#3854" class="Bound">tx</a> <a id="3991" href="Data.List.NonEmpty.Base.html#1134" class="InductiveConstructor Operator">∷</a> <a id="3993" href="StateMachine.Extract.html#3859" class="Bound">txs</a><a id="3996" class="Symbol">}</a>
       <a id="4005" class="Symbol">=</a> <a id="4007" href="StateMachine.Extract.html#3115" class="InductiveConstructor">cons</a> <a id="4012" class="Symbol">(</a><a id="4013" href="StateMachine.Extract.html#3606" class="Function">go</a> <a id="4016" href="StateMachine.Extract.html#4079" class="Function">tr′</a> <a id="4020" class="Symbol">(</a><a id="4021" href="StateMachine.Extract.html#3950" class="Bound">a</a> <a id="4023" class="Symbol">_</a> <a id="4025" class="Symbol">(</a><a id="4026" href="Data.Nat.Base.html#1609" class="InductiveConstructor">s≤s</a> <a id="4030" href="Prelude.Ord.Core.html#669" class="Field">≤-refl</a><a id="4036" class="Symbol">))</a> <a id="4039" href="StateMachine.Extract.html#3953" class="Bound">p≡</a><a id="4041" class="Symbol">)</a> <a id="4043" href="StateMachine.Extract.html#3874" class="Bound">tx∈</a> <a id="4047" href="StateMachine.Extract.html#4189" class="Function">tx↝⟦1⟧tx′</a>
       <a id="4064" class="Keyword">where</a>
         <a id="4079" href="StateMachine.Extract.html#4079" class="Function">tr′</a> <a id="4083" class="Symbol">:</a> <a id="4085" href="UTxO.TokenProvenance.html#1293" class="Record">Trace</a> <a id="4091" href="StateMachine.Extract.html#703" class="Bound">L</a> <a id="4093" href="StateMachine.Extract.html#3854" class="Bound">tx</a> <a id="4096" href="StateMachine.Extract.html#3443" class="Bound">n</a>
         <a id="4107" href="StateMachine.Extract.html#4079" class="Function">tr′</a> <a id="4111" class="Symbol">=</a> <a id="4113" class="Keyword">record</a> <a id="4120" class="Symbol">{</a><a id="4121" href="UTxO.TokenProvenance.html#1350" class="Field">txs</a> <a id="4125" class="Symbol">=</a> <a id="4127" href="StateMachine.Extract.html#3854" class="Bound">tx</a> <a id="4130" href="Data.List.NonEmpty.Base.html#1134" class="InductiveConstructor Operator">∷</a> <a id="4132" href="StateMachine.Extract.html#3859" class="Bound">txs</a><a id="4135" class="Symbol">;</a> <a id="4137" href="UTxO.TokenProvenance.html#1372" class="Field">trace∈</a> <a id="4144" class="Symbol">=</a> <a id="4146" href="StateMachine.Extract.html#3880" class="Bound">tr∈</a><a id="4149" class="Symbol">;</a> <a id="4151" href="UTxO.TokenProvenance.html#1402" class="Field">linked</a> <a id="4158" class="Symbol">=</a> <a id="4160" href="StateMachine.Extract.html#3915" class="Bound">lnk</a><a id="4163" class="Symbol">;</a> <a id="4165" href="UTxO.TokenProvenance.html#1423" class="Field">head≡</a> <a id="4171" class="Symbol">=</a> <a id="4173" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a><a id="4177" class="Symbol">}</a>

         <a id="4189" href="StateMachine.Extract.html#4189" class="Function">tx↝⟦1⟧tx′</a> <a id="4199" class="Symbol">:</a> <a id="4201" href="StateMachine.Extract.html#3854" class="Bound">tx</a> <a id="4204" href="UTxO.TokenProvenance.html#601" class="Function Operator">↝⟦</a> <a id="4207" class="Number">1</a> <a id="4209" href="UTxO.TokenProvenance.html#601" class="Function Operator">⟧</a> <a id="4211" href="StateMachine.Extract.html#3847" class="Bound">tx′</a>
         <a id="4224" href="StateMachine.Extract.html#4189" class="Function">tx↝⟦1⟧tx′</a> <a id="4234" class="Symbol">=</a> <a id="4236" href="UTxO.TokenProvenance.html#1723" class="Function">weaken-↝</a> <a id="4245" class="Symbol">{</a><a id="4246" class="Argument">tx</a> <a id="4249" class="Symbol">=</a> <a id="4251" href="StateMachine.Extract.html#3854" class="Bound">tx</a><a id="4253" class="Symbol">}{</a><a id="4255" href="StateMachine.Extract.html#3847" class="Bound">tx′</a><a id="4258" class="Symbol">}</a> <a id="4260" href="StateMachine.Extract.html#3919" class="Bound">tx↝</a> <a id="4264" href="StateMachine.Extract.html#3446" class="Bound">n&gt;0</a>

<a id="OutputsWith◆"></a><a id="4269" href="StateMachine.Extract.html#4269" class="Function">OutputsWith◆</a> <a id="4282" class="Symbol">:</a> <a id="4284" href="UTxO.Types.html#7568" class="Record">Tx</a> <a id="4287" class="Symbol">→</a> <a id="4289" href="StateMachine.Extract.html#631" class="Bound">S</a> <a id="4291" class="Symbol">→</a> <a id="4293" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="4297" href="StateMachine.Extract.html#4269" class="Function">OutputsWith◆</a> <a id="4310" href="StateMachine.Extract.html#4310" class="Bound">tx</a> <a id="4313" href="StateMachine.Extract.html#4313" class="Bound">s</a> <a id="4315" class="Symbol">=</a>
  <a id="4319" href="Data.Product.html#1378" class="Function">∃</a> <a id="4321" class="Symbol">λ</a> <a id="4323" href="StateMachine.Extract.html#4323" class="Bound">v</a> <a id="4325" class="Symbol">→</a> <a id="4327" href="StateMachine.Extract.html#1086" class="Function">outputs◆</a> <a id="4336" href="StateMachine.Extract.html#4310" class="Bound">tx</a> <a id="4339" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4341" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="4343" class="Keyword">record</a> <a id="4350" class="Symbol">{</a><a id="4351" href="UTxO.Types.html#4906" class="Field">value</a> <a id="4357" class="Symbol">=</a> <a id="4359" href="StateMachine.Extract.html#4323" class="Bound">v</a><a id="4360" class="Symbol">;</a> <a id="4362" href="UTxO.Types.html#4847" class="Field">address</a> <a id="4370" class="Symbol">=</a> <a id="4372" href="StateMachine.Base.html#3741" class="Function">𝕍</a><a id="4373" class="Symbol">;</a> <a id="4375" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="4385" class="Symbol">=</a> <a id="4387" href="UTxO.Types.html#1196" class="Field">toData</a> <a id="4394" href="StateMachine.Extract.html#4313" class="Bound">s</a> <a id="4396" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a><a id="4398" class="Symbol">}</a> <a id="4400" href="Data.List.Base.html#5034" class="Function Operator">]</a>

<a id="4403" class="Keyword">record</a> <a id="TxS"></a><a id="4410" href="StateMachine.Extract.html#4410" class="Record">TxS</a> <a id="4414" class="Symbol">(</a><a id="4415" href="StateMachine.Extract.html#4415" class="Bound">tx</a> <a id="4418" class="Symbol">:</a> <a id="4420" href="UTxO.Types.html#7568" class="Record">Tx</a><a id="4422" class="Symbol">)</a> <a id="4424" class="Symbol">(</a><a id="4425" href="StateMachine.Extract.html#4425" class="Bound">s</a> <a id="4427" class="Symbol">:</a> <a id="4429" href="StateMachine.Extract.html#631" class="Bound">S</a><a id="4430" class="Symbol">)</a> <a id="4432" class="Symbol">:</a> <a id="4434" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4438" class="Keyword">where</a>
  <a id="4446" class="Keyword">field</a>
    <a id="TxS.tx∈"></a><a id="4456" href="StateMachine.Extract.html#4456" class="Field">tx∈</a> <a id="4460" class="Symbol">:</a> <a id="4462" href="StateMachine.Extract.html#4415" class="Bound">tx</a> <a id="4465" href="UTxO.Validity.html#4108" class="Function Operator">∈′</a> <a id="4468" href="StateMachine.Extract.html#703" class="Bound">L</a>
    <a id="TxS.s∈"></a><a id="4474" href="StateMachine.Extract.html#4474" class="Field">s∈</a>  <a id="4478" class="Symbol">:</a> <a id="4480" href="StateMachine.Extract.html#4269" class="Function">OutputsWith◆</a> <a id="4493" href="StateMachine.Extract.html#4415" class="Bound">tx</a> <a id="4496" href="StateMachine.Extract.html#4425" class="Bound">s</a>

<a id="∃TxS"></a><a id="4499" href="StateMachine.Extract.html#4499" class="Function">∃TxS</a> <a id="4504" class="Symbol">=</a> <a id="4506" href="Data.Product.html#1378" class="Function">∃</a> <a id="4508" class="Symbol">λ</a> <a id="4510" href="StateMachine.Extract.html#4510" class="Bound">tx</a> <a id="4513" class="Symbol">→</a> <a id="4515" href="Data.Product.html#1378" class="Function">∃</a> <a id="4517" class="Symbol">λ</a> <a id="4519" href="StateMachine.Extract.html#4519" class="Bound">s</a> <a id="4521" class="Symbol">→</a> <a id="4523" href="StateMachine.Extract.html#4410" class="Record">TxS</a> <a id="4527" href="StateMachine.Extract.html#4510" class="Bound">tx</a> <a id="4530" href="StateMachine.Extract.html#4519" class="Bound">s</a>

<a id="h₀"></a><a id="4533" href="StateMachine.Extract.html#4533" class="Function">h₀</a> <a id="4536" class="Symbol">:</a> <a id="4538" class="Symbol">∀</a> <a id="4540" class="Symbol">{</a><a id="4541" href="StateMachine.Extract.html#4541" class="Bound">tx</a><a id="4543" class="Symbol">}</a>
  <a id="4547" class="Symbol">→</a> <a id="4549" class="Symbol">(</a><a id="4550" href="StateMachine.Extract.html#4550" class="Bound">tx∈</a> <a id="4554" class="Symbol">:</a> <a id="4556" href="StateMachine.Extract.html#4541" class="Bound">tx</a> <a id="4559" href="UTxO.Validity.html#4108" class="Function Operator">∈′</a> <a id="4562" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="4563" class="Symbol">)</a>
  <a id="4567" class="Symbol">→</a> <a id="4569" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="4571" class="Symbol">(</a><a id="4572" href="StateMachine.Base.html#2583" class="Function">policyₛₘ</a> <a id="4581" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="4583" class="Keyword">record</a> <a id="4590" class="Symbol">{</a><a id="4591" class="Field">thisTx</a> <a id="4598" class="Symbol">=</a> <a id="4600" href="StateMachine.Base.html#3044" class="Function">ℂ</a><a id="4601" class="Symbol">;</a> <a id="4603" class="Field">txInfo</a> <a id="4610" class="Symbol">=</a> <a id="4612" href="UTxO.TxUtilities.html#5856" class="Function">mkTxInfo</a> <a id="4621" class="Symbol">(</a><a id="4622" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="4628" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="4630" href="Prelude.Lists.html#1536" class="Function">∈⇒Suffix</a> <a id="4639" href="StateMachine.Extract.html#4550" class="Bound">tx∈</a><a id="4642" class="Symbol">)</a> <a id="4644" href="StateMachine.Extract.html#4541" class="Bound">tx</a><a id="4646" class="Symbol">})</a>
  <a id="4651" class="Symbol">→</a> <a id="4653" href="Data.Product.html#1378" class="Function">∃</a> <a id="4655" class="Symbol">λ</a> <a id="4657" href="StateMachine.Extract.html#4657" class="Bound">s</a> <a id="4659" class="Symbol">→</a> <a id="4661" href="StateMachine.Base.html#2377" class="Function">Init</a> <a id="4666" href="StateMachine.Extract.html#4657" class="Bound">s</a> <a id="4668" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="4670" href="StateMachine.Extract.html#4410" class="Record">TxS</a> <a id="4674" href="StateMachine.Extract.html#4541" class="Bound">tx</a> <a id="4677" href="StateMachine.Extract.html#4657" class="Bound">s</a>
<a id="4679" href="StateMachine.Extract.html#4533" class="Function">h₀</a> <a id="4682" class="Symbol">{</a><a id="4683" class="Argument">tx</a> <a id="4686" class="Symbol">=</a> <a id="4688" href="StateMachine.Extract.html#4688" class="Bound">tx</a><a id="4690" class="Symbol">}</a> <a id="4692" href="StateMachine.Extract.html#4692" class="Bound">tx∈</a> <a id="4696" href="StateMachine.Extract.html#4696" class="Bound">p≡</a>
  <a id="4701" class="Keyword">with</a> <a id="4706" href="StateMachine.Extract.html#4706" class="Bound">v</a> <a id="4708" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4710" href="StateMachine.Extract.html#4710" class="Bound">s</a> <a id="4712" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4714" class="Symbol">_</a> <a id="4716" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4718" href="StateMachine.Extract.html#4718" class="Bound">outs≡</a> <a id="4724" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4726" href="StateMachine.Extract.html#4726" class="Bound">init-s</a>
       ← <a id="4742" href="StateMachine.Base.html#4747" class="Function">Tpolicy⇒</a> <a id="4751" class="Symbol">{</a><a id="4752" class="Argument">tx</a> <a id="4755" class="Symbol">=</a> <a id="4757" href="StateMachine.Extract.html#4688" class="Bound">tx</a><a id="4759" class="Symbol">}</a> <a id="4761" class="Symbol">{</a><a id="4762" class="Argument">l</a> <a id="4764" class="Symbol">=</a> <a id="4766" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="4772" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="4774" href="Prelude.Lists.html#1536" class="Function">∈⇒Suffix</a> <a id="4783" href="StateMachine.Extract.html#4692" class="Bound">tx∈</a><a id="4786" class="Symbol">}</a> <a id="4788" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a> <a id="4793" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a> <a id="4798" href="StateMachine.Extract.html#4696" class="Bound">p≡</a>
  <a id="4803" class="Symbol">=</a> <a id="4805" href="StateMachine.Extract.html#4710" class="Bound">s</a> <a id="4807" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4809" href="StateMachine.Extract.html#4726" class="Bound">init-s</a> <a id="4816" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4818" class="Keyword">record</a> <a id="4825" class="Symbol">{</a><a id="4826" href="StateMachine.Extract.html#4456" class="Field">tx∈</a> <a id="4830" class="Symbol">=</a> <a id="4832" href="StateMachine.Extract.html#4692" class="Bound">tx∈</a><a id="4835" class="Symbol">;</a> <a id="4837" href="StateMachine.Extract.html#4474" class="Field">s∈</a> <a id="4840" class="Symbol">=</a> <a id="4842" href="StateMachine.Extract.html#4706" class="Bound">v</a> <a id="4844" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4846" href="StateMachine.Extract.html#4718" class="Bound">outs≡</a><a id="4851" class="Symbol">}</a>

<a id="hh"></a><a id="4854" href="StateMachine.Extract.html#4854" class="Function">hh</a> <a id="4857" class="Symbol">:</a> <a id="4859" class="Symbol">∀</a> <a id="4861" class="Symbol">{</a><a id="4862" href="StateMachine.Extract.html#4862" class="Bound">tx</a> <a id="4865" href="StateMachine.Extract.html#4865" class="Bound">tx′</a><a id="4868" class="Symbol">}</a>
  <a id="4872" class="Symbol">→</a> <a id="4874" href="StateMachine.Extract.html#4862" class="Bound">tx</a> <a id="4877" href="UTxO.TokenProvenance.html#601" class="Function Operator">↝⟦</a> <a id="4880" class="Number">1</a> <a id="4882" href="UTxO.TokenProvenance.html#601" class="Function Operator">⟧</a> <a id="4884" href="StateMachine.Extract.html#4865" class="Bound">tx′</a>
  <a id="4890" class="Symbol">→</a> <a id="4892" class="Symbol">(</a><a id="4893" href="StateMachine.Extract.html#4893" class="Bound">tx∈</a> <a id="4897" class="Symbol">:</a> <a id="4899" href="StateMachine.Extract.html#4865" class="Bound">tx′</a> <a id="4903" href="UTxO.Validity.html#4108" class="Function Operator">∈′</a> <a id="4906" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="4907" class="Symbol">)</a>
    <a id="4913" class="Comment">--------------------------------</a>
  <a id="4948" class="Symbol">→</a> <a id="4950" class="Keyword">let</a> <a id="4954" href="StateMachine.Extract.html#4954" class="Bound">l</a> <a id="4956" class="Symbol">=</a> <a id="4958" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="4964" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="4966" href="Prelude.Lists.html#1536" class="Function">∈⇒Suffix</a> <a id="4975" href="StateMachine.Extract.html#4893" class="Bound">tx∈</a>
    <a id="4983" class="Keyword">in</a> <a id="4986" href="Data.Product.html#1378" class="Function">∃</a> <a id="4988" class="Symbol">λ</a> <a id="4990" href="StateMachine.Extract.html#4990" class="Bound">i</a> <a id="4992" class="Symbol">→</a> <a id="4994" href="Data.Product.html#1378" class="Function">∃</a> <a id="4996" class="Symbol">λ</a> <a id="4998" href="StateMachine.Extract.html#4998" class="Bound">o</a> <a id="5000" class="Symbol">→</a> <a id="5002" class="Symbol">(</a><a id="5003" href="StateMachine.Extract.html#4990" class="Bound">i</a> <a id="5005" href="Data.List.Membership.Setoid.html#896" class="Function Operator">∈</a> <a id="5007" href="UTxO.Types.html#7595" class="Field">inputs</a> <a id="5014" href="StateMachine.Extract.html#4865" class="Bound">tx′</a><a id="5017" class="Symbol">)</a>
                     <a id="5040" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="5042" class="Symbol">(</a><a id="5043" href="StateMachine.Extract.html#4998" class="Bound">o</a> <a id="5045" href="Data.List.Membership.Setoid.html#896" class="Function Operator">∈</a> <a id="5047" href="UTxO.Types.html#7700" class="Field">outputs</a> <a id="5055" href="StateMachine.Extract.html#4862" class="Bound">tx</a><a id="5057" class="Symbol">)</a>
                     <a id="5080" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="5082" class="Symbol">(</a><a id="5083" href="UTxO.Value.html#6057" class="Function Operator">◆∈</a> <a id="5086" href="UTxO.Types.html#4906" class="Field">value</a> <a id="5092" href="StateMachine.Extract.html#4998" class="Bound">o</a><a id="5093" class="Symbol">)</a>
                     <a id="5116" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="5118" class="Symbol">(</a><a id="5119" href="UTxO.TxUtilities.html#5021" class="Function">getSpentOutput</a> <a id="5134" href="StateMachine.Extract.html#4954" class="Bound">l</a> <a id="5136" href="StateMachine.Extract.html#4990" class="Bound">i</a> <a id="5138" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5140" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5145" href="StateMachine.Extract.html#4998" class="Bound">o</a><a id="5146" class="Symbol">)</a>
<a id="5148" href="StateMachine.Extract.html#4854" class="Function">hh</a> <a id="5151" class="Symbol">{</a><a id="5152" class="Argument">tx</a> <a id="5155" class="Symbol">=</a> <a id="5157" href="StateMachine.Extract.html#5157" class="Bound">tx</a><a id="5159" class="Symbol">}{</a><a id="5161" href="StateMachine.Extract.html#5161" class="Bound">tx′</a><a id="5164" class="Symbol">}</a> <a id="5166" class="Symbol">(</a><a id="5167" href="StateMachine.Extract.html#5167" class="Bound">or∈</a> <a id="5171" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5173" href="StateMachine.Extract.html#5173" class="Bound">o</a> <a id="5175" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5177" href="StateMachine.Extract.html#5177" class="Bound">⁉≡just</a> <a id="5184" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5186" href="StateMachine.Extract.html#5186" class="Bound">◆∈v</a><a id="5189" class="Symbol">)</a> <a id="5191" href="StateMachine.Extract.html#5191" class="Bound">tx∈</a>
  <a id="5197" class="Symbol">=</a> <a id="5199" href="StateMachine.Extract.html#5370" class="Function">i</a> <a id="5201" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5203" href="StateMachine.Extract.html#5173" class="Bound">o</a> <a id="5205" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5207" href="StateMachine.Extract.html#5389" class="Function">i∈</a> <a id="5210" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5212" href="StateMachine.Extract.html#5444" class="Function">o∈</a> <a id="5215" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5217" href="StateMachine.Extract.html#5186" class="Bound">◆∈v</a> <a id="5221" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5223" href="StateMachine.Extract.html#5962" class="Function">getSpent≡</a>
  <a id="5235" class="Keyword">where</a>
    <a id="5245" href="StateMachine.Extract.html#5245" class="Function">l</a> <a id="5247" class="Symbol">=</a> <a id="5249" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="5255" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="5257" href="Prelude.Lists.html#1536" class="Function">∈⇒Suffix</a> <a id="5266" href="StateMachine.Extract.html#5191" class="Bound">tx∈</a>

    <a id="5275" href="StateMachine.Extract.html#5275" class="Function">∃i</a> <a id="5278" class="Symbol">:</a> <a id="5280" href="Data.Product.html#1378" class="Function">∃</a> <a id="5282" class="Symbol">λ</a> <a id="5284" href="StateMachine.Extract.html#5284" class="Bound">i</a> <a id="5286" class="Symbol">→</a> <a id="5288" href="StateMachine.Extract.html#5284" class="Bound">i</a> <a id="5290" href="Data.List.Membership.Setoid.html#896" class="Function Operator">∈</a> <a id="5292" href="UTxO.Types.html#7595" class="Field">inputs</a> <a id="5299" href="StateMachine.Extract.html#5161" class="Bound">tx′</a> <a id="5303" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="5305" class="Symbol">(</a><a id="5306" href="StateMachine.Extract.html#5157" class="Bound">tx</a> <a id="5309" href="UTxO.Hashing.Types.html#1170" class="Function Operator">♯ₜₓ</a> <a id="5313" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5315" href="UTxO.Types.html#4267" class="Field">hid</a> <a id="5319" class="Symbol">(</a><a id="5320" href="UTxO.Types.html#7448" class="Field">outputRef</a> <a id="5330" href="StateMachine.Extract.html#5284" class="Bound">i</a><a id="5331" class="Symbol">))</a>
    <a id="5338" href="StateMachine.Extract.html#5275" class="Function">∃i</a>  <a id="5342" class="Symbol">=</a> <a id="5344" href="Data.List.Membership.Setoid.html#1454" class="Function">find</a> <a id="5349" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="5351" href="Data.List.Relation.Unary.Any.Properties.html#11059" class="Function">L.Any.map⁻</a> <a id="5362" href="StateMachine.Extract.html#5167" class="Bound">or∈</a>
    <a id="5370" href="StateMachine.Extract.html#5370" class="Function">i</a>   <a id="5374" class="Symbol">=</a> <a id="5376" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="5382" href="StateMachine.Extract.html#5275" class="Function">∃i</a>
    <a id="5389" href="StateMachine.Extract.html#5389" class="Function">i∈</a>  <a id="5393" class="Symbol">=</a> <a id="5395" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="5401" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="5403" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="5409" href="StateMachine.Extract.html#5275" class="Function">∃i</a>
    <a id="5416" href="StateMachine.Extract.html#5416" class="Function">id≡</a> <a id="5420" class="Symbol">=</a> <a id="5422" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="5428" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="5430" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="5436" href="StateMachine.Extract.html#5275" class="Function">∃i</a>

    <a id="5444" href="StateMachine.Extract.html#5444" class="Function">o∈</a> <a id="5447" class="Symbol">:</a> <a id="5449" href="StateMachine.Extract.html#5173" class="Bound">o</a> <a id="5451" href="Data.List.Membership.Setoid.html#896" class="Function Operator">∈</a> <a id="5453" href="UTxO.Types.html#7700" class="Field">outputs</a> <a id="5461" href="StateMachine.Extract.html#5157" class="Bound">tx</a>
    <a id="5468" href="StateMachine.Extract.html#5444" class="Function">o∈</a> <a id="5471" class="Symbol">=</a> <a id="5473" href="Prelude.Lists.Indexed.html#11560" class="Function">just-⁉⇒∈</a> <a id="5482" class="Symbol">{</a><a id="5483" class="Argument">i</a> <a id="5485" class="Symbol">=</a> <a id="5487" href="UTxO.Types.html#4324" class="Field">index</a> <a id="5493" class="Symbol">(</a><a id="5494" href="Data.List.Relation.Unary.Any.html#1928" class="Function">L.Any.lookup</a> <a id="5507" href="StateMachine.Extract.html#5167" class="Bound">or∈</a><a id="5510" class="Symbol">)}</a> <a id="5513" href="StateMachine.Extract.html#5177" class="Bound">⁉≡just</a>

    <a id="5525" href="StateMachine.Extract.html#5525" class="Function">index≡</a> <a id="5532" class="Symbol">:</a> <a id="5534" href="Data.List.Relation.Unary.Any.html#1928" class="Function">L.Any.lookup</a> <a id="5547" href="StateMachine.Extract.html#5167" class="Bound">or∈</a> <a id="5551" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5553" href="UTxO.Types.html#7448" class="Field">outputRef</a> <a id="5563" href="StateMachine.Extract.html#5370" class="Function">i</a>
    <a id="5569" href="StateMachine.Extract.html#5525" class="Function">index≡</a> <a id="5576" class="Symbol">=</a> <a id="5578" href="Prelude.Lists.Postulates.html#2783" class="Postulate">lookup≡find∘map⁻</a> <a id="5595" class="Symbol">{</a><a id="5596" class="Argument">xs</a> <a id="5599" class="Symbol">=</a> <a id="5601" href="UTxO.Types.html#7595" class="Field">inputs</a> <a id="5608" href="StateMachine.Extract.html#5161" class="Bound">tx′</a><a id="5611" class="Symbol">}</a> <a id="5613" class="Symbol">{</a><a id="5614" class="Argument">f</a> <a id="5616" class="Symbol">=</a> <a id="5618" href="UTxO.Types.html#7448" class="Field">outputRef</a><a id="5627" class="Symbol">}</a> <a id="5629" href="StateMachine.Extract.html#5167" class="Bound">or∈</a>

    <a id="5638" href="StateMachine.Extract.html#5638" class="Function">⁉≡just′</a> <a id="5646" class="Symbol">:</a> <a id="5648" href="UTxO.Types.html#7700" class="Field">outputs</a> <a id="5656" href="StateMachine.Extract.html#5157" class="Bound">tx</a> <a id="5659" href="UTxO.TxUtilities.html#4328" class="Function Operator">⟦</a> <a id="5661" href="UTxO.Types.html#4324" class="Field">index</a> <a id="5667" class="Symbol">(</a><a id="5668" href="UTxO.Types.html#7448" class="Field">outputRef</a> <a id="5678" href="StateMachine.Extract.html#5370" class="Function">i</a><a id="5679" class="Symbol">)</a> <a id="5681" href="UTxO.TxUtilities.html#4328" class="Function Operator">⟧</a> <a id="5683" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5685" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5690" href="StateMachine.Extract.html#5173" class="Bound">o</a>
    <a id="5696" href="StateMachine.Extract.html#5638" class="Function">⁉≡just′</a> <a id="5704" class="Symbol">=</a> <a id="5706" href="Relation.Binary.PropositionalEquality.Core.html#1789" class="Function">subst</a> <a id="5712" class="Symbol">(λ</a> <a id="5715" href="StateMachine.Extract.html#5715" class="Bound">x</a> <a id="5717" class="Symbol">→</a> <a id="5719" href="UTxO.Types.html#7700" class="Field">outputs</a> <a id="5727" href="StateMachine.Extract.html#5157" class="Bound">tx</a> <a id="5730" href="UTxO.TxUtilities.html#4328" class="Function Operator">⟦</a> <a id="5732" href="UTxO.Types.html#4324" class="Field">index</a> <a id="5738" href="StateMachine.Extract.html#5715" class="Bound">x</a> <a id="5740" href="UTxO.TxUtilities.html#4328" class="Function Operator">⟧</a> <a id="5742" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5744" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5749" href="StateMachine.Extract.html#5173" class="Bound">o</a><a id="5750" class="Symbol">)</a> <a id="5752" href="StateMachine.Extract.html#5525" class="Function">index≡</a> <a id="5759" href="StateMachine.Extract.html#5177" class="Bound">⁉≡just</a>

    <a id="5771" href="StateMachine.Extract.html#5771" class="Function">vtx</a> <a id="5775" class="Symbol">:</a> <a id="5777" href="UTxO.Validity.html#1336" class="Record">IsValidTx</a> <a id="5787" href="StateMachine.Extract.html#5161" class="Bound">tx′</a> <a id="5791" href="StateMachine.Extract.html#5245" class="Function">l</a>
    <a id="5797" href="StateMachine.Extract.html#5771" class="Function">vtx</a> <a id="5801" class="Symbol">=</a> <a id="5803" href="UTxO.Validity.html#5451" class="Function">tx∈⇒valid</a> <a id="5813" class="Symbol">{</a><a id="5814" class="Argument">L</a> <a id="5816" class="Symbol">=</a> <a id="5818" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="5819" class="Symbol">}</a> <a id="5821" href="StateMachine.Extract.html#5191" class="Bound">tx∈</a>

    <a id="5830" href="StateMachine.Extract.html#5830" class="Function">vvh</a> <a id="5834" class="Symbol">:</a> <a id="5836" href="Data.Maybe.html#810" class="Function">Is-just</a> <a id="5844" class="Symbol">(</a><a id="5845" href="UTxO.TxUtilities.html#5021" class="Function">getSpentOutput</a> <a id="5860" href="StateMachine.Extract.html#5245" class="Function">l</a> <a id="5862" href="StateMachine.Extract.html#5370" class="Function">i</a><a id="5863" class="Symbol">)</a>
    <a id="5869" href="StateMachine.Extract.html#5830" class="Function">vvh</a> <a id="5873" class="Symbol">=</a> <a id="5875" href="Prelude.Maybes.html#1358" class="Function">Any⇒Is-just</a> <a id="5887" class="Symbol">{</a><a id="5888" class="Argument">mx</a> <a id="5891" class="Symbol">=</a> <a id="5893" href="UTxO.TxUtilities.html#5021" class="Function">getSpentOutput</a> <a id="5908" href="StateMachine.Extract.html#5245" class="Function">l</a> <a id="5910" href="StateMachine.Extract.html#5370" class="Function">i</a><a id="5911" class="Symbol">}</a> <a id="5913" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="5915" href="Data.List.Relation.Unary.All.html#5775" class="Function">L.All.lookup</a> <a id="5928" class="Symbol">(</a><a id="5929" href="UTxO.Validity.html#1977" class="Field">validateValidHashes</a> <a id="5949" href="StateMachine.Extract.html#5771" class="Function">vtx</a><a id="5952" class="Symbol">)</a> <a id="5954" href="StateMachine.Extract.html#5389" class="Function">i∈</a>

    <a id="5962" href="StateMachine.Extract.html#5962" class="Function">getSpent≡</a> <a id="5972" class="Symbol">:</a> <a id="5974" href="UTxO.TxUtilities.html#5021" class="Function">getSpentOutput</a> <a id="5989" href="StateMachine.Extract.html#5245" class="Function">l</a> <a id="5991" href="StateMachine.Extract.html#5370" class="Function">i</a> <a id="5993" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5995" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="6000" href="StateMachine.Extract.html#5173" class="Bound">o</a>
    <a id="6006" href="StateMachine.Extract.html#5962" class="Function">getSpent≡</a> <a id="6016" class="Symbol">=</a> <a id="6018" href="UTxO.TxUtilities.html#7523" class="Function">lookup-⟦⟧</a> <a id="6028" class="Symbol">{</a><a id="6029" class="Argument">tx</a> <a id="6032" class="Symbol">=</a> <a id="6034" href="StateMachine.Extract.html#5157" class="Bound">tx</a><a id="6036" class="Symbol">}{</a><a id="6038" href="StateMachine.Extract.html#5245" class="Function">l</a><a id="6039" class="Symbol">}{</a><a id="6041" href="StateMachine.Extract.html#5370" class="Function">i</a><a id="6042" class="Symbol">}{</a><a id="6044" href="StateMachine.Extract.html#5173" class="Bound">o</a><a id="6045" class="Symbol">}</a> <a id="6047" href="StateMachine.Extract.html#5830" class="Function">vvh</a> <a id="6051" class="Symbol">(</a><a id="6052" href="Relation.Binary.PropositionalEquality.Core.html#1693" class="Function">sym</a> <a id="6056" href="StateMachine.Extract.html#5416" class="Function">id≡</a><a id="6059" class="Symbol">)</a> <a id="6061" href="StateMachine.Extract.html#5638" class="Function">⁉≡just′</a>

<a id="h"></a><a id="6070" href="StateMachine.Extract.html#6070" class="Function">h</a> <a id="6072" class="Symbol">:</a> <a id="6074" class="Symbol">∀</a> <a id="6076" class="Symbol">{</a><a id="6077" href="StateMachine.Extract.html#6077" class="Bound">tx</a> <a id="6080" href="StateMachine.Extract.html#6080" class="Bound">tx′</a> <a id="6084" href="StateMachine.Extract.html#6084" class="Bound">s</a><a id="6085" class="Symbol">}</a>
  <a id="6089" class="Symbol">→</a> <a id="6091" href="StateMachine.Extract.html#4410" class="Record">TxS</a> <a id="6095" href="StateMachine.Extract.html#6077" class="Bound">tx</a> <a id="6098" href="StateMachine.Extract.html#6084" class="Bound">s</a>
  <a id="6102" class="Symbol">→</a> <a id="6104" href="StateMachine.Extract.html#6080" class="Bound">tx′</a> <a id="6108" href="UTxO.Validity.html#4108" class="Function Operator">∈′</a> <a id="6111" href="StateMachine.Extract.html#703" class="Bound">L</a>
  <a id="6115" class="Symbol">→</a> <a id="6117" href="StateMachine.Extract.html#6077" class="Bound">tx</a> <a id="6120" href="UTxO.TokenProvenance.html#601" class="Function Operator">↝⟦</a> <a id="6123" class="Number">1</a> <a id="6125" href="UTxO.TokenProvenance.html#601" class="Function Operator">⟧</a> <a id="6127" href="StateMachine.Extract.html#6080" class="Bound">tx′</a>
  <a id="6133" class="Symbol">→</a> <a id="6135" href="Data.Product.html#1378" class="Function">∃</a> <a id="6137" class="Symbol">λ</a> <a id="6139" href="StateMachine.Extract.html#6139" class="Bound">s′</a> <a id="6142" class="Symbol">→</a> <a id="6144" href="StateMachine.Extract.html#4410" class="Record">TxS</a> <a id="6148" href="StateMachine.Extract.html#6080" class="Bound">tx′</a> <a id="6152" href="StateMachine.Extract.html#6139" class="Bound">s′</a> <a id="6155" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="6157" class="Symbol">(</a><a id="6158" href="StateMachine.Extract.html#6084" class="Bound">s</a> <a id="6160" href="StateMachine.Inductive.Core.html#490" class="Function Operator">↝</a> <a id="6162" href="StateMachine.Extract.html#6139" class="Bound">s′</a><a id="6164" class="Symbol">)</a>
<a id="6166" href="StateMachine.Extract.html#6070" class="Function">h</a> <a id="6168" class="Symbol">{</a><a id="6169" class="Argument">tx</a> <a id="6172" class="Symbol">=</a> <a id="6174" href="StateMachine.Extract.html#6174" class="Bound">tx</a><a id="6176" class="Symbol">}{</a><a id="6178" href="StateMachine.Extract.html#6178" class="Bound">tx′</a><a id="6181" class="Symbol">}{</a><a id="6183" href="StateMachine.Extract.html#6183" class="Bound">s</a><a id="6184" class="Symbol">}</a> <a id="6186" class="Symbol">(</a><a id="6187" class="Keyword">record</a> <a id="6194" class="Symbol">{</a><a id="6195" href="StateMachine.Extract.html#4474" class="Field">s∈</a> <a id="6198" class="Symbol">=</a> <a id="6200" href="StateMachine.Extract.html#6200" class="Bound">v</a> <a id="6202" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6204" href="StateMachine.Extract.html#6204" class="Bound">outs≡</a><a id="6209" class="Symbol">})</a> <a id="6212" href="StateMachine.Extract.html#6212" class="Bound">tx∈</a> <a id="6216" href="StateMachine.Extract.html#6216" class="Bound">tx↝</a>
  <a id="6222" class="Keyword">with</a> <a id="6227" href="StateMachine.Extract.html#6227" class="Bound">txIn</a> <a id="6232" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6234" href="StateMachine.Extract.html#6234" class="Bound">o</a> <a id="6236" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6238" href="StateMachine.Extract.html#6238" class="Bound">txIn∈</a> <a id="6244" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6246" href="StateMachine.Extract.html#6246" class="Bound">o∈</a> <a id="6249" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6251" href="StateMachine.Extract.html#6251" class="Bound">◆∈v</a> <a id="6255" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6257" href="StateMachine.Extract.html#6257" class="Bound">getSpent≡</a> ← <a id="6269" href="StateMachine.Extract.html#4854" class="Function">hh</a> <a id="6272" class="Symbol">{</a><a id="6273" class="Argument">tx</a> <a id="6276" class="Symbol">=</a> <a id="6278" href="StateMachine.Extract.html#6174" class="Bound">tx</a><a id="6280" class="Symbol">}{</a><a id="6282" href="StateMachine.Extract.html#6178" class="Bound">tx′</a><a id="6285" class="Symbol">}</a> <a id="6287" href="StateMachine.Extract.html#6216" class="Bound">tx↝</a> <a id="6291" href="StateMachine.Extract.html#6212" class="Bound">tx∈</a>
  <a id="6297" class="Symbol">=</a> <a id="6299" href="StateMachine.Extract.html#8018" class="Function">qed</a>
  <a id="6305" class="Keyword">where</a>
    <a id="6315" class="Keyword">open</a> <a id="6320" href="Relation.Binary.PropositionalEquality.Core.html#2717" class="Module">≡-Reasoning</a>

    <a id="6337" href="StateMachine.Extract.html#6337" class="Function">l</a> <a id="6339" class="Symbol">=</a> <a id="6341" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="6347" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="6349" href="Prelude.Lists.html#1536" class="Function">∈⇒Suffix</a> <a id="6358" href="StateMachine.Extract.html#6212" class="Bound">tx∈</a>

    <a id="6367" href="StateMachine.Extract.html#6367" class="Function">vtx</a> <a id="6371" class="Symbol">:</a> <a id="6373" href="UTxO.Validity.html#1336" class="Record">IsValidTx</a> <a id="6383" href="StateMachine.Extract.html#6178" class="Bound">tx′</a> <a id="6387" href="StateMachine.Extract.html#6337" class="Function">l</a>
    <a id="6393" href="StateMachine.Extract.html#6367" class="Function">vtx</a> <a id="6397" class="Symbol">=</a> <a id="6399" href="UTxO.Validity.html#5451" class="Function">tx∈⇒valid</a> <a id="6409" class="Symbol">{</a><a id="6410" class="Argument">L</a> <a id="6412" class="Symbol">=</a> <a id="6414" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="6415" class="Symbol">}</a> <a id="6417" href="StateMachine.Extract.html#6212" class="Bound">tx∈</a>

    <a id="6426" href="StateMachine.Extract.html#6426" class="Function">o∈◆</a> <a id="6430" class="Symbol">:</a> <a id="6432" href="StateMachine.Extract.html#6234" class="Bound">o</a> <a id="6434" href="Data.List.Membership.Setoid.html#896" class="Function Operator">∈</a> <a id="6436" href="StateMachine.Extract.html#1086" class="Function">outputs◆</a> <a id="6445" href="StateMachine.Extract.html#6174" class="Bound">tx</a>
    <a id="6452" href="StateMachine.Extract.html#6426" class="Function">o∈◆</a> <a id="6456" class="Symbol">=</a> <a id="6458" href="Data.List.Membership.Propositional.Properties.html#8500" class="Function">∈-filter⁺</a> <a id="6468" class="Symbol">(</a><a id="6469" href="UTxO.Value.html#6073" class="Function Operator">◆∈?_</a> <a id="6474" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="6476" href="UTxO.Types.html#4906" class="Field">value</a><a id="6481" class="Symbol">)</a> <a id="6483" href="StateMachine.Extract.html#6246" class="Bound">o∈</a> <a id="6486" href="StateMachine.Extract.html#6251" class="Bound">◆∈v</a>

    <a id="6495" href="StateMachine.Extract.html#6495" class="Function">o≡</a> <a id="6498" class="Symbol">:</a> <a id="6500" href="StateMachine.Extract.html#6234" class="Bound">o</a> <a id="6502" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="6504" class="Keyword">record</a> <a id="6511" class="Symbol">{</a><a id="6512" href="UTxO.Types.html#4906" class="Field">value</a> <a id="6518" class="Symbol">=</a> <a id="6520" href="StateMachine.Extract.html#6200" class="Bound">v</a><a id="6521" class="Symbol">;</a> <a id="6523" href="UTxO.Types.html#4847" class="Field">address</a> <a id="6531" class="Symbol">=</a> <a id="6533" href="StateMachine.Base.html#3741" class="Function">𝕍</a><a id="6534" class="Symbol">;</a> <a id="6536" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="6546" class="Symbol">=</a> <a id="6548" href="UTxO.Types.html#1196" class="Field">toData</a> <a id="6555" href="StateMachine.Extract.html#6183" class="Bound">s</a> <a id="6557" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a><a id="6559" class="Symbol">}</a>
    <a id="6565" href="StateMachine.Extract.html#6495" class="Function">o≡</a> <a id="6568" class="Keyword">with</a> <a id="6573" href="Data.List.Relation.Unary.Any.html#1228" class="InductiveConstructor">here</a> <a id="6578" href="StateMachine.Extract.html#6578" class="Bound">eq</a> ← <a id="6583" href="Relation.Binary.PropositionalEquality.Core.html#1789" class="Function">subst</a> <a id="6589" class="Symbol">(</a><a id="6590" href="StateMachine.Extract.html#6234" class="Bound">o</a> <a id="6592" href="Data.List.Membership.Setoid.html#896" class="Function Operator">∈_</a><a id="6594" class="Symbol">)</a> <a id="6596" href="StateMachine.Extract.html#6204" class="Bound">outs≡</a> <a id="6602" href="StateMachine.Extract.html#6426" class="Function">o∈◆</a> <a id="6606" class="Symbol">=</a> <a id="6608" href="StateMachine.Extract.html#6578" class="Bound">eq</a>

    <a id="6616" href="StateMachine.Extract.html#6616" class="Function">vi</a> <a id="6619" class="Symbol">=</a> <a id="6621" href="UTxO.Types.html#7476" class="Field">validator</a> <a id="6631" href="StateMachine.Extract.html#6227" class="Bound">txIn</a>
    <a id="6640" href="StateMachine.Extract.html#6640" class="Function">ri</a> <a id="6643" class="Symbol">=</a> <a id="6645" href="UTxO.Types.html#7502" class="Field">redeemer</a> <a id="6654" href="StateMachine.Extract.html#6227" class="Bound">txIn</a>
    <a id="6663" href="StateMachine.Extract.html#6663" class="Function">di</a> <a id="6666" class="Symbol">=</a> <a id="6668" href="UTxO.Types.html#7523" class="Field">datum</a> <a id="6674" href="StateMachine.Extract.html#6227" class="Bound">txIn</a>
    <a id="6683" href="StateMachine.Extract.html#6683" class="Function">ds</a> <a id="6686" class="Symbol">=</a> <a id="6688" href="UTxO.Types.html#1196" class="Field">toData</a> <a id="6695" href="StateMachine.Extract.html#6183" class="Bound">s</a>
    <a id="6701" href="StateMachine.Extract.html#6701" class="Function">ptx</a> <a id="6705" class="Symbol">=</a> <a id="6707" href="UTxO.TxUtilities.html#6140" class="Function">toPendingTx</a> <a id="6719" href="StateMachine.Extract.html#6337" class="Function">l</a> <a id="6721" href="StateMachine.Extract.html#6178" class="Bound">tx′</a> <a id="6725" class="Symbol">(</a><a id="6726" href="Data.List.Relation.Unary.Any.html#1826" class="Function">L.Any.index</a> <a id="6738" href="StateMachine.Extract.html#6238" class="Bound">txIn∈</a><a id="6743" class="Symbol">)</a>

    <a id="6750" href="StateMachine.Extract.html#6750" class="Function">aiv</a> <a id="6754" class="Symbol">:</a> <a id="6756" href="Data.List.Relation.Unary.All.html#1453" class="Datatype">All</a> <a id="6760" class="Symbol">(λ{</a> <a id="6764" class="Symbol">(</a><a id="6765" href="StateMachine.Extract.html#6765" class="Bound">n</a> <a id="6767" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6769" href="StateMachine.Extract.html#6769" class="Bound">i</a><a id="6770" class="Symbol">)</a> <a id="6772" class="Symbol">→</a> <a id="6774" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="6776" class="Symbol">(</a><a id="6777" href="UTxO.Types.html#7476" class="Field">validator</a> <a id="6787" href="StateMachine.Extract.html#6769" class="Bound">i</a> <a id="6789" class="Symbol">(</a><a id="6790" href="UTxO.TxUtilities.html#6140" class="Function">toPendingTx</a> <a id="6802" href="StateMachine.Extract.html#6337" class="Function">l</a> <a id="6804" href="StateMachine.Extract.html#6178" class="Bound">tx′</a> <a id="6808" href="StateMachine.Extract.html#6765" class="Bound">n</a><a id="6809" class="Symbol">)</a> <a id="6811" class="Symbol">(</a><a id="6812" href="UTxO.Types.html#7502" class="Field">redeemer</a> <a id="6821" href="StateMachine.Extract.html#6769" class="Bound">i</a><a id="6822" class="Symbol">)</a> <a id="6824" class="Symbol">(</a><a id="6825" href="UTxO.Types.html#7523" class="Field">datum</a> <a id="6831" href="StateMachine.Extract.html#6769" class="Bound">i</a><a id="6832" class="Symbol">))})</a>
              <a id="6851" class="Symbol">(</a><a id="6852" href="Prelude.Lists.Indexed.html#1518" class="Function">enumerate</a> <a id="6862" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="6864" href="UTxO.Types.html#7595" class="Field">inputs</a> <a id="6871" href="StateMachine.Extract.html#6178" class="Bound">tx′</a><a id="6874" class="Symbol">)</a>
    <a id="6880" href="StateMachine.Extract.html#6750" class="Function">aiv</a> <a id="6884" class="Symbol">=</a> <a id="6886" href="UTxO.Validity.html#1730" class="Field">allInputsValidate</a> <a id="6904" href="StateMachine.Extract.html#6367" class="Function">vtx</a>

    <a id="6913" href="StateMachine.Extract.html#6913" class="Function">aiv′</a> <a id="6918" class="Symbol">:</a> <a id="6920" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="6922" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="6924" href="StateMachine.Extract.html#6616" class="Function">vi</a> <a id="6927" href="StateMachine.Extract.html#6701" class="Function">ptx</a> <a id="6931" href="StateMachine.Extract.html#6640" class="Function">ri</a> <a id="6934" href="StateMachine.Extract.html#6663" class="Function">di</a>
    <a id="6941" href="StateMachine.Extract.html#6913" class="Function">aiv′</a> <a id="6946" class="Symbol">=</a> <a id="6948" href="Data.List.Relation.Unary.All.html#5775" class="Function">L.All.lookup</a> <a id="6961" href="StateMachine.Extract.html#6750" class="Function">aiv</a> <a id="6965" class="Symbol">(</a><a id="6966" href="Prelude.Lists.Indexed.html#8732" class="Function">x∈→ix∈</a> <a id="6973" href="StateMachine.Extract.html#6238" class="Bound">txIn∈</a><a id="6978" class="Symbol">)</a>

    <a id="6985" href="StateMachine.Extract.html#6985" class="Function">vvh</a> <a id="6989" class="Symbol">:</a> <a id="6991" href="Data.List.Relation.Unary.All.html#1453" class="Datatype">All</a> <a id="6995" class="Symbol">(λ</a> <a id="6998" href="StateMachine.Extract.html#6998" class="Bound">i</a> <a id="7000" class="Symbol">→</a> <a id="7002" href="Data.Maybe.Relation.Unary.Any.html#839" class="Datatype">M.Any.Any</a> <a id="7012" class="Symbol">(λ</a> <a id="7015" href="StateMachine.Extract.html#7015" class="Bound">o</a> <a id="7017" class="Symbol">→</a> <a id="7019" class="Symbol">(</a><a id="7020" href="UTxO.Types.html#4847" class="Field">address</a> <a id="7028" href="StateMachine.Extract.html#7015" class="Bound">o</a> <a id="7030" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="7032" href="UTxO.Types.html#7476" class="Field">validator</a> <a id="7042" href="StateMachine.Extract.html#6998" class="Bound">i</a> <a id="7044" href="UTxO.Hashing.Base.html#1199" class="Postulate Operator">♯</a><a id="7045" class="Symbol">)</a> <a id="7047" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="7049" class="Symbol">(</a><a id="7050" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="7060" href="StateMachine.Extract.html#7015" class="Bound">o</a> <a id="7062" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="7064" href="UTxO.Types.html#7523" class="Field">datum</a> <a id="7070" href="StateMachine.Extract.html#6998" class="Bound">i</a> <a id="7072" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a><a id="7074" class="Symbol">))</a> <a id="7077" class="Symbol">(</a><a id="7078" href="UTxO.TxUtilities.html#5021" class="Function">getSpentOutput</a> <a id="7093" href="StateMachine.Extract.html#6337" class="Function">l</a> <a id="7095" href="StateMachine.Extract.html#6998" class="Bound">i</a><a id="7096" class="Symbol">))</a>
              <a id="7113" class="Symbol">(</a><a id="7114" href="UTxO.Types.html#7595" class="Field">inputs</a> <a id="7121" href="StateMachine.Extract.html#6178" class="Bound">tx′</a><a id="7124" class="Symbol">)</a>
    <a id="7130" href="StateMachine.Extract.html#6985" class="Function">vvh</a> <a id="7134" class="Symbol">=</a> <a id="7136" href="UTxO.Validity.html#1977" class="Field">validateValidHashes</a> <a id="7156" href="StateMachine.Extract.html#6367" class="Function">vtx</a>

    <a id="7165" href="StateMachine.Extract.html#7165" class="Function">vvh′</a> <a id="7170" class="Symbol">:</a> <a id="7172" href="Data.Maybe.Relation.Unary.Any.html#839" class="Datatype">M.Any.Any</a> <a id="7182" class="Symbol">(λ</a> <a id="7185" href="StateMachine.Extract.html#7185" class="Bound">o</a> <a id="7187" class="Symbol">→</a> <a id="7189" class="Symbol">(</a><a id="7190" href="UTxO.Types.html#4847" class="Field">address</a> <a id="7198" href="StateMachine.Extract.html#7185" class="Bound">o</a> <a id="7200" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="7202" href="StateMachine.Extract.html#6616" class="Function">vi</a> <a id="7205" href="UTxO.Hashing.Base.html#1199" class="Postulate Operator">♯</a><a id="7206" class="Symbol">)</a> <a id="7208" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="7210" class="Symbol">(</a><a id="7211" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="7221" href="StateMachine.Extract.html#7185" class="Bound">o</a> <a id="7223" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="7225" href="StateMachine.Extract.html#6663" class="Function">di</a> <a id="7228" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a><a id="7230" class="Symbol">))</a> <a id="7233" class="Symbol">(</a><a id="7234" href="UTxO.TxUtilities.html#5021" class="Function">getSpentOutput</a> <a id="7249" href="StateMachine.Extract.html#6337" class="Function">l</a> <a id="7251" href="StateMachine.Extract.html#6227" class="Bound">txIn</a><a id="7255" class="Symbol">)</a>
    <a id="7261" href="StateMachine.Extract.html#7165" class="Function">vvh′</a> <a id="7266" class="Symbol">=</a> <a id="7268" href="Data.List.Relation.Unary.All.html#5775" class="Function">L.All.lookup</a> <a id="7281" href="StateMachine.Extract.html#6985" class="Function">vvh</a> <a id="7285" href="StateMachine.Extract.html#6238" class="Bound">txIn∈</a>

    <a id="7296" href="StateMachine.Extract.html#7296" class="Function">vvh″</a> <a id="7301" class="Symbol">:</a> <a id="7303" class="Symbol">(</a><a id="7304" href="UTxO.Types.html#4847" class="Field">address</a> <a id="7312" href="StateMachine.Extract.html#6234" class="Bound">o</a> <a id="7314" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="7316" href="StateMachine.Extract.html#6616" class="Function">vi</a> <a id="7319" href="UTxO.Hashing.Base.html#1199" class="Postulate Operator">♯</a><a id="7320" class="Symbol">)</a> <a id="7322" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="7324" class="Symbol">(</a><a id="7325" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="7335" href="StateMachine.Extract.html#6234" class="Bound">o</a> <a id="7337" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="7339" href="StateMachine.Extract.html#6663" class="Function">di</a> <a id="7342" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a><a id="7344" class="Symbol">)</a>
    <a id="7350" href="StateMachine.Extract.html#7296" class="Function">vvh″</a> <a id="7355" class="Symbol">=</a> <a id="7357" href="Prelude.Maybes.html#1233" class="Function">Any-just</a> <a id="7366" class="Symbol">{</a><a id="7367" class="Argument">mx</a> <a id="7370" class="Symbol">=</a> <a id="7372" href="UTxO.TxUtilities.html#5021" class="Function">getSpentOutput</a> <a id="7387" href="StateMachine.Extract.html#6337" class="Function">l</a> <a id="7389" href="StateMachine.Extract.html#6227" class="Bound">txIn</a><a id="7393" class="Symbol">}</a> <a id="7395" href="StateMachine.Extract.html#6257" class="Bound">getSpent≡</a> <a id="7405" href="StateMachine.Extract.html#7165" class="Function">vvh′</a>

    <a id="7415" href="StateMachine.Extract.html#7415" class="Function">vi≡</a> <a id="7419" class="Symbol">:</a> <a id="7421" href="StateMachine.Extract.html#6616" class="Function">vi</a> <a id="7424" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="7426" href="StateMachine.Base.html#3240" class="Function">validatorₛₘ</a>
    <a id="7442" href="StateMachine.Extract.html#7415" class="Function">vi≡</a> <a id="7446" class="Symbol">=</a> <a id="7448" href="UTxO.Hashing.Base.html#1227" class="Postulate">♯-injective</a>
        <a id="7468" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="7470" href="Relation.Binary.PropositionalEquality.Core.html#2815" class="Function Operator">begin</a> <a id="7476" href="StateMachine.Extract.html#6616" class="Function">vi</a> <a id="7479" href="UTxO.Hashing.Base.html#1199" class="Postulate Operator">♯</a>      <a id="7486" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">≡⟨</a> <a id="7489" href="Relation.Binary.PropositionalEquality.Core.html#1693" class="Function">sym</a> <a id="7493" class="Symbol">(</a><a id="7494" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="7500" href="StateMachine.Extract.html#7296" class="Function">vvh″</a><a id="7504" class="Symbol">)</a> <a id="7506" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">⟩</a>
                <a id="7524" href="UTxO.Types.html#4847" class="Field">address</a> <a id="7532" href="StateMachine.Extract.html#6234" class="Bound">o</a> <a id="7534" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">≡⟨</a> <a id="7537" href="Relation.Binary.PropositionalEquality.Core.html#1139" class="Function">cong</a> <a id="7542" href="UTxO.Types.html#4847" class="Field">address</a> <a id="7550" href="StateMachine.Extract.html#6495" class="Function">o≡</a> <a id="7553" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">⟩</a>
                <a id="7571" href="StateMachine.Base.html#3741" class="Function">𝕍</a>        <a id="7580" href="Relation.Binary.PropositionalEquality.Core.html#3114" class="Function Operator">∎</a>

    <a id="7587" href="StateMachine.Extract.html#7587" class="Function">di≡</a> <a id="7591" class="Symbol">:</a> <a id="7593" href="StateMachine.Extract.html#6663" class="Function">di</a> <a id="7596" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="7598" href="StateMachine.Extract.html#6683" class="Function">ds</a>
    <a id="7605" href="StateMachine.Extract.html#7587" class="Function">di≡</a> <a id="7609" class="Symbol">=</a> <a id="7611" href="UTxO.Hashing.Types.html#1643" class="Postulate">injective♯ᵈ</a>
        <a id="7631" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="7633" href="Relation.Binary.PropositionalEquality.Core.html#2815" class="Function Operator">begin</a> <a id="7639" href="StateMachine.Extract.html#6663" class="Function">di</a> <a id="7642" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a>       <a id="7651" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">≡⟨</a> <a id="7654" href="Relation.Binary.PropositionalEquality.Core.html#1693" class="Function">sym</a> <a id="7658" class="Symbol">(</a><a id="7659" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="7665" href="StateMachine.Extract.html#7296" class="Function">vvh″</a><a id="7669" class="Symbol">)</a> <a id="7671" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">⟩</a>
                <a id="7689" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="7699" href="StateMachine.Extract.html#6234" class="Bound">o</a> <a id="7701" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">≡⟨</a> <a id="7704" href="Relation.Binary.PropositionalEquality.Core.html#1139" class="Function">cong</a> <a id="7709" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="7719" href="StateMachine.Extract.html#6495" class="Function">o≡</a> <a id="7722" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">⟩</a>
                <a id="7740" href="StateMachine.Extract.html#6683" class="Function">ds</a> <a id="7743" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a>       <a id="7752" href="Relation.Binary.PropositionalEquality.Core.html#3114" class="Function Operator">∎</a>

    <a id="7759" href="StateMachine.Extract.html#7759" class="Function">Tval</a> <a id="7764" class="Symbol">:</a> <a id="7766" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="7768" class="Symbol">(</a><a id="7769" href="StateMachine.Base.html#3240" class="Function">validatorₛₘ</a> <a id="7781" href="StateMachine.Extract.html#6701" class="Function">ptx</a> <a id="7785" href="StateMachine.Extract.html#6640" class="Function">ri</a> <a id="7788" href="StateMachine.Extract.html#6683" class="Function">ds</a><a id="7790" class="Symbol">)</a>
    <a id="7796" href="StateMachine.Extract.html#7759" class="Function">Tval</a> <a id="7801" class="Symbol">=</a> <a id="7803" href="Relation.Binary.PropositionalEquality.Core.html#1789" class="Function">subst</a> <a id="7809" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="7811" class="Symbol">(</a><a id="7812" href="Relation.Binary.PropositionalEquality.Core.html#2815" class="Function Operator">begin</a> <a id="7818" href="StateMachine.Extract.html#6616" class="Function">vi</a> <a id="7821" href="StateMachine.Extract.html#6701" class="Function">ptx</a> <a id="7825" href="StateMachine.Extract.html#6640" class="Function">ri</a> <a id="7828" href="StateMachine.Extract.html#6663" class="Function">di</a>          <a id="7840" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">≡⟨</a> <a id="7843" href="Relation.Binary.PropositionalEquality.Core.html#1139" class="Function">cong</a> <a id="7848" class="Symbol">(λ</a> <a id="7851" href="StateMachine.Extract.html#7851" class="Bound">x</a> <a id="7853" class="Symbol">→</a> <a id="7855" href="StateMachine.Extract.html#7851" class="Bound">x</a> <a id="7857" href="StateMachine.Extract.html#6701" class="Function">ptx</a> <a id="7861" href="StateMachine.Extract.html#6640" class="Function">ri</a> <a id="7864" href="StateMachine.Extract.html#6663" class="Function">di</a><a id="7866" class="Symbol">)</a> <a id="7868" href="StateMachine.Extract.html#7415" class="Function">vi≡</a> <a id="7872" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">⟩</a>
                          <a id="7900" href="StateMachine.Base.html#3240" class="Function">validatorₛₘ</a> <a id="7912" href="StateMachine.Extract.html#6701" class="Function">ptx</a> <a id="7916" href="StateMachine.Extract.html#6640" class="Function">ri</a> <a id="7919" href="StateMachine.Extract.html#6663" class="Function">di</a> <a id="7922" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">≡⟨</a> <a id="7925" href="Relation.Binary.PropositionalEquality.Core.html#1139" class="Function">cong</a> <a id="7930" class="Symbol">(</a><a id="7931" href="StateMachine.Base.html#3240" class="Function">validatorₛₘ</a> <a id="7943" href="StateMachine.Extract.html#6701" class="Function">ptx</a> <a id="7947" href="StateMachine.Extract.html#6640" class="Function">ri</a><a id="7949" class="Symbol">)</a> <a id="7951" href="StateMachine.Extract.html#7587" class="Function">di≡</a> <a id="7955" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">⟩</a>
                          <a id="7983" href="StateMachine.Base.html#3240" class="Function">validatorₛₘ</a> <a id="7995" href="StateMachine.Extract.html#6701" class="Function">ptx</a> <a id="7999" href="StateMachine.Extract.html#6640" class="Function">ri</a> <a id="8002" href="StateMachine.Extract.html#6683" class="Function">ds</a> <a id="8005" href="Relation.Binary.PropositionalEquality.Core.html#3114" class="Function Operator">∎</a><a id="8006" class="Symbol">)</a> <a id="8008" href="StateMachine.Extract.html#6913" class="Function">aiv′</a>

    <a id="8018" href="StateMachine.Extract.html#8018" class="Function">qed</a> <a id="8022" class="Symbol">:</a> <a id="8024" href="Data.Product.html#1378" class="Function">∃</a> <a id="8026" class="Symbol">λ</a> <a id="8028" href="StateMachine.Extract.html#8028" class="Bound">s′</a> <a id="8031" class="Symbol">→</a> <a id="8033" href="StateMachine.Extract.html#4410" class="Record">TxS</a> <a id="8037" href="StateMachine.Extract.html#6178" class="Bound">tx′</a> <a id="8041" href="StateMachine.Extract.html#8028" class="Bound">s′</a> <a id="8044" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="8046" class="Symbol">(</a><a id="8047" href="StateMachine.Extract.html#6183" class="Bound">s</a> <a id="8049" href="StateMachine.Inductive.Core.html#490" class="Function Operator">↝</a> <a id="8051" href="StateMachine.Extract.html#8028" class="Bound">s′</a><a id="8053" class="Symbol">)</a>
    <a id="8059" href="StateMachine.Extract.html#8018" class="Function">qed</a> <a id="8063" class="Keyword">with</a> <a id="8068" href="StateMachine.Extract.html#8068" class="Bound">i</a> <a id="8070" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8072" href="StateMachine.Extract.html#8072" class="Bound">s′</a> <a id="8075" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8077" href="StateMachine.Extract.html#8077" class="Bound">tx≡</a> <a id="8081" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8083" href="StateMachine.Extract.html#8083" class="Bound">s→s′</a> <a id="8088" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8090" href="StateMachine.Extract.html#8090" class="Bound">outsOK</a> <a id="8097" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8099" class="Symbol">_</a> <a id="8101" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8103" href="StateMachine.Extract.html#8103" class="Bound">prop</a>  ← <a id="8111" href="StateMachine.Properties.html#2010" class="Function">T-validator</a> <a id="8123" class="Symbol">{</a><a id="8124" class="Argument">di</a> <a id="8127" class="Symbol">=</a> <a id="8129" href="StateMachine.Extract.html#6640" class="Function">ri</a><a id="8131" class="Symbol">}{</a><a id="8133" href="StateMachine.Extract.html#6183" class="Bound">s</a><a id="8134" class="Symbol">}{</a><a id="8136" href="StateMachine.Extract.html#6701" class="Function">ptx</a><a id="8139" class="Symbol">}</a> <a id="8141" href="StateMachine.Extract.html#7759" class="Function">Tval</a>
        <a id="8154" class="Keyword">with</a> <a id="8159" class="Symbol">_</a> <a id="8161" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8163" href="StateMachine.Extract.html#8163" class="Bound">vout≥</a>                                ← <a id="8202" href="StateMachine.Properties.html#717" class="Function">T-propagates</a> <a id="8215" class="Symbol">{</a><a id="8216" href="StateMachine.Extract.html#6701" class="Function">ptx</a><a id="8219" class="Symbol">}</a> <a id="8221" href="StateMachine.Extract.html#8103" class="Bound">prop</a>
        <a id="8234" class="Keyword">with</a> <a id="8239" href="StateMachine.Extract.html#8239" class="Bound">o′</a> <a id="8242" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8244" href="StateMachine.Extract.html#8244" class="Bound">o′∈</a> <a id="8248" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8250" href="StateMachine.Extract.html#8250" class="Bound">outs≡</a> <a id="8256" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8258" href="StateMachine.Extract.html#8258" class="Bound">datum≡</a> <a id="8265" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8267" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a> <a id="8272" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8274" href="StateMachine.Extract.html#8274" class="Bound">addr≡</a> ← <a id="8282" href="StateMachine.Properties.html#1011" class="Function">T-outputsOK</a> <a id="8294" class="Symbol">{</a><a id="8295" href="StateMachine.Extract.html#6337" class="Function">l</a><a id="8296" class="Symbol">}{</a><a id="8298" href="StateMachine.Extract.html#6178" class="Bound">tx′</a><a id="8301" class="Symbol">}{</a><a id="8303" href="StateMachine.Extract.html#6663" class="Function">di</a><a id="8305" class="Symbol">}{</a><a id="8307" href="StateMachine.Extract.html#6683" class="Function">ds</a><a id="8309" class="Symbol">}{</a><a id="8311" href="StateMachine.Extract.html#8072" class="Bound">s′</a><a id="8313" class="Symbol">}{</a><a id="8315" href="StateMachine.Extract.html#6227" class="Bound">txIn</a><a id="8319" class="Symbol">}{</a><a id="8321" href="StateMachine.Extract.html#6238" class="Bound">txIn∈</a><a id="8326" class="Symbol">}</a> <a id="8328" href="StateMachine.Extract.html#8090" class="Bound">outsOK</a>
      <a id="8341" class="Symbol">=</a> <a id="8343" href="StateMachine.Extract.html#8072" class="Bound">s′</a> <a id="8346" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8348" class="Keyword">record</a> <a id="8355" class="Symbol">{</a><a id="8356" href="StateMachine.Extract.html#4456" class="Field">tx∈</a> <a id="8360" class="Symbol">=</a> <a id="8362" href="StateMachine.Extract.html#6212" class="Bound">tx∈</a><a id="8365" class="Symbol">;</a> <a id="8367" href="StateMachine.Extract.html#4474" class="Field">s∈</a> <a id="8370" class="Symbol">=</a> <a id="8372" href="UTxO.Types.html#4906" class="Field">value</a> <a id="8378" href="StateMachine.Extract.html#8239" class="Bound">o′</a> <a id="8381" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8383" href="StateMachine.Extract.html#8973" class="Function">outs◆≡′</a><a id="8390" class="Symbol">}</a> <a id="8392" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8394" href="StateMachine.Extract.html#8068" class="Bound">i</a> <a id="8396" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8398" href="StateMachine.Extract.html#8077" class="Bound">tx≡</a> <a id="8402" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8404" href="StateMachine.Extract.html#8083" class="Bound">s→s′</a>
      <a id="8415" class="Keyword">where</a>
        <a id="8429" href="StateMachine.Extract.html#8429" class="Function">vout◆≥</a> <a id="8436" class="Symbol">:</a> <a id="8438" href="UTxO.Types.html#4906" class="Field">value</a> <a id="8444" href="StateMachine.Extract.html#8239" class="Bound">o′</a> <a id="8447" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="8449" href="Prelude.Ord.Core.html#289" class="Function Operator">≥</a> <a id="8451" href="StateMachine.Base.html#3185" class="Function">threadₛₘ</a> <a id="8460" href="UTxO.Value.html#5983" class="Function Operator">◆</a>
        <a id="8470" href="StateMachine.Extract.html#8429" class="Function">vout◆≥</a> <a id="8477" class="Symbol">=</a> <a id="8479" href="UTxO.Value.html#6208" class="Function">≥ᶜ-◆</a> <a id="8484" class="Symbol">{</a><a id="8485" class="Argument">x</a> <a id="8487" class="Symbol">=</a> <a id="8489" href="UTxO.Types.html#4906" class="Field">value</a> <a id="8495" href="StateMachine.Extract.html#8239" class="Bound">o′</a><a id="8497" class="Symbol">}</a> <a id="8499" class="Symbol">{</a><a id="8500" class="Argument">y</a> <a id="8502" class="Symbol">=</a> <a id="8504" href="StateMachine.Base.html#3185" class="Function">threadₛₘ</a><a id="8512" class="Symbol">}</a> <a id="8514" class="Symbol">(</a><a id="8515" href="Prelude.General.html#4098" class="Function">true⇒T</a> <a id="8522" href="StateMachine.Extract.html#8163" class="Bound">vout≥</a><a id="8527" class="Symbol">)</a>

        <a id="8538" href="StateMachine.Extract.html#8538" class="Function">◆∈v′</a> <a id="8543" class="Symbol">:</a> <a id="8545" href="UTxO.Value.html#6057" class="Function Operator">◆∈</a> <a id="8548" href="UTxO.Types.html#4906" class="Field">value</a> <a id="8554" href="StateMachine.Extract.html#8239" class="Bound">o′</a>
        <a id="8565" href="StateMachine.Extract.html#8538" class="Function">◆∈v′</a> <a id="8570" class="Symbol">=</a> <a id="8572" href="Relation.Binary.PropositionalEquality.Core.html#1789" class="Function">subst</a> <a id="8578" class="Symbol">(</a><a id="8579" href="UTxO.Types.html#4906" class="Field">value</a> <a id="8585" href="StateMachine.Extract.html#8239" class="Bound">o′</a> <a id="8588" href="UTxO.Value.html#5983" class="Function Operator">◆</a> <a id="8590" href="Prelude.Ord.Core.html#289" class="Function Operator">≥_</a><a id="8592" class="Symbol">)</a> <a id="8594" class="Symbol">(</a><a id="8595" href="UTxO.Value.html#6694" class="Function">◆-single</a> <a id="8604" class="Symbol">{</a><a id="8605" class="Argument">n</a> <a id="8607" class="Symbol">=</a> <a id="8609" class="Number">1</a><a id="8610" class="Symbol">})</a> <a id="8613" href="StateMachine.Extract.html#8429" class="Function">vout◆≥</a>

        <a id="8629" href="StateMachine.Extract.html#8629" class="Function">o′≡</a> <a id="8633" class="Symbol">:</a> <a id="8635" href="StateMachine.Extract.html#8239" class="Bound">o′</a> <a id="8638" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="8640" class="Keyword">record</a> <a id="8647" class="Symbol">{</a><a id="8648" href="UTxO.Types.html#4906" class="Field">value</a> <a id="8654" class="Symbol">=</a> <a id="8656" href="UTxO.Types.html#4906" class="Field">value</a> <a id="8662" href="StateMachine.Extract.html#8239" class="Bound">o′</a><a id="8664" class="Symbol">;</a> <a id="8666" href="UTxO.Types.html#4847" class="Field">address</a> <a id="8674" class="Symbol">=</a> <a id="8676" href="StateMachine.Base.html#3741" class="Function">𝕍</a><a id="8677" class="Symbol">;</a> <a id="8679" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="8689" class="Symbol">=</a> <a id="8691" href="UTxO.Types.html#1196" class="Field">toData</a> <a id="8698" href="StateMachine.Extract.html#8072" class="Bound">s′</a> <a id="8701" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a><a id="8703" class="Symbol">}</a>
        <a id="8713" href="StateMachine.Extract.html#8629" class="Function">o′≡</a> <a id="8717" class="Keyword">rewrite</a> <a id="8725" href="StateMachine.Extract.html#8274" class="Bound">addr≡</a> <a id="8731" class="Symbol">|</a> <a id="8733" href="StateMachine.Extract.html#7415" class="Function">vi≡</a> <a id="8737" class="Symbol">|</a> <a id="8739" href="StateMachine.Extract.html#8258" class="Bound">datum≡</a> <a id="8746" class="Symbol">=</a> <a id="8748" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>

        <a id="8762" href="StateMachine.Extract.html#8762" class="Function">o′∈outs◆</a> <a id="8771" class="Symbol">:</a> <a id="8773" href="StateMachine.Extract.html#8239" class="Bound">o′</a> <a id="8776" href="Data.List.Membership.Setoid.html#896" class="Function Operator">∈</a> <a id="8778" href="StateMachine.Extract.html#1086" class="Function">outputs◆</a> <a id="8787" href="StateMachine.Extract.html#6178" class="Bound">tx′</a>
        <a id="8799" href="StateMachine.Extract.html#8762" class="Function">o′∈outs◆</a> <a id="8808" class="Symbol">=</a> <a id="8810" href="Data.List.Membership.Propositional.Properties.html#8500" class="Function">∈-filter⁺</a> <a id="8820" class="Symbol">(</a><a id="8821" href="UTxO.Value.html#6073" class="Function Operator">◆∈?_</a> <a id="8826" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="8828" href="UTxO.Types.html#4906" class="Field">value</a><a id="8833" class="Symbol">)</a> <a id="8835" href="StateMachine.Extract.html#8244" class="Bound">o′∈</a> <a id="8839" href="StateMachine.Extract.html#8538" class="Function">◆∈v′</a>

        <a id="8853" href="StateMachine.Extract.html#8853" class="Function">outs◆≡</a> <a id="8860" class="Symbol">:</a> <a id="8862" href="StateMachine.Extract.html#1086" class="Function">outputs◆</a> <a id="8871" href="StateMachine.Extract.html#6178" class="Bound">tx′</a> <a id="8875" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="8877" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="8879" href="StateMachine.Extract.html#8239" class="Bound">o′</a> <a id="8882" href="Data.List.Base.html#5034" class="Function Operator">]</a>
        <a id="8892" href="StateMachine.Extract.html#8853" class="Function">outs◆≡</a> <a id="8899" class="Symbol">=</a> <a id="8901" href="Prelude.Lists.Singletons.html#2477" class="Function">ams-∈</a> <a id="8907" class="Symbol">{</a><a id="8908" class="Argument">x</a> <a id="8910" class="Symbol">=</a> <a id="8912" href="StateMachine.Extract.html#8239" class="Bound">o′</a><a id="8914" class="Symbol">}</a> <a id="8916" class="Symbol">{</a><a id="8917" class="Argument">xs</a> <a id="8920" class="Symbol">=</a> <a id="8922" href="StateMachine.Extract.html#1086" class="Function">outputs◆</a> <a id="8931" href="StateMachine.Extract.html#6178" class="Bound">tx′</a><a id="8934" class="Symbol">}</a> <a id="8936" class="Symbol">(</a><a id="8937" href="StateMachine.Extract.html#1160" class="Function">ams-outputs◆</a> <a id="8950" href="StateMachine.Extract.html#6212" class="Bound">tx∈</a><a id="8953" class="Symbol">)</a> <a id="8955" href="StateMachine.Extract.html#8762" class="Function">o′∈outs◆</a>

        <a id="8973" href="StateMachine.Extract.html#8973" class="Function">outs◆≡′</a> <a id="8981" class="Symbol">:</a> <a id="8983" href="StateMachine.Extract.html#1086" class="Function">outputs◆</a> <a id="8992" href="StateMachine.Extract.html#6178" class="Bound">tx′</a> <a id="8996" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="8998" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="9000" class="Keyword">record</a> <a id="9007" class="Symbol">{</a><a id="9008" href="UTxO.Types.html#4906" class="Field">value</a> <a id="9014" class="Symbol">=</a> <a id="9016" href="UTxO.Types.html#4906" class="Field">value</a> <a id="9022" href="StateMachine.Extract.html#8239" class="Bound">o′</a><a id="9024" class="Symbol">;</a> <a id="9026" href="UTxO.Types.html#4847" class="Field">address</a> <a id="9034" class="Symbol">=</a> <a id="9036" href="StateMachine.Base.html#3741" class="Function">𝕍</a><a id="9037" class="Symbol">;</a> <a id="9039" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="9049" class="Symbol">=</a> <a id="9051" href="UTxO.Types.html#1196" class="Field">toData</a> <a id="9058" href="StateMachine.Extract.html#8072" class="Bound">s′</a> <a id="9061" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a><a id="9063" class="Symbol">}</a> <a id="9065" href="Data.List.Base.html#5034" class="Function Operator">]</a>
        <a id="9075" href="StateMachine.Extract.html#8973" class="Function">outs◆≡′</a> <a id="9083" class="Symbol">=</a> <a id="9085" href="Relation.Binary.PropositionalEquality.Core.html#1738" class="Function">trans</a> <a id="9091" href="StateMachine.Extract.html#8853" class="Function">outs◆≡</a> <a id="9098" class="Symbol">(</a><a id="9099" href="Relation.Binary.PropositionalEquality.Core.html#1139" class="Function">cong</a> <a id="9104" href="Data.List.Base.html#5034" class="Function Operator">[_]</a> <a id="9108" href="StateMachine.Extract.html#8629" class="Function">o′≡</a><a id="9111" class="Symbol">)</a>

<a id="9114" class="Keyword">data</a> <a id="Xˢ"></a><a id="9119" href="StateMachine.Extract.html#9119" class="Datatype">Xˢ</a> <a id="9122" class="Symbol">:</a> <a id="9124" href="StateMachine.Extract.html#4499" class="Function">∃TxS</a> <a id="9129" class="Symbol">→</a> <a id="9131" href="StateMachine.Extract.html#4499" class="Function">∃TxS</a> <a id="9136" class="Symbol">→</a> <a id="9138" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="9142" class="Keyword">where</a>

  <a id="Xˢ.root"></a><a id="9151" href="StateMachine.Extract.html#9151" class="InductiveConstructor">root</a> <a id="9156" class="Symbol">:</a> <a id="9158" class="Symbol">∀</a> <a id="9160" class="Symbol">{</a><a id="9161" href="StateMachine.Extract.html#9161" class="Bound">tx</a><a id="9163" class="Symbol">}</a>

    <a id="9170" class="Symbol">→</a> <a id="9172" class="Symbol">(</a><a id="9173" href="StateMachine.Extract.html#9173" class="Bound">tx∈</a> <a id="9177" class="Symbol">:</a> <a id="9179" href="StateMachine.Extract.html#9161" class="Bound">tx</a> <a id="9182" href="UTxO.Validity.html#4108" class="Function Operator">∈′</a> <a id="9185" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="9186" class="Symbol">)</a>
    <a id="9192" class="Symbol">→</a> <a id="9194" class="Symbol">(</a><a id="9195" href="StateMachine.Extract.html#9195" class="Bound">p≡</a> <a id="9198" class="Symbol">:</a> <a id="9200" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="9202" class="Symbol">(</a><a id="9203" href="StateMachine.Base.html#2583" class="Function">policyₛₘ</a> <a id="9212" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="9214" class="Keyword">record</a> <a id="9221" class="Symbol">{</a><a id="9222" href="UTxO.Types.html#5388" class="Field">thisTx</a> <a id="9229" class="Symbol">=</a> <a id="9231" href="StateMachine.Base.html#3044" class="Function">ℂ</a><a id="9232" class="Symbol">;</a> <a id="9234" href="UTxO.Types.html#5368" class="Field">txInfo</a> <a id="9241" class="Symbol">=</a> <a id="9243" href="UTxO.TxUtilities.html#5856" class="Function">mkTxInfo</a> <a id="9252" class="Symbol">(</a><a id="9253" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="9259" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="9261" href="Prelude.Lists.html#1536" class="Function">∈⇒Suffix</a> <a id="9270" href="StateMachine.Extract.html#9173" class="Bound">tx∈</a><a id="9273" class="Symbol">)</a> <a id="9275" href="StateMachine.Extract.html#9161" class="Bound">tx</a><a id="9277" class="Symbol">}))</a>
      <a id="9287" class="Comment">--------------------------------------------------------</a>
    <a id="9348" class="Symbol">→</a> <a id="9350" class="Keyword">let</a> <a id="9354" href="StateMachine.Extract.html#9354" class="Bound">s</a> <a id="9356" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9358" class="Symbol">_</a> <a id="9360" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9362" href="StateMachine.Extract.html#9362" class="Bound">txs</a> <a id="9366" class="Symbol">=</a> <a id="9368" href="StateMachine.Extract.html#4533" class="Function">h₀</a> <a id="9371" href="StateMachine.Extract.html#9173" class="Bound">tx∈</a> <a id="9375" href="StateMachine.Extract.html#9195" class="Bound">p≡</a>
      <a id="9384" class="Keyword">in</a>  <a id="9388" href="StateMachine.Extract.html#9119" class="Datatype">Xˢ</a> <a id="9391" class="Symbol">(</a><a id="9392" href="StateMachine.Extract.html#9161" class="Bound">tx</a> <a id="9395" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9397" href="StateMachine.Extract.html#9354" class="Bound">s</a> <a id="9399" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9401" href="StateMachine.Extract.html#9362" class="Bound">txs</a><a id="9404" class="Symbol">)</a> <a id="9406" class="Symbol">(</a><a id="9407" href="StateMachine.Extract.html#9161" class="Bound">tx</a> <a id="9410" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9412" href="StateMachine.Extract.html#9354" class="Bound">s</a> <a id="9414" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9416" href="StateMachine.Extract.html#9362" class="Bound">txs</a><a id="9419" class="Symbol">)</a>

  <a id="Xˢ.cons"></a><a id="9424" href="StateMachine.Extract.html#9424" class="InductiveConstructor">cons</a> <a id="9429" class="Symbol">:</a> <a id="9431" class="Symbol">∀</a> <a id="9433" class="Symbol">{</a><a id="9434" href="StateMachine.Extract.html#9434" class="Bound">txs₀</a> <a id="9439" href="StateMachine.Extract.html#9439" class="Bound">tx</a> <a id="9442" href="StateMachine.Extract.html#9442" class="Bound">s</a> <a id="9444" href="StateMachine.Extract.html#9444" class="Bound">tx′</a><a id="9447" class="Symbol">}</a> <a id="9449" class="Symbol">{</a><a id="9450" href="StateMachine.Extract.html#9450" class="Bound">txs</a> <a id="9454" class="Symbol">:</a> <a id="9456" href="StateMachine.Extract.html#4410" class="Record">TxS</a> <a id="9460" href="StateMachine.Extract.html#9439" class="Bound">tx</a> <a id="9463" href="StateMachine.Extract.html#9442" class="Bound">s</a><a id="9464" class="Symbol">}</a>

    <a id="9471" class="Symbol">→</a> <a id="9473" href="StateMachine.Extract.html#9119" class="Datatype">Xˢ</a> <a id="9476" href="StateMachine.Extract.html#9434" class="Bound">txs₀</a> <a id="9481" class="Symbol">(</a><a id="9482" href="StateMachine.Extract.html#9439" class="Bound">tx</a> <a id="9485" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9487" href="StateMachine.Extract.html#9442" class="Bound">s</a> <a id="9489" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9491" href="StateMachine.Extract.html#9450" class="Bound">txs</a><a id="9494" class="Symbol">)</a>
    <a id="9500" class="Symbol">→</a> <a id="9502" class="Symbol">(</a><a id="9503" href="StateMachine.Extract.html#9503" class="Bound">tx∈</a> <a id="9507" class="Symbol">:</a> <a id="9509" href="StateMachine.Extract.html#9444" class="Bound">tx′</a> <a id="9513" href="UTxO.Validity.html#4108" class="Function Operator">∈′</a> <a id="9516" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="9517" class="Symbol">)</a>
    <a id="9523" class="Symbol">→</a> <a id="9525" class="Symbol">(</a><a id="9526" href="StateMachine.Extract.html#9526" class="Bound">tx↝</a> <a id="9530" class="Symbol">:</a> <a id="9532" href="StateMachine.Extract.html#9439" class="Bound">tx</a> <a id="9535" href="UTxO.TokenProvenance.html#601" class="Function Operator">↝⟦</a> <a id="9538" class="Number">1</a> <a id="9540" href="UTxO.TokenProvenance.html#601" class="Function Operator">⟧</a> <a id="9542" href="StateMachine.Extract.html#9444" class="Bound">tx′</a><a id="9545" class="Symbol">)</a>
      <a id="9553" class="Comment">-----------------------------------</a>
    <a id="9593" class="Symbol">→</a> <a id="9595" class="Keyword">let</a> <a id="9599" href="StateMachine.Extract.html#9599" class="Bound">s′</a> <a id="9602" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9604" href="StateMachine.Extract.html#9604" class="Bound">txs′</a> <a id="9609" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9611" class="Symbol">_</a> <a id="9613" class="Symbol">=</a> <a id="9615" href="StateMachine.Extract.html#6070" class="Function">h</a> <a id="9617" href="StateMachine.Extract.html#9450" class="Bound">txs</a> <a id="9621" href="StateMachine.Extract.html#9503" class="Bound">tx∈</a> <a id="9625" href="StateMachine.Extract.html#9526" class="Bound">tx↝</a>
      <a id="9635" class="Keyword">in</a>  <a id="9639" href="StateMachine.Extract.html#9119" class="Datatype">Xˢ</a> <a id="9642" href="StateMachine.Extract.html#9434" class="Bound">txs₀</a> <a id="9647" class="Symbol">(</a><a id="9648" href="StateMachine.Extract.html#9444" class="Bound">tx′</a> <a id="9652" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9654" href="StateMachine.Extract.html#9599" class="Bound">s′</a> <a id="9657" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9659" href="StateMachine.Extract.html#9604" class="Bound">txs′</a><a id="9663" class="Symbol">)</a>


<a id="X¹→Xˢ"></a><a id="9667" href="StateMachine.Extract.html#9667" class="Function">X¹→Xˢ</a> <a id="9673" class="Symbol">:</a> <a id="9675" class="Symbol">∀</a> <a id="9677" class="Symbol">{</a><a id="9678" href="StateMachine.Extract.html#9678" class="Bound">tx</a> <a id="9681" href="StateMachine.Extract.html#9681" class="Bound">tx′</a><a id="9684" class="Symbol">}</a>
  <a id="9688" class="Symbol">→</a> <a id="9690" href="StateMachine.Extract.html#2853" class="Datatype">X¹</a> <a id="9693" href="StateMachine.Extract.html#9678" class="Bound">tx</a> <a id="9696" href="StateMachine.Extract.html#9681" class="Bound">tx′</a>
    <a id="9704" class="Comment">-------------------------------------</a>
  <a id="9744" class="Symbol">→</a> <a id="9746" href="Data.Product.html#1378" class="Function">∃</a> <a id="9748" class="Symbol">λ</a> <a id="9750" href="StateMachine.Extract.html#9750" class="Bound">s</a> <a id="9752" class="Symbol">→</a> <a id="9754" href="Data.Product.html#1378" class="Function">∃</a> <a id="9756" class="Symbol">λ</a> <a id="9758" href="StateMachine.Extract.html#9758" class="Bound">s′</a> <a id="9761" class="Symbol">→</a> <a id="9763" href="Data.Product.html#1378" class="Function">∃</a> <a id="9765" class="Symbol">λ</a> <a id="9767" href="StateMachine.Extract.html#9767" class="Bound">txs</a> <a id="9771" class="Symbol">→</a> <a id="9773" href="Data.Product.html#1378" class="Function">∃</a> <a id="9775" class="Symbol">λ</a> <a id="9777" href="StateMachine.Extract.html#9777" class="Bound">txs′</a> <a id="9782" class="Symbol">→</a>
      <a id="9790" href="StateMachine.Extract.html#9119" class="Datatype">Xˢ</a> <a id="9793" class="Symbol">(</a><a id="9794" href="StateMachine.Extract.html#9678" class="Bound">tx</a> <a id="9797" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9799" href="StateMachine.Extract.html#9750" class="Bound">s</a> <a id="9801" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9803" href="StateMachine.Extract.html#9767" class="Bound">txs</a><a id="9806" class="Symbol">)</a> <a id="9808" class="Symbol">(</a><a id="9809" href="StateMachine.Extract.html#9681" class="Bound">tx′</a> <a id="9813" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9815" href="StateMachine.Extract.html#9758" class="Bound">s′</a> <a id="9818" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9820" href="StateMachine.Extract.html#9777" class="Bound">txs′</a><a id="9824" class="Symbol">)</a>
<a id="9826" href="StateMachine.Extract.html#9667" class="Function">X¹→Xˢ</a> <a id="9832" class="Symbol">{</a><a id="9833" class="Argument">tx</a> <a id="9836" class="Symbol">=</a> <a id="9838" href="StateMachine.Extract.html#9838" class="Bound">tx</a><a id="9840" class="Symbol">}</a> <a id="9842" class="Symbol">{</a><a id="9843" class="DottedPattern Symbol">.</a><a id="9844" href="StateMachine.Extract.html#9838" class="DottedPattern Bound">tx</a><a id="9846" class="Symbol">}</a> <a id="9848" class="Symbol">(</a><a id="9849" href="StateMachine.Extract.html#2881" class="InductiveConstructor">root</a> <a id="9854" class="DottedPattern Symbol">.</a><a id="9855" href="StateMachine.Extract.html#9838" class="DottedPattern Bound">tx</a> <a id="9858" href="StateMachine.Extract.html#9858" class="Bound">tx∈</a> <a id="9862" href="StateMachine.Extract.html#9862" class="Bound">p≡</a><a id="9864" class="Symbol">)</a> <a id="9866" class="Symbol">=</a>
  <a id="9870" class="Keyword">let</a> <a id="9874" href="StateMachine.Extract.html#9874" class="Bound">s</a> <a id="9876" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9878" class="Symbol">_</a> <a id="9880" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9882" href="StateMachine.Extract.html#9882" class="Bound">txs</a> <a id="9886" class="Symbol">=</a> <a id="9888" href="StateMachine.Extract.html#4533" class="Function">h₀</a> <a id="9891" href="StateMachine.Extract.html#9858" class="Bound">tx∈</a> <a id="9895" href="StateMachine.Extract.html#9862" class="Bound">p≡</a>
  <a id="9900" class="Keyword">in</a>  <a id="9904" class="Symbol">_</a> <a id="9906" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9908" class="Symbol">_</a> <a id="9910" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9912" class="Symbol">_</a> <a id="9914" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9916" class="Symbol">_</a> <a id="9918" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9920" href="StateMachine.Extract.html#9151" class="InductiveConstructor">root</a> <a id="9925" href="StateMachine.Extract.html#9858" class="Bound">tx∈</a> <a id="9929" href="StateMachine.Extract.html#9862" class="Bound">p≡</a>
<a id="9932" href="StateMachine.Extract.html#9667" class="Function">X¹→Xˢ</a> <a id="9938" class="Symbol">{</a><a id="9939" class="Argument">tx</a> <a id="9942" class="Symbol">=</a> <a id="9944" href="StateMachine.Extract.html#9944" class="Bound">tx</a><a id="9946" class="Symbol">}</a> <a id="9948" class="Symbol">{</a><a id="9949" href="StateMachine.Extract.html#9949" class="Bound">tx′</a><a id="9952" class="Symbol">}</a> <a id="9954" class="Symbol">(</a><a id="9955" href="StateMachine.Extract.html#3115" class="InductiveConstructor">cons</a> <a id="9960" href="StateMachine.Extract.html#9960" class="Bound">x¹</a> <a id="9963" href="StateMachine.Extract.html#9963" class="Bound">tx∈</a> <a id="9967" href="StateMachine.Extract.html#9967" class="Bound">tx↝</a><a id="9970" class="Symbol">)</a> <a id="9972" class="Symbol">=</a>
  <a id="9976" class="Keyword">let</a> <a id="9980" class="Symbol">_</a> <a id="9982" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9984" href="StateMachine.Extract.html#9984" class="Bound">s</a> <a id="9986" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9988" class="Symbol">_</a> <a id="9990" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9992" href="StateMachine.Extract.html#9992" class="Bound">txs</a> <a id="9996" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9998" href="StateMachine.Extract.html#9998" class="Bound">xˢ</a>  <a id="10002" class="Symbol">=</a> <a id="10004" href="StateMachine.Extract.html#9667" class="Function">X¹→Xˢ</a> <a id="10010" href="StateMachine.Extract.html#9960" class="Bound">x¹</a>
      <a id="10019" href="StateMachine.Extract.html#10019" class="Bound">s′</a> <a id="10022" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10024" href="StateMachine.Extract.html#10024" class="Bound">txs′</a> <a id="10029" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10031" class="Symbol">_</a> <a id="10033" class="Symbol">=</a> <a id="10035" href="StateMachine.Extract.html#6070" class="Function">h</a> <a id="10037" href="StateMachine.Extract.html#9992" class="Bound">txs</a> <a id="10041" href="StateMachine.Extract.html#9963" class="Bound">tx∈</a> <a id="10045" href="StateMachine.Extract.html#9967" class="Bound">tx↝</a>
  <a id="10051" class="Keyword">in</a>  <a id="10055" class="Symbol">_</a> <a id="10057" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10059" class="Symbol">_</a> <a id="10061" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10063" class="Symbol">_</a> <a id="10065" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10067" class="Symbol">_</a> <a id="10069" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10071" href="StateMachine.Extract.html#9424" class="InductiveConstructor">cons</a> <a id="10076" href="StateMachine.Extract.html#9998" class="Bound">xˢ</a> <a id="10079" href="StateMachine.Extract.html#9963" class="Bound">tx∈</a> <a id="10083" href="StateMachine.Extract.html#9967" class="Bound">tx↝</a>

<a id="Xˢ→R"></a><a id="10088" href="StateMachine.Extract.html#10088" class="Function">Xˢ→R</a> <a id="10093" class="Symbol">:</a> <a id="10095" class="Symbol">∀</a> <a id="10097" class="Symbol">{</a><a id="10098" href="StateMachine.Extract.html#10098" class="Bound">tx</a> <a id="10101" href="StateMachine.Extract.html#10101" class="Bound">s</a> <a id="10103" href="StateMachine.Extract.html#10103" class="Bound">tx′</a> <a id="10107" href="StateMachine.Extract.html#10107" class="Bound">s′</a><a id="10109" class="Symbol">}</a> <a id="10111" class="Symbol">{</a><a id="10112" href="StateMachine.Extract.html#10112" class="Bound">txs</a> <a id="10116" class="Symbol">:</a> <a id="10118" href="StateMachine.Extract.html#4410" class="Record">TxS</a> <a id="10122" href="StateMachine.Extract.html#10098" class="Bound">tx</a> <a id="10125" href="StateMachine.Extract.html#10101" class="Bound">s</a><a id="10126" class="Symbol">}</a> <a id="10128" class="Symbol">{</a><a id="10129" href="StateMachine.Extract.html#10129" class="Bound">txs′</a> <a id="10134" class="Symbol">:</a> <a id="10136" href="StateMachine.Extract.html#4410" class="Record">TxS</a> <a id="10140" href="StateMachine.Extract.html#10103" class="Bound">tx′</a> <a id="10144" href="StateMachine.Extract.html#10107" class="Bound">s′</a><a id="10146" class="Symbol">}</a>
  <a id="10150" class="Symbol">→</a> <a id="10152" href="StateMachine.Extract.html#9119" class="Datatype">Xˢ</a> <a id="10155" class="Symbol">(_</a> <a id="10158" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10160" class="Symbol">_</a> <a id="10162" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10164" href="StateMachine.Extract.html#10112" class="Bound">txs</a><a id="10167" class="Symbol">)</a> <a id="10169" class="Symbol">(_</a> <a id="10172" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10174" class="Symbol">_</a> <a id="10176" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10178" href="StateMachine.Extract.html#10129" class="Bound">txs′</a><a id="10182" class="Symbol">)</a>
    <a id="10188" class="Comment">-------------------------------</a>
  <a id="10222" class="Symbol">→</a> <a id="10224" href="StateMachine.Extract.html#10101" class="Bound">s</a> <a id="10226" href="StateMachine.Inductive.Core.html#593" class="Datatype Operator">↝⋆</a> <a id="10229" href="StateMachine.Extract.html#10107" class="Bound">s′</a>
<a id="10232" href="StateMachine.Extract.html#10088" class="Function">Xˢ→R</a> <a id="10237" class="Symbol">(</a><a id="10238" href="StateMachine.Extract.html#9151" class="InductiveConstructor">root</a> <a id="10243" class="Symbol">{</a><a id="10244" class="Argument">tx</a> <a id="10247" class="Symbol">=</a> <a id="10249" href="StateMachine.Extract.html#10249" class="Bound">tx</a><a id="10251" class="Symbol">}</a> <a id="10253" href="StateMachine.Extract.html#10253" class="Bound">tx∈</a> <a id="10257" href="StateMachine.Extract.html#10257" class="Bound">p≡</a><a id="10259" class="Symbol">)</a> <a id="10261" class="Symbol">=</a>
  <a id="10265" class="Keyword">let</a> <a id="10269" class="Symbol">_</a> <a id="10271" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10273" href="StateMachine.Extract.html#10273" class="Bound">init-s</a> <a id="10280" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10282" class="Symbol">_</a> <a id="10284" class="Symbol">=</a> <a id="10286" href="StateMachine.Extract.html#4533" class="Function">h₀</a> <a id="10289" class="Symbol">{</a><a id="10290" class="Argument">tx</a> <a id="10293" class="Symbol">=</a> <a id="10295" href="StateMachine.Extract.html#10249" class="Bound">tx</a><a id="10297" class="Symbol">}</a> <a id="10299" href="StateMachine.Extract.html#10253" class="Bound">tx∈</a> <a id="10303" href="StateMachine.Extract.html#10257" class="Bound">p≡</a>
  <a id="10308" class="Keyword">in</a>  <a id="10312" href="StateMachine.Inductive.Core.html#617" class="InductiveConstructor">root</a> <a id="10317" href="StateMachine.Extract.html#10273" class="Bound">init-s</a>
<a id="10324" href="StateMachine.Extract.html#10088" class="Function">Xˢ→R</a> <a id="10329" class="Symbol">(</a><a id="10330" href="StateMachine.Extract.html#9424" class="InductiveConstructor">cons</a> <a id="10335" class="Symbol">{</a><a id="10336" class="Argument">txs</a> <a id="10340" class="Symbol">=</a> <a id="10342" href="StateMachine.Extract.html#10342" class="Bound">txs</a><a id="10345" class="Symbol">}</a> <a id="10347" href="StateMachine.Extract.html#10347" class="Bound">x</a> <a id="10349" href="StateMachine.Extract.html#10349" class="Bound">tx∈</a> <a id="10353" href="StateMachine.Extract.html#10353" class="Bound">tx↝</a><a id="10356" class="Symbol">)</a> <a id="10358" class="Symbol">=</a>
  <a id="10362" class="Keyword">let</a> <a id="10366" class="Symbol">_</a> <a id="10368" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10370" class="Symbol">_</a> <a id="10372" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10374" href="StateMachine.Extract.html#10374" class="Bound">s→s′</a> <a id="10379" class="Symbol">=</a> <a id="10381" href="StateMachine.Extract.html#6070" class="Function">h</a> <a id="10383" href="StateMachine.Extract.html#10342" class="Bound">txs</a> <a id="10387" href="StateMachine.Extract.html#10349" class="Bound">tx∈</a> <a id="10391" href="StateMachine.Extract.html#10353" class="Bound">tx↝</a>
  <a id="10397" class="Keyword">in</a>  <a id="10401" href="StateMachine.Inductive.Core.html#650" class="InductiveConstructor">snoc</a> <a id="10406" class="Symbol">(</a><a id="10407" href="StateMachine.Extract.html#10088" class="Function">Xˢ→R</a> <a id="10412" href="StateMachine.Extract.html#10347" class="Bound">x</a><a id="10413" class="Symbol">)</a> <a id="10415" href="StateMachine.Extract.html#10374" class="Bound">s→s′</a>

<a id="∃Xˢ"></a><a id="10421" href="StateMachine.Extract.html#10421" class="Function">∃Xˢ</a> <a id="10425" class="Symbol">=</a> <a id="10427" href="Data.Product.html#1815" class="Function">∃[</a> <a id="10430" href="StateMachine.Extract.html#10430" class="Bound">tx</a> <a id="10433" href="Data.Product.html#1815" class="Function">]</a> <a id="10435" href="Data.Product.html#1815" class="Function">∃[</a> <a id="10438" href="StateMachine.Extract.html#10438" class="Bound">tx′</a> <a id="10442" href="Data.Product.html#1815" class="Function">]</a> <a id="10444" href="Data.Product.html#1815" class="Function">∃[</a> <a id="10447" href="StateMachine.Extract.html#10447" class="Bound">s</a> <a id="10449" href="Data.Product.html#1815" class="Function">]</a> <a id="10451" href="Data.Product.html#1815" class="Function">∃[</a> <a id="10454" href="StateMachine.Extract.html#10454" class="Bound">s′</a> <a id="10457" href="Data.Product.html#1815" class="Function">]</a> <a id="10459" href="Data.Product.html#1815" class="Function">∃[</a> <a id="10462" href="StateMachine.Extract.html#10462" class="Bound">txs</a> <a id="10466" href="Data.Product.html#1815" class="Function">]</a> <a id="10468" href="Data.Product.html#1815" class="Function">∃[</a> <a id="10471" href="StateMachine.Extract.html#10471" class="Bound">txs′</a> <a id="10476" href="Data.Product.html#1815" class="Function">]</a> <a id="10478" href="StateMachine.Extract.html#9119" class="Datatype">Xˢ</a> <a id="10481" class="Symbol">(</a><a id="10482" href="StateMachine.Extract.html#10430" class="Bound">tx</a> <a id="10485" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10487" href="StateMachine.Extract.html#10447" class="Bound">s</a> <a id="10489" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10491" href="StateMachine.Extract.html#10462" class="Bound">txs</a><a id="10494" class="Symbol">)</a> <a id="10496" class="Symbol">(</a><a id="10497" href="StateMachine.Extract.html#10438" class="Bound">tx′</a> <a id="10501" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10503" href="StateMachine.Extract.html#10454" class="Bound">s′</a> <a id="10506" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10508" href="StateMachine.Extract.html#10471" class="Bound">txs′</a><a id="10512" class="Symbol">)</a>

<a id="10515" class="Keyword">module</a> <a id="Extraction"></a><a id="10522" href="StateMachine.Extract.html#10522" class="Module">Extraction</a> <a id="10533" class="Symbol">{</a><a id="10534" href="StateMachine.Extract.html#10534" class="Bound">tx</a> <a id="10537" href="StateMachine.Extract.html#10537" class="Bound">o</a><a id="10538" class="Symbol">}</a>
  <a id="10542" class="Symbol">(</a><a id="10543" href="StateMachine.Extract.html#10543" class="Bound">o∈</a>  <a id="10547" class="Symbol">:</a> <a id="10549" href="StateMachine.Extract.html#10537" class="Bound">o</a> <a id="10551" href="Data.List.Membership.Setoid.html#896" class="Function Operator">∈</a> <a id="10553" href="UTxO.Types.html#7700" class="Field">outputs</a> <a id="10561" href="StateMachine.Extract.html#10534" class="Bound">tx</a><a id="10563" class="Symbol">)</a>
  <a id="10567" class="Symbol">(</a><a id="10568" href="StateMachine.Extract.html#10568" class="Bound">jo</a>  <a id="10572" class="Symbol">:</a> <a id="10574" href="Data.Maybe.html#810" class="Function">Is-just</a> <a id="10582" href="StateMachine.Base.html#2353" class="Function">originₛₘ</a><a id="10590" class="Symbol">)</a>
  <a id="10594" class="Keyword">where</a>

  <a id="Extraction.source"></a><a id="10603" href="StateMachine.Extract.html#10603" class="Function">source</a> <a id="Extraction.dest"></a><a id="10610" href="StateMachine.Extract.html#10610" class="Function">dest</a> <a id="10615" class="Symbol">:</a> <a id="10617" href="StateMachine.Extract.html#10421" class="Function">∃Xˢ</a> <a id="10621" class="Symbol">→</a> <a id="10623" href="StateMachine.Extract.html#631" class="Bound">S</a>
  <a id="10627" href="StateMachine.Extract.html#10603" class="Function">source</a> <a id="10634" class="Symbol">=</a> <a id="10636" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="10642" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="10644" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="10650" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="10652" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a>
  <a id="10660" href="StateMachine.Extract.html#10610" class="Function">dest</a>   <a id="10667" class="Symbol">=</a> <a id="10669" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="10675" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="10677" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="10683" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="10685" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="10691" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="10693" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a>

  <a id="Extraction.provenanceˢ"></a><a id="10702" href="StateMachine.Extract.html#10702" class="Function">provenanceˢ</a> <a id="10714" class="Symbol">:</a>
      <a id="10722" class="Symbol">(</a><a id="10723" href="StateMachine.Extract.html#10723" class="Bound">tx∈</a> <a id="10727" class="Symbol">:</a> <a id="10729" href="StateMachine.Extract.html#10534" class="Bound">tx</a> <a id="10732" href="UTxO.Validity.html#4108" class="Function Operator">∈′</a> <a id="10735" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="10736" class="Symbol">)</a>
    <a id="10742" class="Symbol">→</a> <a id="10744" class="Symbol">(</a><a id="10745" href="StateMachine.Extract.html#10745" class="Bound">◆∈v</a> <a id="10749" class="Symbol">:</a> <a id="10751" href="UTxO.Value.html#6057" class="Function Operator">◆∈</a> <a id="10754" href="UTxO.Types.html#4906" class="Field">value</a> <a id="10760" href="StateMachine.Extract.html#10537" class="Bound">o</a><a id="10761" class="Symbol">)</a>
      <a id="10769" class="Comment">------------------</a>
    <a id="10792" class="Symbol">→</a> <a id="10794" href="StateMachine.Extract.html#10421" class="Function">∃Xˢ</a>
  <a id="10800" href="StateMachine.Extract.html#10702" class="Function">provenanceˢ</a> <a id="10812" href="StateMachine.Extract.html#10812" class="Bound">tx∈</a> <a id="10816" href="StateMachine.Extract.html#10816" class="Bound">◆∈v</a>
    <a id="10824" class="Keyword">with</a> <a id="10829" href="StateMachine.Extract.html#10829" class="Bound">l</a> <a id="10831" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10833" href="StateMachine.Extract.html#10833" class="Bound">l≺</a>                ← <a id="10853" href="Prelude.Lists.html#1536" class="Function">∈⇒Suffix</a> <a id="10862" href="StateMachine.Extract.html#10812" class="Bound">tx∈</a>
    <a id="10870" class="Keyword">with</a> <a id="10875" href="StateMachine.Extract.html#10875" class="Bound">vl</a>                    ← <a id="10899" href="UTxO.Validity.html#5268" class="Function">≼⇒valid</a> <a id="10907" class="Symbol">(</a><a id="10908" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="10914" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="10915" class="Symbol">)</a> <a id="10917" href="StateMachine.Extract.html#10833" class="Bound">l≺</a>
    <a id="10924" class="Keyword">with</a> <a id="10929" href="StateMachine.Extract.html#10929" class="Bound">n</a> <a id="10931" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10933" href="StateMachine.Extract.html#10933" class="Bound">tr</a> <a id="10936" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10938" class="Symbol">_</a> <a id="10940" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10942" href="StateMachine.Extract.html#10942" class="Bound">n&gt;0</a> <a id="10946" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10948" href="StateMachine.Extract.html#10948" class="Bound">p≡</a> ← <a id="10953" href="StateMachine.Initiality.html#560" class="Function">initiality</a> <a id="10964" href="StateMachine.Extract.html#10875" class="Bound">vl</a> <a id="10967" href="StateMachine.Extract.html#10543" class="Bound">o∈</a> <a id="10970" href="StateMachine.Extract.html#10816" class="Bound">◆∈v</a> <a id="10974" href="StateMachine.Extract.html#10568" class="Bound">jo</a>
     <a id="10982" class="Symbol">=</a> <a id="10984" class="Symbol">_</a> <a id="10986" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10988" class="Symbol">_</a> <a id="10990" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10992" href="StateMachine.Extract.html#9667" class="Function">X¹→Xˢ</a> <a id="10998" class="Symbol">(</a><a id="10999" href="StateMachine.Extract.html#3278" class="Function">X→X¹</a> <a id="11004" href="StateMachine.Extract.html#10942" class="Bound">n&gt;0</a> <a id="11008" href="StateMachine.Extract.html#11033" class="Function">tr′</a> <a id="11012" href="StateMachine.Extract.html#11089" class="Function">p≡′</a><a id="11015" class="Symbol">)</a>
    <a id="11021" class="Keyword">where</a>
      <a id="11033" href="StateMachine.Extract.html#11033" class="Function">tr′</a> <a id="11037" class="Symbol">:</a> <a id="11039" href="UTxO.TokenProvenance.html#1293" class="Record">Trace</a> <a id="11045" href="StateMachine.Extract.html#703" class="Bound">L</a> <a id="11047" href="StateMachine.Extract.html#10534" class="Bound">tx</a> <a id="11050" href="StateMachine.Extract.html#10929" class="Bound">n</a>
      <a id="11058" href="StateMachine.Extract.html#11033" class="Function">tr′</a> <a id="11062" class="Symbol">=</a> <a id="11064" href="UTxO.TokenProvenance.html#1899" class="Function">weakenTrace</a> <a id="11076" href="StateMachine.Extract.html#10833" class="Bound">l≺</a> <a id="11079" href="StateMachine.Extract.html#10933" class="Bound">tr</a>

      <a id="11089" href="StateMachine.Extract.html#11089" class="Function">p≡′</a> <a id="11093" class="Symbol">:</a> <a id="11095" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="11097" class="Symbol">(</a><a id="11098" href="StateMachine.Base.html#2583" class="Function">policyₛₘ</a> <a id="11107" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="11109" href="UTxO.TokenProvenance.html#8834" class="Function">mkPendingMPS</a> <a id="11122" class="Symbol">{</a><a id="11123" class="Argument">L</a> <a id="11125" class="Symbol">=</a> <a id="11127" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="11128" class="Symbol">}</a> <a id="11130" href="StateMachine.Extract.html#11033" class="Function">tr′</a> <a id="11134" href="StateMachine.Base.html#3044" class="Function">ℂ</a><a id="11135" class="Symbol">)</a>
      <a id="11143" href="StateMachine.Extract.html#11089" class="Function">p≡′</a> <a id="11147" class="Symbol">=</a> <a id="11149" href="Relation.Binary.PropositionalEquality.Core.html#1789" class="Function">subst</a> <a id="11155" class="Symbol">(λ</a> <a id="11158" href="StateMachine.Extract.html#11158" class="Bound">x</a> <a id="11160" class="Symbol">→</a> <a id="11162" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="11164" class="Symbol">(</a><a id="11165" href="StateMachine.Base.html#2583" class="Function">policyₛₘ</a> <a id="11174" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="11176" href="UTxO.TxUtilities.html#6321" class="Function">toPendingMPS</a> <a id="11189" href="StateMachine.Extract.html#11158" class="Bound">x</a> <a id="11191" class="Symbol">(</a><a id="11192" href="UTxO.TokenProvenance.html#1624" class="Function">origin</a> <a id="11199" href="StateMachine.Extract.html#10933" class="Bound">tr</a><a id="11201" class="Symbol">)</a> <a id="11203" href="StateMachine.Base.html#3044" class="Function">ℂ</a><a id="11204" class="Symbol">))</a> <a id="11207" class="Symbol">(</a><a id="11208" href="Relation.Binary.PropositionalEquality.Core.html#1693" class="Function">sym</a> <a id="11212" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="11214" href="UTxO.TokenProvenance.html#8960" class="Function">mps≡</a> <a id="11219" class="Symbol">{</a><a id="11220" class="Argument">L</a> <a id="11222" class="Symbol">=</a> <a id="11224" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="11225" class="Symbol">}</a> <a id="11227" class="Symbol">{_</a> <a id="11230" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="11232" href="StateMachine.Extract.html#10875" class="Bound">vl</a><a id="11234" class="Symbol">}</a> <a id="11236" href="StateMachine.Extract.html#10833" class="Bound">l≺</a> <a id="11239" href="StateMachine.Extract.html#10933" class="Bound">tr</a><a id="11241" class="Symbol">)</a> <a id="11243" href="StateMachine.Extract.html#10948" class="Bound">p≡</a>
      <a id="11252" class="Comment">-- rewrite mps≡ {L = L}{_ , vl} l≺ tr = p≡</a>

  <a id="Extraction.extract"></a><a id="11298" href="StateMachine.Extract.html#11298" class="Function">extract</a> <a id="11306" class="Symbol">:</a>
      <a id="11314" class="Symbol">(</a><a id="11315" href="StateMachine.Extract.html#11315" class="Bound">tx∈</a> <a id="11319" class="Symbol">:</a> <a id="11321" href="StateMachine.Extract.html#10534" class="Bound">tx</a> <a id="11324" href="UTxO.Validity.html#4108" class="Function Operator">∈′</a> <a id="11327" href="StateMachine.Extract.html#703" class="Bound">L</a><a id="11328" class="Symbol">)</a>
    <a id="11334" class="Symbol">→</a> <a id="11336" class="Symbol">(</a><a id="11337" href="StateMachine.Extract.html#11337" class="Bound">◆∈v</a> <a id="11341" class="Symbol">:</a> <a id="11343" href="UTxO.Value.html#6057" class="Function Operator">◆∈</a> <a id="11346" href="UTxO.Types.html#4906" class="Field">value</a> <a id="11352" href="StateMachine.Extract.html#10537" class="Bound">o</a><a id="11353" class="Symbol">)</a>
    <a id="11359" class="Symbol">→</a> <a id="11361" class="Keyword">let</a> <a id="11365" href="StateMachine.Extract.html#11365" class="Bound">xˢ</a> <a id="11368" class="Symbol">=</a> <a id="11370" href="StateMachine.Extract.html#10702" class="Function">provenanceˢ</a> <a id="11382" href="StateMachine.Extract.html#11315" class="Bound">tx∈</a> <a id="11386" href="StateMachine.Extract.html#11337" class="Bound">◆∈v</a> <a id="11390" class="Keyword">in</a>
    <a id="11397" class="Comment">---------------------------------</a>
    <a id="11435" href="StateMachine.Extract.html#10603" class="Function">source</a> <a id="11442" href="StateMachine.Extract.html#11365" class="Bound">xˢ</a> <a id="11445" href="StateMachine.Inductive.Core.html#593" class="Datatype Operator">↝⋆</a> <a id="11448" href="StateMachine.Extract.html#10610" class="Function">dest</a> <a id="11453" href="StateMachine.Extract.html#11365" class="Bound">xˢ</a>
  <a id="11458" href="StateMachine.Extract.html#11298" class="Function">extract</a> <a id="11466" href="StateMachine.Extract.html#11466" class="Bound">tx∈</a> <a id="11470" href="StateMachine.Extract.html#11470" class="Bound">◆∈v</a> <a id="11474" class="Symbol">=</a> <a id="11476" class="Keyword">let</a> <a id="11480" class="Symbol">_</a> <a id="11482" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="11484" class="Symbol">_</a> <a id="11486" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="11488" class="Symbol">_</a> <a id="11490" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="11492" class="Symbol">_</a> <a id="11494" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="11496" class="Symbol">_</a> <a id="11498" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="11500" class="Symbol">_</a> <a id="11502" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="11504" href="StateMachine.Extract.html#11504" class="Bound">xˢ</a> <a id="11507" class="Symbol">=</a> <a id="11509" href="StateMachine.Extract.html#10702" class="Function">provenanceˢ</a> <a id="11521" href="StateMachine.Extract.html#11466" class="Bound">tx∈</a> <a id="11525" href="StateMachine.Extract.html#11470" class="Bound">◆∈v</a>
                    <a id="11549" class="Keyword">in</a>  <a id="11553" href="StateMachine.Extract.html#10088" class="Function">Xˢ→R</a> <a id="11558" href="StateMachine.Extract.html#11504" class="Bound">xˢ</a>
</pre></body></html>