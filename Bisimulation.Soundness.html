<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Bisimulation.Soundness</title><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css'/><style>.github-fork-ribbon:before { background-color: #333; }</style><link rel="stylesheet" href="css/Agda.css"></head><body><a class='github-fork-ribbon'href='https://github.com/omelkonian/formal-utxo/tree/master///Bisimulation/Soundness.agda'data-ribbon='Source code on Github' title='Source code on Github'>Source code on Github</a><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Data.List.Membership.Propositional.Properties.html" class="Module">Data.List.Membership.Propositional.Properties</a> <a id="59" class="Keyword">using</a> <a id="65" class="Symbol">(</a><a id="66" href="Data.List.Membership.Propositional.Properties.html#3377" class="Function">∈-map⁺</a><a id="72" class="Symbol">;</a> <a id="74" href="Data.List.Membership.Propositional.Properties.html#8500" class="Function">∈-filter⁺</a><a id="83" class="Symbol">;</a> <a id="85" href="Data.List.Membership.Propositional.Properties.html#4054" class="Function">∈-++⁺ʳ</a><a id="91" class="Symbol">)</a>

<a id="94" class="Keyword">open</a> <a id="99" class="Keyword">import</a> <a id="106" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="119" class="Keyword">open</a> <a id="124" class="Keyword">import</a> <a id="131" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="147" class="Keyword">open</a> <a id="152" class="Keyword">import</a> <a id="159" href="Prelude.Lists.html" class="Module">Prelude.Lists</a>
<a id="173" class="Keyword">open</a> <a id="178" class="Keyword">import</a> <a id="185" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="199" class="Keyword">open</a> <a id="204" class="Keyword">import</a> <a id="211" href="Prelude.Sets.html" class="Module">Prelude.Sets</a>
<a id="224" class="Keyword">open</a> <a id="229" class="Keyword">import</a> <a id="236" href="Prelude.Membership.html" class="Module">Prelude.Membership</a>
<a id="255" class="Keyword">open</a> <a id="260" class="Keyword">import</a> <a id="267" href="Prelude.ToN.html" class="Module">Prelude.ToN</a>
<a id="279" class="Keyword">open</a> <a id="284" class="Keyword">import</a> <a id="291" href="Prelude.Bifunctor.html" class="Module">Prelude.Bifunctor</a>
<a id="309" class="Keyword">open</a> <a id="314" class="Keyword">import</a> <a id="321" href="Prelude.Applicative.html" class="Module">Prelude.Applicative</a>
<a id="341" class="Keyword">open</a> <a id="346" class="Keyword">import</a> <a id="353" href="Prelude.Monad.html" class="Module">Prelude.Monad</a>

<a id="368" class="Keyword">open</a> <a id="373" class="Keyword">import</a> <a id="380" href="UTxO.Hashing.html" class="Module">UTxO.Hashing</a>
<a id="393" class="Keyword">open</a> <a id="398" class="Keyword">import</a> <a id="405" href="UTxO.Value.html" class="Module">UTxO.Value</a>
<a id="416" class="Keyword">open</a> <a id="421" class="Keyword">import</a> <a id="428" href="UTxO.Types.html" class="Module">UTxO.Types</a> <a id="439" class="Keyword">hiding</a> <a id="446" class="Symbol">(</a><a id="447" href="UTxO.Types.html#925" class="InductiveConstructor">I</a><a id="448" class="Symbol">)</a>
<a id="450" class="Keyword">open</a> <a id="455" class="Keyword">import</a> <a id="462" href="UTxO.TxUtilities.html" class="Module">UTxO.TxUtilities</a> <a id="479" class="Keyword">hiding</a> <a id="486" class="Symbol">(</a><a id="487" href="UTxO.TxUtilities.html#623" class="Field">prevTx</a><a id="493" class="Symbol">)</a>
<a id="495" class="Keyword">open</a> <a id="500" class="Keyword">import</a> <a id="507" href="UTxO.Validity.html" class="Module">UTxO.Validity</a>
<a id="521" class="Keyword">open</a> <a id="526" class="Keyword">import</a> <a id="533" href="StateMachine.Base.html" class="Module">StateMachine.Base</a>

<a id="552" class="Keyword">open</a> <a id="557" href="UTxO.Types.html#4637" class="Module">InputInfo</a>

<a id="568" class="Keyword">module</a> <a id="575" href="Bisimulation.Soundness.html" class="Module">Bisimulation.Soundness</a>
  <a id="600" class="Symbol">{</a><a id="601" href="Bisimulation.Soundness.html#601" class="Bound">S</a> <a id="603" href="Bisimulation.Soundness.html#603" class="Bound">I</a> <a id="605" class="Symbol">:</a> <a id="607" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="610" class="Symbol">}</a> <a id="612" class="Symbol">{{</a><a id="614" href="Bisimulation.Soundness.html#614" class="Bound">_</a> <a id="616" class="Symbol">:</a> <a id="618" href="UTxO.Types.html#1155" class="Record">IsData</a> <a id="625" href="Bisimulation.Soundness.html#601" class="Bound">S</a><a id="626" class="Symbol">}}</a> <a id="629" class="Symbol">{{</a><a id="631" href="Bisimulation.Soundness.html#631" class="Bound">_</a> <a id="633" class="Symbol">:</a> <a id="635" href="UTxO.Types.html#1155" class="Record">IsData</a> <a id="642" href="Bisimulation.Soundness.html#603" class="Bound">I</a><a id="643" class="Symbol">}}</a> <a id="646" class="Symbol">{</a><a id="647" href="Bisimulation.Soundness.html#647" class="Bound">sm</a> <a id="650" class="Symbol">:</a> <a id="652" href="StateMachine.Base.html#1973" class="Record">StateMachine</a> <a id="665" href="Bisimulation.Soundness.html#601" class="Bound">S</a> <a id="667" href="Bisimulation.Soundness.html#603" class="Bound">I</a><a id="668" class="Symbol">}</a>
  <a id="672" class="Keyword">where</a>

<a id="679" class="Keyword">open</a> <a id="684" href="StateMachine.Base.html#2219" class="Module">CEM</a> <a id="688" class="Symbol">{</a><a id="689" class="Argument">sm</a> <a id="692" class="Symbol">=</a> <a id="694" href="Bisimulation.Soundness.html#647" class="Bound">sm</a><a id="696" class="Symbol">}</a>
<a id="698" class="Keyword">open</a> <a id="703" class="Keyword">import</a> <a id="710" href="Bisimulation.Base.html" class="Module">Bisimulation.Base</a> <a id="728" class="Symbol">{</a><a id="729" class="Argument">sm</a> <a id="732" class="Symbol">=</a> <a id="734" href="Bisimulation.Soundness.html#647" class="Bound">sm</a><a id="736" class="Symbol">}</a>
<a id="738" class="Keyword">open</a> <a id="743" href="Relation.Binary.PropositionalEquality.Core.html#2717" class="Module">≡-Reasoning</a>

<a id="soundness"></a><a id="756" href="Bisimulation.Soundness.html#756" class="Function">soundness</a> <a id="766" class="Symbol">:</a> <a id="768" class="Symbol">∀</a> <a id="770" class="Symbol">{</a><a id="771" href="Bisimulation.Soundness.html#771" class="Bound">s</a> <a id="773" href="Bisimulation.Soundness.html#773" class="Bound">i</a> <a id="775" href="Bisimulation.Soundness.html#775" class="Bound">s′</a> <a id="778" href="Bisimulation.Soundness.html#778" class="Bound">tx≡</a> <a id="782" href="Bisimulation.Soundness.html#782" class="Bound">l</a><a id="783" class="Symbol">}</a> <a id="785" class="Symbol">{</a><a id="786" href="Bisimulation.Soundness.html#786" class="Bound">vl</a> <a id="789" class="Symbol">:</a> <a id="791" href="UTxO.Validity.html#2261" class="Datatype">ValidLedger</a> <a id="803" href="Bisimulation.Soundness.html#782" class="Bound">l</a><a id="804" class="Symbol">}</a>
<a id="806" class="Comment">--  → finalₛₘ s′ ≡ false</a>
  <a id="833" class="Symbol">→</a> <a id="835" href="Bisimulation.Soundness.html#771" class="Bound">s</a> <a id="837" href="Bisimulation.Base.html#578" class="Function Operator">—→[</a> <a id="841" href="Bisimulation.Soundness.html#773" class="Bound">i</a> <a id="843" href="Bisimulation.Base.html#578" class="Function Operator">]</a> <a id="845" class="Symbol">(</a><a id="846" href="Bisimulation.Soundness.html#775" class="Bound">s′</a> <a id="849" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="851" href="Bisimulation.Soundness.html#778" class="Bound">tx≡</a><a id="854" class="Symbol">)</a>
  <a id="858" class="Symbol">→</a> <a id="860" class="Symbol">(</a><a id="861" href="Bisimulation.Soundness.html#861" class="Bound">vl~s</a> <a id="866" class="Symbol">:</a> <a id="868" href="Bisimulation.Soundness.html#786" class="Bound">vl</a> <a id="871" href="Bisimulation.Base.html#835" class="Function Operator">~</a> <a id="873" href="Bisimulation.Soundness.html#771" class="Bound">s</a><a id="874" class="Symbol">)</a>
  <a id="878" class="Symbol">→</a> <a id="880" href="Bisimulation.Base.html#2662" class="Function">Satisfiable</a> <a id="892" class="Symbol">{</a><a id="893" class="Argument">vl</a> <a id="896" class="Symbol">=</a> <a id="898" href="Bisimulation.Soundness.html#786" class="Bound">vl</a><a id="900" class="Symbol">}</a> <a id="902" href="Bisimulation.Soundness.html#778" class="Bound">tx≡</a> <a id="906" href="Bisimulation.Soundness.html#861" class="Bound">vl~s</a>
    <a id="915" class="Comment">--------------------------------</a>
  <a id="950" class="Symbol">→</a> <a id="952" href="Data.Product.html#1815" class="Function">∃[</a> <a id="955" href="Bisimulation.Soundness.html#955" class="Bound">tx</a> <a id="958" href="Data.Product.html#1815" class="Function">]</a> <a id="960" href="Data.Product.html#1815" class="Function">∃[</a> <a id="963" href="Bisimulation.Soundness.html#963" class="Bound">vtx</a> <a id="967" href="Data.Product.html#1815" class="Function">]</a> <a id="969" href="Data.Product.html#1815" class="Function">∃[</a> <a id="972" href="Bisimulation.Soundness.html#972" class="Bound">vl′</a> <a id="976" href="Data.Product.html#1815" class="Function">]</a>
      <a id="984" class="Symbol">(</a> <a id="986" href="Bisimulation.Soundness.html#786" class="Bound">vl</a> <a id="989" href="Bisimulation.Base.html#695" class="Function Operator">—→[</a> <a id="993" href="Bisimulation.Soundness.html#955" class="Bound">tx</a> <a id="996" href="Bisimulation.Base.html#695" class="Function Operator">∶-</a> <a id="999" href="Bisimulation.Soundness.html#963" class="Bound">vtx</a> <a id="1003" href="Bisimulation.Base.html#695" class="Function Operator">]</a> <a id="1005" href="Bisimulation.Soundness.html#972" class="Bound">vl′</a>
      <a id="1015" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="1017" href="Bisimulation.Soundness.html#972" class="Bound">vl′</a> <a id="1021" href="Bisimulation.Base.html#835" class="Function Operator">~</a> <a id="1023" href="Bisimulation.Soundness.html#775" class="Bound">s′</a>
      <a id="1032" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="1034" class="Symbol">(</a><a id="1035" href="StateMachine.Base.html#1796" class="Function">verifyTx</a> <a id="1044" href="Bisimulation.Soundness.html#782" class="Bound">l</a> <a id="1046" href="Bisimulation.Soundness.html#955" class="Bound">tx</a> <a id="1049" href="Bisimulation.Soundness.html#778" class="Bound">tx≡</a> <a id="1053" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1055" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="1059" class="Symbol">)</a> <a id="1061" class="Symbol">)</a>

<a id="1064" href="Bisimulation.Soundness.html#756" class="Function">soundness</a> <a id="1074" class="Symbol">{</a><a id="1075" href="Bisimulation.Soundness.html#1075" class="Bound">s</a><a id="1076" class="Symbol">}</a> <a id="1078" class="Symbol">{</a><a id="1079" href="Bisimulation.Soundness.html#1079" class="Bound">i</a><a id="1080" class="Symbol">}</a> <a id="1082" class="Symbol">{</a><a id="1083" href="Bisimulation.Soundness.html#1083" class="Bound">s′</a><a id="1085" class="Symbol">}</a> <a id="1087" class="Symbol">{</a><a id="1088" href="Bisimulation.Soundness.html#1088" class="Bound">tx≡</a><a id="1091" class="Symbol">}</a> <a id="1093" class="Symbol">{</a><a id="1094" href="Bisimulation.Soundness.html#1094" class="Bound">l</a><a id="1095" class="Symbol">}</a> <a id="1097" class="Symbol">{</a><a id="1098" href="Bisimulation.Soundness.html#1098" class="Bound">vl</a><a id="1100" class="Symbol">}</a> <a id="1102" class="Comment">{- final≡ -}</a> <a id="1115" href="Bisimulation.Soundness.html#1115" class="Bound">s→s′</a> <a id="1120" href="Bisimulation.Soundness.html#1120" class="Bound">vl~s</a> <a id="1125" href="Bisimulation.Soundness.html#1125" class="Bound">sat</a><a id="1128" class="Symbol">@(</a><a id="1130" href="Bisimulation.Soundness.html#1130" class="Bound">range∋</a> <a id="1137" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1139" href="Bisimulation.Soundness.html#1139" class="Bound">sp≥</a> <a id="1143" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1145" href="Bisimulation.Soundness.html#1145" class="Bound">apv</a><a id="1148" class="Symbol">)</a>
<a id="1150" class="Comment">-- *** Due to Agda bug, see https://github.com/personal-practice/agda/blob/master/bugs/With.agda</a>
<a id="1247" class="Comment">--   with mkTx {l} {s} {s′} {i} {vl} {vl~s} tx≡ sat</a>
<a id="1299" class="Comment">-- ... | tx , verify≡</a>
<a id="1321" class="Comment">--   with view-~ {vl = vl} vl~s</a>
<a id="1353" class="Comment">-- ... | prevTx , v , prevOut∈ , u∈ , prev∈ , prev∈utxo , getSpent≡ , threadToken≡</a>
  <a id="1438" class="Symbol">=</a> <a id="1440" href="Bisimulation.Soundness.html#2161" class="Function">tx</a> <a id="1443" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1445" href="Bisimulation.Soundness.html#2677" class="Function">vtx</a> <a id="1449" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1451" href="Bisimulation.Soundness.html#6184" class="Function">vl′</a> <a id="1455" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1457" href="Bisimulation.Soundness.html#6241" class="Function">vl→vl′</a> <a id="1464" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1466" href="Bisimulation.Soundness.html#6296" class="Function">vl′~s′</a> <a id="1473" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1475" href="Bisimulation.Soundness.html#2185" class="Function">verify≡</a>
  <a id="1485" class="Keyword">where</a>
    <a id="1495" class="Comment">-- *** Manually deconstructing here instead</a>
    <a id="1543" href="Bisimulation.Soundness.html#1543" class="Function">view</a>         <a id="1556" class="Symbol">=</a> <a id="1558" href="Bisimulation.Base.html#1370" class="Function">view-~</a> <a id="1565" class="Symbol">{</a><a id="1566" class="Argument">vl</a> <a id="1569" class="Symbol">=</a> <a id="1571" href="Bisimulation.Soundness.html#1098" class="Bound">vl</a><a id="1573" class="Symbol">}</a> <a id="1575" href="Bisimulation.Soundness.html#1120" class="Bound">vl~s</a>
    <a id="1584" href="Bisimulation.Soundness.html#1584" class="Function">prevTx</a>       <a id="1597" class="Symbol">=</a> <a id="1599" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="1605" href="Bisimulation.Soundness.html#1543" class="Function">view</a>
    <a id="1614" href="Bisimulation.Soundness.html#1614" class="Function">v</a>            <a id="1627" class="Symbol">=</a> <a id="1629" class="Symbol">(</a><a id="1630" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="1636" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1638" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a><a id="1643" class="Symbol">)</a> <a id="1645" href="Bisimulation.Soundness.html#1543" class="Function">view</a>
    <a id="1654" href="Bisimulation.Soundness.html#1654" class="Function">prevOut∈</a>     <a id="1667" class="Symbol">=</a> <a id="1669" class="Symbol">(</a><a id="1670" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="1676" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1678" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1684" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1686" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a><a id="1691" class="Symbol">)</a> <a id="1693" href="Bisimulation.Soundness.html#1543" class="Function">view</a>
    <a id="1702" href="Bisimulation.Soundness.html#1702" class="Function">u∈</a>           <a id="1715" class="Symbol">=</a> <a id="1717" class="Symbol">(</a><a id="1718" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="1724" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1726" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1732" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1734" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1740" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1742" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a><a id="1747" class="Symbol">)</a> <a id="1749" href="Bisimulation.Soundness.html#1543" class="Function">view</a>
    <a id="1758" href="Bisimulation.Soundness.html#1758" class="Function">prev∈</a>        <a id="1771" class="Symbol">=</a> <a id="1773" class="Symbol">(</a><a id="1774" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="1780" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1782" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1788" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1790" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1796" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1798" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1804" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1806" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a><a id="1811" class="Symbol">)</a> <a id="1813" href="Bisimulation.Soundness.html#1543" class="Function">view</a>
    <a id="1822" href="Bisimulation.Soundness.html#1822" class="Function">prev∈utxo</a>    <a id="1835" class="Symbol">=</a> <a id="1837" class="Symbol">(</a><a id="1838" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="1844" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1846" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1852" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1854" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1860" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1862" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1868" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1870" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1876" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1878" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a><a id="1883" class="Symbol">)</a> <a id="1885" href="Bisimulation.Soundness.html#1543" class="Function">view</a>
    <a id="1894" href="Bisimulation.Soundness.html#1894" class="Function">getSpent≡</a>    <a id="1907" class="Symbol">=</a> <a id="1909" class="Symbol">(</a><a id="1910" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="1916" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1918" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1924" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1926" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1932" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1934" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1940" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1942" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1948" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1950" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1956" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1958" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a><a id="1963" class="Symbol">)</a> <a id="1965" href="Bisimulation.Soundness.html#1543" class="Function">view</a>
    <a id="1974" href="Bisimulation.Soundness.html#1974" class="Function">threadToken≡</a> <a id="1987" class="Symbol">=</a> <a id="1989" class="Symbol">(</a><a id="1990" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="1996" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1998" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="2004" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2006" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="2012" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2014" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="2020" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2022" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="2028" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2030" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="2036" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2038" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a><a id="2043" class="Symbol">)</a> <a id="2045" href="Bisimulation.Soundness.html#1543" class="Function">view</a>

    <a id="2055" href="Bisimulation.Soundness.html#2055" class="Function">tx′</a> <a id="2059" class="Symbol">:</a> <a id="2061" href="Data.Product.html#925" class="Function">Σ[</a> <a id="2064" href="Bisimulation.Soundness.html#2064" class="Bound">tx</a> <a id="2067" href="Data.Product.html#925" class="Function">∈</a> <a id="2069" href="UTxO.Types.html#7568" class="Record">Tx</a> <a id="2072" href="Data.Product.html#925" class="Function">]</a> <a id="2074" class="Symbol">(</a><a id="2075" href="StateMachine.Base.html#1796" class="Function">verifyTx</a> <a id="2084" href="Bisimulation.Soundness.html#1094" class="Bound">l</a> <a id="2086" href="Bisimulation.Soundness.html#2064" class="Bound">tx</a> <a id="2089" href="Bisimulation.Soundness.html#1088" class="Bound">tx≡</a> <a id="2093" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="2095" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="2099" class="Symbol">)</a>
    <a id="2105" href="Bisimulation.Soundness.html#2055" class="Function">tx′</a>     <a id="2113" class="Symbol">=</a> <a id="2115" href="Bisimulation.Base.html#3054" class="Function">mkTx</a> <a id="2120" class="Symbol">{</a><a id="2121" href="Bisimulation.Soundness.html#1094" class="Bound">l</a><a id="2122" class="Symbol">}</a> <a id="2124" class="Symbol">{</a><a id="2125" href="Bisimulation.Soundness.html#1075" class="Bound">s</a><a id="2126" class="Symbol">}</a> <a id="2128" class="Symbol">{</a><a id="2129" href="Bisimulation.Soundness.html#1083" class="Bound">s′</a><a id="2131" class="Symbol">}</a> <a id="2133" class="Symbol">{</a><a id="2134" href="Bisimulation.Soundness.html#1079" class="Bound">i</a><a id="2135" class="Symbol">}</a> <a id="2137" class="Symbol">{</a><a id="2138" href="Bisimulation.Soundness.html#1098" class="Bound">vl</a><a id="2140" class="Symbol">}</a> <a id="2142" class="Symbol">{</a><a id="2143" href="Bisimulation.Soundness.html#1120" class="Bound">vl~s</a><a id="2147" class="Symbol">}</a> <a id="2149" href="Bisimulation.Soundness.html#1088" class="Bound">tx≡</a> <a id="2153" href="Bisimulation.Soundness.html#1125" class="Bound">sat</a>
    <a id="2161" href="Bisimulation.Soundness.html#2161" class="Function">tx</a>      <a id="2169" class="Symbol">=</a> <a id="2171" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="2177" href="Bisimulation.Soundness.html#2055" class="Function">tx′</a>
    <a id="2185" href="Bisimulation.Soundness.html#2185" class="Function">verify≡</a> <a id="2193" class="Symbol">=</a> <a id="2195" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="2201" href="Bisimulation.Soundness.html#2055" class="Function">tx′</a>

    <a id="2210" class="Comment">-- *** Constants</a>

    <a id="2232" href="Bisimulation.Soundness.html#2232" class="Function">prevOut</a>   <a id="2242" class="Symbol">=</a> <a id="2244" href="Bisimulation.Soundness.html#1075" class="Bound">s</a> <a id="2246" href="StateMachine.Base.html#4062" class="Function Operator">—→</a> <a id="2249" href="Bisimulation.Soundness.html#1614" class="Function">v</a>
    <a id="2255" href="Bisimulation.Soundness.html#2255" class="Function">prevTxRef</a> <a id="2265" class="Symbol">=</a> <a id="2267" class="Symbol">(</a><a id="2268" href="Bisimulation.Soundness.html#1584" class="Function">prevTx</a> <a id="2275" href="UTxO.Hashing.Types.html#1170" class="Function Operator">♯ₜₓ</a><a id="2278" class="Symbol">)</a> <a id="2280" href="UTxO.Types.html#4242" class="InductiveConstructor Operator">indexed-at</a> <a id="2291" href="Prelude.ToN.html#139" class="Field">toℕ</a> <a id="2295" class="Symbol">(</a><a id="2296" href="Data.List.Relation.Unary.Any.html#1826" class="Function">L.Any.index</a> <a id="2308" href="Bisimulation.Soundness.html#1654" class="Function">prevOut∈</a><a id="2316" class="Symbol">)</a>
    <a id="2322" href="Bisimulation.Soundness.html#2322" class="Function">txIn</a>      <a id="2332" class="Symbol">=</a> <a id="2334" href="Bisimulation.Soundness.html#2255" class="Function">prevTxRef</a> <a id="2344" href="StateMachine.Base.html#3825" class="Function Operator">←—</a> <a id="2347" class="Symbol">(</a><a id="2348" href="Bisimulation.Soundness.html#1079" class="Bound">i</a> <a id="2350" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2352" href="Bisimulation.Soundness.html#1075" class="Bound">s</a><a id="2353" class="Symbol">)</a>
    <a id="2359" href="Bisimulation.Soundness.html#2359" class="Function">forge′</a>    <a id="2369" class="Symbol">=</a> <a id="2371" href="UTxO.Types.html#7735" class="Field">forge</a> <a id="2377" href="Bisimulation.Soundness.html#2161" class="Function">tx</a>

    <a id="2385" href="Bisimulation.Soundness.html#2385" class="Function">di</a>  <a id="2389" class="Symbol">=</a> <a id="2391" href="UTxO.Types.html#1196" class="Field">toData</a> <a id="2398" href="Bisimulation.Soundness.html#1079" class="Bound">i</a>
    <a id="2404" href="Bisimulation.Soundness.html#2404" class="Function">ds</a>  <a id="2408" class="Symbol">=</a> <a id="2410" href="UTxO.Types.html#1196" class="Field">toData</a> <a id="2417" href="Bisimulation.Soundness.html#1075" class="Bound">s</a>
    <a id="2423" href="Bisimulation.Soundness.html#2423" class="Function">ds′</a> <a id="2427" class="Symbol">=</a> <a id="2429" href="UTxO.Types.html#1196" class="Field">toData</a> <a id="2436" href="Bisimulation.Soundness.html#1083" class="Bound">s′</a>

    <a id="2444" href="Bisimulation.Soundness.html#2444" class="Function">txOut</a> <a id="2450" class="Symbol">:</a> <a id="2452" href="UTxO.Types.html#4814" class="Record">TxOutput</a>
    <a id="2465" href="Bisimulation.Soundness.html#2444" class="Function">txOut</a> <a id="2471" class="Symbol">=</a> <a id="2473" class="Keyword">record</a>
      <a id="2486" class="Symbol">{</a> <a id="2488" href="UTxO.Types.html#4906" class="Field">value</a>     <a id="2498" class="Symbol">=</a> <a id="2500" href="Bisimulation.Soundness.html#2359" class="Function">forge′</a> <a id="2507" href="UTxO.Value.html#2000" class="Function Operator">+ᶜ</a> <a id="2510" href="Bisimulation.Soundness.html#1614" class="Function">v</a>
      <a id="2518" class="Symbol">;</a> <a id="2520" href="UTxO.Types.html#4847" class="Field">address</a>   <a id="2530" class="Symbol">=</a> <a id="2532" href="StateMachine.Base.html#3741" class="Function">𝕍</a>
      <a id="2540" class="Symbol">;</a> <a id="2542" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="2552" class="Symbol">=</a> <a id="2554" href="Bisimulation.Soundness.html#2423" class="Function">ds′</a> <a id="2558" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a> <a id="2561" class="Symbol">}</a>

    <a id="2568" href="Bisimulation.Soundness.html#2568" class="Function">ptx</a>   <a id="2574" class="Symbol">=</a> <a id="2576" href="UTxO.TxUtilities.html#6140" class="Function">toPendingTx</a> <a id="2588" href="Bisimulation.Soundness.html#1094" class="Bound">l</a> <a id="2590" href="Bisimulation.Soundness.html#2161" class="Function">tx</a> <a id="2593" href="Data.Fin.Patterns.html#399" class="InductiveConstructor">0F</a>
    <a id="2600" href="Bisimulation.Soundness.html#2600" class="Function">txi</a>   <a id="2606" class="Symbol">=</a> <a id="2608" href="UTxO.Types.html#5368" class="Field">txInfo</a> <a id="2615" href="Bisimulation.Soundness.html#2568" class="Function">ptx</a>
    <a id="2623" href="Bisimulation.Soundness.html#2623" class="Function">ptxIn</a> <a id="2629" class="Symbol">=</a> <a id="2631" href="UTxO.TxUtilities.html#5592" class="Function">mkInputInfo</a> <a id="2643" href="Bisimulation.Soundness.html#1094" class="Bound">l</a> <a id="2645" href="Bisimulation.Soundness.html#2322" class="Function">txIn</a>

    <a id="2655" class="Comment">-- *** Valididty</a>

    <a id="2677" href="Bisimulation.Soundness.html#2677" class="Function">vtx</a> <a id="2681" class="Symbol">:</a> <a id="2683" href="UTxO.Validity.html#1336" class="Record">IsValidTx</a> <a id="2693" href="Bisimulation.Soundness.html#2161" class="Function">tx</a> <a id="2696" href="Bisimulation.Soundness.html#1094" class="Bound">l</a>
    <a id="2702" href="UTxO.Validity.html#1420" class="Field">withinInterval</a>      <a id="2722" href="Bisimulation.Soundness.html#2677" class="Function">vtx</a>
      <a id="2732" class="Keyword">with</a> <a id="2737" href="StateMachine.Base.html#1242" class="Field">range≡</a> <a id="2744" href="Bisimulation.Soundness.html#1088" class="Bound">tx≡</a>
    <a id="2752" class="Symbol">...</a> <a id="2756" class="Symbol">|</a> <a id="2758" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="2766" class="Symbol">=</a> <a id="2768" href="Agda.Builtin.Unit.html#195" class="InductiveConstructor">tt</a>
    <a id="2775" class="Symbol">...</a> <a id="2779" class="Symbol">|</a> <a id="2781" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="2786" class="Symbol">_</a>  <a id="2789" class="Keyword">rewrite</a> <a id="2797" href="Bisimulation.Soundness.html#1130" class="Bound">range∋</a> <a id="2804" class="Symbol">=</a> <a id="2806" href="Agda.Builtin.Unit.html#195" class="InductiveConstructor">tt</a>

    <a id="2814" href="UTxO.Validity.html#1472" class="Field">validOutputRefs</a>     <a id="2834" href="Bisimulation.Soundness.html#2677" class="Function">vtx</a> <a id="2838" class="Symbol">(</a><a id="2839" href="Data.List.Relation.Unary.Any.html#1228" class="InductiveConstructor">here</a> <a id="2844" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a><a id="2848" class="Symbol">)</a> <a id="2850" class="Symbol">=</a> <a id="2852" href="Bisimulation.Soundness.html#1822" class="Function">prev∈utxo</a>
    <a id="2866" href="UTxO.Validity.html#1472" class="Field">validOutputRefs</a>     <a id="2886" href="Bisimulation.Soundness.html#2677" class="Function">vtx</a> <a id="2890" class="Symbol">(</a><a id="2891" href="Data.List.Relation.Unary.Any.html#1281" class="InductiveConstructor">there</a> <a id="2897" class="Symbol">())</a>

    <a id="2906" href="UTxO.Validity.html#1537" class="Field">preservesValues</a>     <a id="2926" href="Bisimulation.Soundness.html#2677" class="Function">vtx</a>
      <a id="2936" class="Keyword">rewrite</a> <a id="2944" href="Bisimulation.Soundness.html#1894" class="Function">getSpent≡</a>
            <a id="2966" class="Symbol">=</a> <a id="2968" href="Data.Maybe.Relation.Unary.Any.html#909" class="InductiveConstructor">M.Any.just</a> <a id="2979" class="Symbol">(</a><a id="2980" href="UTxO.Value.html#8488" class="Function">x+ᶜy+ᶜ0≡x+ᶜy+0</a> <a id="2995" class="Symbol">{</a><a id="2996" class="Argument">x</a> <a id="2998" class="Symbol">=</a> <a id="3000" href="Bisimulation.Soundness.html#2359" class="Function">forge′</a><a id="3006" class="Symbol">}</a> <a id="3008" class="Symbol">{</a><a id="3009" class="Argument">y</a> <a id="3011" class="Symbol">=</a> <a id="3013" href="Bisimulation.Soundness.html#1614" class="Function">v</a><a id="3014" class="Symbol">})</a>

    <a id="3022" href="UTxO.Validity.html#1677" class="Field">noDoubleSpending</a>    <a id="3042" href="Bisimulation.Soundness.html#2677" class="Function">vtx</a> <a id="3046" class="Symbol">=</a> <a id="3048" href="Data.List.Relation.Unary.All.html#1516" class="InductiveConstructor">[]</a> <a id="3051" href="Data.List.Relation.Unary.AllPairs.Core.html#1010" class="InductiveConstructor Operator">∷</a> <a id="3053" href="Data.List.Relation.Unary.AllPairs.Core.html#990" class="InductiveConstructor">[]</a>

    <a id="3061" href="UTxO.Validity.html#1730" class="Field">allInputsValidate</a>   <a id="3081" href="Bisimulation.Soundness.html#2677" class="Function">vtx</a> <a id="3085" class="Symbol">=</a> <a id="3087" href="Prelude.General.html#4098" class="Function">true⇒T</a> <a id="3094" href="Bisimulation.Soundness.html#5364" class="Function">validate≡</a> <a id="3104" href="Data.List.Relation.Unary.All.html#1533" class="InductiveConstructor Operator">∷</a> <a id="3106" href="Data.List.Relation.Unary.All.html#1516" class="InductiveConstructor">[]</a>
      <a id="3115" class="Keyword">where</a>
        <a id="3129" href="Bisimulation.Soundness.html#3129" class="Function">runStep≡</a> <a id="3138" class="Symbol">:</a> <a id="3140" href="Prelude.Monad.html#909" class="Function">join</a> <a id="3145" class="Symbol">⦇</a> <a id="3147" href="StateMachine.Base.html#2332" class="Function">stepₛₘ</a> <a id="3154" class="Symbol">(</a><a id="3155" href="UTxO.Types.html#1220" class="Field">fromData</a> <a id="3164" href="Bisimulation.Soundness.html#2404" class="Function">ds</a><a id="3166" class="Symbol">)</a> <a id="3168" class="Symbol">(</a><a id="3169" href="UTxO.Types.html#1220" class="Field">fromData</a> <a id="3178" href="Bisimulation.Soundness.html#2385" class="Function">di</a><a id="3180" class="Symbol">)</a> <a id="3182" class="Symbol">⦈</a> <a id="3184" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="3186" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3191" class="Symbol">(</a><a id="3192" href="Bisimulation.Soundness.html#1083" class="Bound">s′</a> <a id="3195" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3197" href="Bisimulation.Soundness.html#1088" class="Bound">tx≡</a><a id="3200" class="Symbol">)</a>
        <a id="3210" href="Bisimulation.Soundness.html#3129" class="Function">runStep≡</a> <a id="3219" class="Keyword">rewrite</a> <a id="3227" href="UTxO.Types.html#1250" class="Field">from∘to</a> <a id="3235" href="Bisimulation.Soundness.html#1075" class="Bound">s</a> <a id="3237" class="Symbol">|</a> <a id="3239" href="UTxO.Types.html#1250" class="Field">from∘to</a> <a id="3247" href="Bisimulation.Soundness.html#1079" class="Bound">i</a> <a id="3249" class="Symbol">|</a> <a id="3251" href="Bisimulation.Soundness.html#1115" class="Bound">s→s′</a> <a id="3256" class="Symbol">=</a> <a id="3258" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>

        <a id="3272" href="Bisimulation.Soundness.html#3272" class="Function">thisVal≡</a> <a id="3281" class="Symbol">:</a> <a id="3283" href="UTxO.Types.html#5756" class="Function">thisValidator</a> <a id="3297" href="Bisimulation.Soundness.html#2568" class="Function">ptx</a> <a id="3301" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="3303" href="StateMachine.Base.html#3741" class="Function">𝕍</a>
        <a id="3313" href="Bisimulation.Soundness.html#3272" class="Function">thisVal≡</a> <a id="3322" class="Symbol">=</a> <a id="3324" href="Relation.Binary.PropositionalEquality.Core.html#1139" class="Function">cong</a> <a id="3329" href="UTxO.Types.html#4703" class="Field">InputInfo.validatorHash</a> <a id="3353" class="Symbol">(</a><a id="3354" href="UTxO.TxUtilities.html#6448" class="Function">ptx-‼</a> <a id="3360" class="Symbol">{</a><a id="3361" href="Bisimulation.Soundness.html#1094" class="Bound">l</a><a id="3362" class="Symbol">}</a> <a id="3364" class="Symbol">{</a><a id="3365" href="Bisimulation.Soundness.html#2161" class="Function">tx</a><a id="3367" class="Symbol">}</a> <a id="3369" class="Symbol">{</a><a id="3370" href="Bisimulation.Soundness.html#2322" class="Function">txIn</a><a id="3374" class="Symbol">}</a> <a id="3376" class="Symbol">{</a><a id="3377" href="Data.List.Relation.Unary.Any.html#1228" class="InductiveConstructor">here</a> <a id="3382" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a><a id="3386" class="Symbol">})</a>

        <a id="3398" href="Bisimulation.Soundness.html#3398" class="Function">inputs≡</a> <a id="3406" class="Symbol">:</a> <a id="3408" href="UTxO.Types.html#5983" class="Function">inputsAt</a> <a id="3417" href="StateMachine.Base.html#3741" class="Function">𝕍</a> <a id="3419" href="Bisimulation.Soundness.html#2600" class="Function">txi</a> <a id="3423" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="3425" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="3427" href="Bisimulation.Soundness.html#2623" class="Function">ptxIn</a> <a id="3433" href="Data.List.Base.html#5034" class="Function Operator">]</a>
        <a id="3443" href="Bisimulation.Soundness.html#3398" class="Function">inputs≡</a> <a id="3451" class="Symbol">=</a> <a id="3453" href="Prelude.General.html#6021" class="Function">filter-singleton</a> <a id="3470" class="Symbol">{</a><a id="3471" class="Argument">P?</a> <a id="3474" class="Symbol">=</a> <a id="3476" class="Symbol">(</a><a id="3477" href="StateMachine.Base.html#3741" class="Function">𝕍</a> <a id="3479" href="Prelude.DecEq.Core.html#190" class="Field Operator">≟_</a><a id="3481" class="Symbol">)</a> <a id="3483" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="3485" href="UTxO.Types.html#4703" class="Field">InputInfo.validatorHash</a><a id="3508" class="Symbol">}</a> <a id="3510" class="Symbol">(</a><a id="3511" href="Prelude.DecEq.WithK.html#170" class="Function">≟-refl</a> <a id="3518" href="StateMachine.Base.html#3741" class="Function">𝕍</a><a id="3519" class="Symbol">)</a>

        <a id="3530" href="Bisimulation.Soundness.html#3530" class="Function">outputs≡</a> <a id="3539" class="Symbol">:</a> <a id="3541" href="UTxO.Types.html#6102" class="Function">outputsAt</a> <a id="3551" href="StateMachine.Base.html#3741" class="Function">𝕍</a> <a id="3553" href="Bisimulation.Soundness.html#2600" class="Function">txi</a> <a id="3557" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="3559" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="3561" href="Bisimulation.Soundness.html#2444" class="Function">txOut</a> <a id="3567" href="Data.List.Base.html#5034" class="Function Operator">]</a>
        <a id="3577" href="Bisimulation.Soundness.html#3530" class="Function">outputs≡</a> <a id="3586" class="Symbol">=</a> <a id="3588" href="Prelude.General.html#6021" class="Function">filter-singleton</a> <a id="3605" class="Symbol">{</a><a id="3606" class="Argument">P?</a> <a id="3609" class="Symbol">=</a> <a id="3611" class="Symbol">(</a><a id="3612" href="StateMachine.Base.html#3741" class="Function">𝕍</a> <a id="3614" href="Prelude.DecEq.Core.html#190" class="Field Operator">≟_</a><a id="3616" class="Symbol">)</a> <a id="3618" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="3620" href="UTxO.Types.html#4847" class="Field">address</a><a id="3627" class="Symbol">}</a> <a id="3629" class="Symbol">(</a><a id="3630" href="Prelude.DecEq.WithK.html#170" class="Function">≟-refl</a> <a id="3637" href="StateMachine.Base.html#3741" class="Function">𝕍</a><a id="3638" class="Symbol">)</a>

        <a id="3649" href="Bisimulation.Soundness.html#3649" class="Function">getCont≡</a> <a id="3658" class="Symbol">:</a> <a id="3660" href="UTxO.Types.html#6207" class="Function">getContinuingOutputs</a> <a id="3681" href="Bisimulation.Soundness.html#2568" class="Function">ptx</a> <a id="3685" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="3687" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="3689" href="Bisimulation.Soundness.html#2444" class="Function">txOut</a> <a id="3695" href="Data.List.Base.html#5034" class="Function Operator">]</a>
        <a id="3705" href="Bisimulation.Soundness.html#3649" class="Function">getCont≡</a> <a id="3714" class="Symbol">=</a>
          <a id="3726" class="Comment">-- rewrite thisVal≡ | inputs≡</a>
          <a id="3766" href="Relation.Binary.PropositionalEquality.Core.html#2815" class="Function Operator">begin</a>
            <a id="3784" href="UTxO.Types.html#6207" class="Function">getContinuingOutputs</a> <a id="3805" href="Bisimulation.Soundness.html#2568" class="Function">ptx</a>
          <a id="3819" href="Relation.Binary.PropositionalEquality.Core.html#2873" class="Function Operator">≡⟨⟩</a>
            <a id="3835" href="UTxO.Types.html#6102" class="Function">outputsAt</a> <a id="3845" class="Symbol">(</a><a id="3846" href="UTxO.Types.html#5756" class="Function">thisValidator</a> <a id="3860" href="Bisimulation.Soundness.html#2568" class="Function">ptx</a><a id="3863" class="Symbol">)</a> <a id="3865" href="Bisimulation.Soundness.html#2600" class="Function">txi</a>
          <a id="3879" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">≡⟨</a> <a id="3882" href="Relation.Binary.PropositionalEquality.Core.html#1139" class="Function">cong</a> <a id="3887" class="Symbol">(λ</a> <a id="3890" href="Bisimulation.Soundness.html#3890" class="Bound">x</a> <a id="3892" class="Symbol">→</a> <a id="3894" href="UTxO.Types.html#6102" class="Function">outputsAt</a> <a id="3904" href="Bisimulation.Soundness.html#3890" class="Bound">x</a> <a id="3906" href="Bisimulation.Soundness.html#2600" class="Function">txi</a><a id="3909" class="Symbol">)</a> <a id="3911" href="Bisimulation.Soundness.html#3272" class="Function">thisVal≡</a> <a id="3920" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">⟩</a>
            <a id="3934" href="UTxO.Types.html#6102" class="Function">outputsAt</a> <a id="3944" href="StateMachine.Base.html#3741" class="Function">𝕍</a> <a id="3946" href="Bisimulation.Soundness.html#2600" class="Function">txi</a>
          <a id="3960" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">≡⟨</a> <a id="3963" href="Bisimulation.Soundness.html#3530" class="Function">outputs≡</a> <a id="3972" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">⟩</a>
            <a id="3986" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="3988" href="Bisimulation.Soundness.html#2444" class="Function">txOut</a> <a id="3994" href="Data.List.Base.html#5034" class="Function Operator">]</a>
          <a id="4006" href="Relation.Binary.PropositionalEquality.Core.html#3114" class="Function Operator">∎</a>

        <a id="4017" href="Bisimulation.Soundness.html#4017" class="Function">outputsOK≡</a> <a id="4028" class="Symbol">:</a> <a id="4030" href="StateMachine.Base.html#3572" class="Function">outputsOK</a> <a id="4040" href="Bisimulation.Soundness.html#2568" class="Function">ptx</a> <a id="4044" href="Bisimulation.Soundness.html#2385" class="Function">di</a> <a id="4047" href="Bisimulation.Soundness.html#2404" class="Function">ds</a> <a id="4050" href="Bisimulation.Soundness.html#1083" class="Bound">s′</a> <a id="4053" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4055" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
        <a id="4068" href="Bisimulation.Soundness.html#4017" class="Function">outputsOK≡</a> <a id="4079" class="Keyword">rewrite</a> <a id="4087" class="Comment">{- final≡ | -}</a> <a id="4102" href="Bisimulation.Soundness.html#3649" class="Function">getCont≡</a> <a id="4111" class="Symbol">|</a> <a id="4113" href="Prelude.DecEq.WithK.html#170" class="Function">≟-refl</a> <a id="4120" class="Symbol">(</a><a id="4121" href="Bisimulation.Soundness.html#2423" class="Function">ds′</a> <a id="4125" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a><a id="4127" class="Symbol">)</a> <a id="4129" class="Symbol">=</a> <a id="4131" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>

        <a id="4145" href="Bisimulation.Soundness.html#4145" class="Function">valueAtⁱ≡</a> <a id="4155" class="Symbol">:</a> <a id="4157" href="UTxO.Types.html#6327" class="Function">valueAtⁱ</a> <a id="4166" href="StateMachine.Base.html#3741" class="Function">𝕍</a> <a id="4168" href="Bisimulation.Soundness.html#2600" class="Function">txi</a> <a id="4172" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4174" href="Bisimulation.Soundness.html#1614" class="Function">v</a>
        <a id="4184" href="Bisimulation.Soundness.html#4145" class="Function">valueAtⁱ≡</a> <a id="4194" class="Symbol">=</a>
          <a id="4206" class="Comment">-- rewrite ≟-refl 𝕍 | getSpent≡ = sum-single {v = v}</a>
          <a id="4269" href="Relation.Binary.PropositionalEquality.Core.html#2815" class="Function Operator">begin</a>
            <a id="4287" href="UTxO.Types.html#6327" class="Function">valueAtⁱ</a> <a id="4296" href="StateMachine.Base.html#3741" class="Function">𝕍</a> <a id="4298" href="Bisimulation.Soundness.html#2600" class="Function">txi</a>
          <a id="4312" href="Relation.Binary.PropositionalEquality.Core.html#2873" class="Function Operator">≡⟨⟩</a>
            <a id="4328" class="Symbol">(</a><a id="4329" href="UTxO.Value.html#2078" class="Function">sumᶜ</a> <a id="4334" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="4336" href="Data.List.Base.html#1553" class="Function">map</a> <a id="4340" href="UTxO.Types.html#4784" class="Field">InputInfo.value</a><a id="4355" class="Symbol">)</a> <a id="4357" class="Symbol">(</a><a id="4358" href="UTxO.Types.html#5983" class="Function">inputsAt</a> <a id="4367" href="StateMachine.Base.html#3741" class="Function">𝕍</a> <a id="4369" href="Bisimulation.Soundness.html#2600" class="Function">txi</a><a id="4372" class="Symbol">)</a>
          <a id="4384" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">≡⟨</a> <a id="4387" href="Relation.Binary.PropositionalEquality.Core.html#1139" class="Function">cong</a> <a id="4392" class="Symbol">(</a><a id="4393" href="UTxO.Value.html#2078" class="Function">sumᶜ</a> <a id="4398" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="4400" href="Data.List.Base.html#1553" class="Function">map</a> <a id="4404" href="UTxO.Types.html#4784" class="Field">InputInfo.value</a><a id="4419" class="Symbol">)</a> <a id="4421" href="Bisimulation.Soundness.html#3398" class="Function">inputs≡</a> <a id="4429" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">⟩</a>
            <a id="4443" href="UTxO.Value.html#2078" class="Function">sumᶜ</a> <a id="4448" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="4450" href="UTxO.Types.html#4784" class="Field">InputInfo.value</a> <a id="4466" href="Bisimulation.Soundness.html#2623" class="Function">ptxIn</a> <a id="4472" href="Data.List.Base.html#5034" class="Function Operator">]</a>
          <a id="4484" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">≡⟨</a> <a id="4487" href="UTxO.Value.html#8406" class="Function">sum-single</a> <a id="4498" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">⟩</a>
             <a id="4513" href="Data.Maybe.Base.html#1371" class="Function">maybe</a> <a id="4519" href="UTxO.Types.html#4906" class="Field">value</a> <a id="4525" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="4528" class="Symbol">(</a><a id="4529" href="UTxO.TxUtilities.html#5021" class="Function">getSpentOutput</a> <a id="4544" href="Bisimulation.Soundness.html#1094" class="Bound">l</a> <a id="4546" href="Bisimulation.Soundness.html#2322" class="Function">txIn</a><a id="4550" class="Symbol">)</a>
          <a id="4562" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">≡⟨</a> <a id="4565" href="Relation.Binary.PropositionalEquality.Core.html#1139" class="Function">cong</a> <a id="4570" class="Symbol">(</a><a id="4571" href="Data.Maybe.Base.html#1371" class="Function">maybe</a> <a id="4577" href="UTxO.Types.html#4906" class="Field">value</a> <a id="4583" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="4585" class="Symbol">)</a> <a id="4587" href="Bisimulation.Soundness.html#1894" class="Function">getSpent≡</a> <a id="4597" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">⟩</a>
             <a id="4612" href="Bisimulation.Soundness.html#1614" class="Function">v</a>
          <a id="4624" href="Relation.Binary.PropositionalEquality.Core.html#3114" class="Function Operator">∎</a>

        <a id="4635" href="Bisimulation.Soundness.html#4635" class="Function">valueAtᵒ≡</a> <a id="4645" class="Symbol">:</a> <a id="4647" href="UTxO.Types.html#6416" class="Function">valueAtᵒ</a> <a id="4656" href="StateMachine.Base.html#3741" class="Function">𝕍</a> <a id="4658" href="Bisimulation.Soundness.html#2600" class="Function">txi</a> <a id="4662" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4664" href="Bisimulation.Soundness.html#2359" class="Function">forge′</a> <a id="4671" href="UTxO.Value.html#2000" class="Function Operator">+ᶜ</a> <a id="4674" href="Bisimulation.Soundness.html#1614" class="Function">v</a>
        <a id="4684" href="Bisimulation.Soundness.html#4635" class="Function">valueAtᵒ≡</a> <a id="4694" class="Symbol">=</a>
          <a id="4706" class="Comment">-- rewrite ≟-refl 𝕍 | getSpent≡ = sum-single {v = forge′ +ᶜ v}</a>
          <a id="4779" href="Relation.Binary.PropositionalEquality.Core.html#2815" class="Function Operator">begin</a>
            <a id="4797" class="Symbol">(</a><a id="4798" href="UTxO.Value.html#2078" class="Function">sumᶜ</a> <a id="4803" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="4805" href="Data.List.Base.html#1553" class="Function">map</a> <a id="4809" href="UTxO.Types.html#4906" class="Field">value</a> <a id="4815" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="4817" href="UTxO.Types.html#6102" class="Function">outputsAt</a> <a id="4827" href="StateMachine.Base.html#3741" class="Function">𝕍</a><a id="4828" class="Symbol">)</a> <a id="4830" href="Bisimulation.Soundness.html#2600" class="Function">txi</a>
          <a id="4844" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">≡⟨</a> <a id="4847" href="Relation.Binary.PropositionalEquality.Core.html#1139" class="Function">cong</a> <a id="4852" class="Symbol">(</a><a id="4853" href="UTxO.Value.html#2078" class="Function">sumᶜ</a> <a id="4858" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="4860" href="Data.List.Base.html#1553" class="Function">map</a> <a id="4864" href="UTxO.Types.html#4906" class="Field">value</a><a id="4869" class="Symbol">)</a> <a id="4871" href="Bisimulation.Soundness.html#3530" class="Function">outputs≡</a> <a id="4880" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">⟩</a>
             <a id="4895" href="UTxO.Value.html#2078" class="Function">sumᶜ</a> <a id="4900" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="4902" href="UTxO.Types.html#4906" class="Field">value</a> <a id="4908" href="Bisimulation.Soundness.html#2444" class="Function">txOut</a> <a id="4914" href="Data.List.Base.html#5034" class="Function Operator">]</a>
          <a id="4926" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">≡⟨</a> <a id="4929" href="UTxO.Value.html#8406" class="Function">sum-single</a> <a id="4940" href="Relation.Binary.PropositionalEquality.Core.html#2932" class="Function">⟩</a>
             <a id="4955" href="Bisimulation.Soundness.html#2359" class="Function">forge′</a> <a id="4962" href="UTxO.Value.html#2000" class="Function Operator">+ᶜ</a> <a id="4965" href="Bisimulation.Soundness.html#1614" class="Function">v</a>
          <a id="4977" href="Relation.Binary.PropositionalEquality.Core.html#3114" class="Function Operator">∎</a>

        <a id="4988" href="Bisimulation.Soundness.html#4988" class="Function">propagates≡</a> <a id="5000" class="Symbol">:</a> <a id="5002" href="UTxO.Types.html#6496" class="Function">propagates</a> <a id="5013" href="StateMachine.Base.html#3185" class="Function">threadₛₘ</a> <a id="5022" href="Bisimulation.Soundness.html#2568" class="Function">ptx</a> <a id="5026" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5028" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
        <a id="5041" href="Bisimulation.Soundness.html#4988" class="Function">propagates≡</a> <a id="5053" class="Symbol">=</a> <a id="5055" href="Relation.Binary.PropositionalEquality.Core.html#1789" class="Function">subst</a> <a id="5061" href="Bisimulation.Soundness.html#5168" class="Function">P</a> <a id="5063" class="Symbol">(</a><a id="5064" href="Relation.Binary.PropositionalEquality.Core.html#1693" class="Function">sym</a> <a id="5068" href="Bisimulation.Soundness.html#4145" class="Function">valueAtⁱ≡</a><a id="5077" class="Symbol">)</a> <a id="5079" href="Bisimulation.Soundness.html#1974" class="Function">threadToken≡</a>
                <a id="5108" href="Prelude.General.html#5045" class="Function Operator">∧-×</a> <a id="5112" href="Relation.Binary.PropositionalEquality.Core.html#1789" class="Function">subst</a> <a id="5118" href="Bisimulation.Soundness.html#5168" class="Function">P</a> <a id="5120" class="Symbol">(</a><a id="5121" href="Relation.Binary.PropositionalEquality.Core.html#1693" class="Function">sym</a> <a id="5125" href="Bisimulation.Soundness.html#4635" class="Function">valueAtᵒ≡</a><a id="5134" class="Symbol">)</a> <a id="5136" href="Bisimulation.Soundness.html#5242" class="Function Operator">P_v</a>
          <a id="5150" class="Keyword">where</a>
            <a id="5168" href="Bisimulation.Soundness.html#5168" class="Function">P</a> <a id="5170" class="Symbol">:</a> <a id="5172" href="UTxO.Value.html#987" class="Function">Value</a> <a id="5178" class="Symbol">→</a> <a id="5180" href="Agda.Primitive.html#320" class="Primitive">Set</a>
            <a id="5196" href="Bisimulation.Soundness.html#5168" class="Function">P</a> <a id="5198" class="Symbol">=</a> <a id="5200" class="Symbol">λ</a> <a id="5202" href="Bisimulation.Soundness.html#5202" class="Bound">v</a> <a id="5204" class="Symbol">→</a> <a id="5206" class="Symbol">(</a><a id="5207" href="Bisimulation.Soundness.html#5202" class="Bound">v</a> <a id="5209" href="UTxO.Value.html#2341" class="Function Operator">≥ᶜ</a> <a id="5212" href="StateMachine.Base.html#3185" class="Function">threadₛₘ</a><a id="5220" class="Symbol">)</a> <a id="5222" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5224" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>

            <a id="5242" href="Bisimulation.Soundness.html#5242" class="Function Operator">P_v</a> <a id="5246" class="Symbol">:</a> <a id="5248" href="Bisimulation.Soundness.html#5168" class="Function">P</a> <a id="5250" class="Symbol">(</a><a id="5251" href="Bisimulation.Soundness.html#2359" class="Function">forge′</a> <a id="5258" href="UTxO.Value.html#2000" class="Function Operator">+ᶜ</a> <a id="5261" href="Bisimulation.Soundness.html#1614" class="Function">v</a><a id="5262" class="Symbol">)</a>
            <a id="5276" href="Bisimulation.Soundness.html#5242" class="Function Operator">P_v</a> <a id="5280" class="Symbol">=</a> <a id="5282" href="Prelude.General.html#4148" class="Function">T⇒true</a> <a id="5289" class="Symbol">(</a><a id="5290" href="UTxO.Value.html#4138" class="Postulate">≥ᶜ-+ᶜ</a> <a id="5296" class="Symbol">{</a><a id="5297" class="Argument">x</a> <a id="5299" class="Symbol">=</a> <a id="5301" href="Bisimulation.Soundness.html#2359" class="Function">forge′</a><a id="5307" class="Symbol">}</a> <a id="5309" class="Symbol">{</a><a id="5310" class="Argument">y</a> <a id="5312" class="Symbol">=</a> <a id="5314" href="Bisimulation.Soundness.html#1614" class="Function">v</a><a id="5315" class="Symbol">}</a> <a id="5317" class="Symbol">{</a><a id="5318" class="Argument">z</a> <a id="5320" class="Symbol">=</a> <a id="5322" href="StateMachine.Base.html#3185" class="Function">threadₛₘ</a><a id="5330" class="Symbol">}</a> <a id="5332" class="Symbol">(</a><a id="5333" href="Prelude.General.html#4098" class="Function">true⇒T</a> <a id="5340" href="Bisimulation.Soundness.html#1974" class="Function">threadToken≡</a><a id="5352" class="Symbol">))</a>

        <a id="5364" href="Bisimulation.Soundness.html#5364" class="Function">validate≡</a> <a id="5374" class="Symbol">:</a> <a id="5376" href="StateMachine.Base.html#3240" class="Function">validatorₛₘ</a> <a id="5388" href="Bisimulation.Soundness.html#2568" class="Function">ptx</a> <a id="5392" href="Bisimulation.Soundness.html#2385" class="Function">di</a> <a id="5395" href="Bisimulation.Soundness.html#2404" class="Function">ds</a> <a id="5398" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5400" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
        <a id="5413" href="Bisimulation.Soundness.html#5364" class="Function">validate≡</a> <a id="5423" class="Symbol">=</a> <a id="5425" href="Prelude.Monad.html#4466" class="Function">do-pure</a> <a id="5433" href="Bisimulation.Soundness.html#3129" class="Function">runStep≡</a> <a id="5442" class="Symbol">(</a><a id="5443" href="Bisimulation.Soundness.html#4017" class="Function">outputsOK≡</a> <a id="5454" href="Prelude.General.html#5045" class="Function Operator">∧-×</a> <a id="5458" href="Bisimulation.Soundness.html#2185" class="Function">verify≡</a> <a id="5466" href="Prelude.General.html#5045" class="Function Operator">∧-×</a> <a id="5470" href="Bisimulation.Soundness.html#4988" class="Function">propagates≡</a><a id="5481" class="Symbol">)</a>


    <a id="5489" href="UTxO.Validity.html#1876" class="Field">allPoliciesValidate</a> <a id="5509" href="Bisimulation.Soundness.html#2677" class="Function">vtx</a> <a id="5513" class="Symbol">=</a> <a id="5515" href="Bisimulation.Soundness.html#1145" class="Bound">apv</a> <a id="5519" href="Bisimulation.Soundness.html#2161" class="Function">tx</a>

    <a id="5527" href="UTxO.Validity.html#1977" class="Field">validateValidHashes</a> <a id="5547" href="Bisimulation.Soundness.html#2677" class="Function">vtx</a> <a id="5551" class="Symbol">=</a> <a id="5553" href="Bisimulation.Soundness.html#5582" class="Function">vvh</a> <a id="5557" href="Data.List.Relation.Unary.All.html#1533" class="InductiveConstructor Operator">∷</a> <a id="5559" href="Data.List.Relation.Unary.All.html#1516" class="InductiveConstructor">[]</a>
      <a id="5568" class="Keyword">where</a>
        <a id="5582" href="Bisimulation.Soundness.html#5582" class="Function">vvh</a> <a id="5586" class="Symbol">:</a> <a id="5588" href="Data.Maybe.Relation.Unary.Any.html#839" class="Datatype">M.Any.Any</a> <a id="5598" class="Symbol">(λ</a> <a id="5601" href="Bisimulation.Soundness.html#5601" class="Bound">o</a> <a id="5603" class="Symbol">→</a> <a id="5605" class="Symbol">(</a><a id="5606" href="UTxO.Types.html#4847" class="Field">address</a> <a id="5614" href="Bisimulation.Soundness.html#5601" class="Bound">o</a> <a id="5616" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5618" href="StateMachine.Base.html#3741" class="Function">𝕍</a><a id="5619" class="Symbol">)</a> <a id="5621" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="5623" class="Symbol">(</a><a id="5624" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="5634" href="Bisimulation.Soundness.html#5601" class="Bound">o</a> <a id="5636" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5638" href="Bisimulation.Soundness.html#2404" class="Function">ds</a> <a id="5641" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a><a id="5643" class="Symbol">))</a> <a id="5646" class="Symbol">(</a><a id="5647" href="UTxO.TxUtilities.html#5021" class="Function">getSpentOutput</a> <a id="5662" href="Bisimulation.Soundness.html#1094" class="Bound">l</a> <a id="5664" href="Bisimulation.Soundness.html#2322" class="Function">txIn</a><a id="5668" class="Symbol">)</a>
        <a id="5678" href="Bisimulation.Soundness.html#5582" class="Function">vvh</a> <a id="5682" class="Keyword">rewrite</a> <a id="5690" href="Bisimulation.Soundness.html#1894" class="Function">getSpent≡</a> <a id="5700" class="Symbol">=</a> <a id="5702" href="Data.Maybe.Relation.Unary.Any.html#909" class="InductiveConstructor">M.Any.just</a> <a id="5713" class="Symbol">(</a><a id="5714" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a> <a id="5719" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5721" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a><a id="5725" class="Symbol">)</a>

    <a id="5732" href="UTxO.Validity.html#2136" class="Field">forging</a>             <a id="5752" href="Bisimulation.Soundness.html#2677" class="Function">vtx</a> <a id="5756" class="Keyword">with</a>
      <a id="5767" href="StateMachine.Base.html#1216" class="Field">forge≡</a> <a id="5774" href="Bisimulation.Soundness.html#1088" class="Bound">tx≡</a>
    <a id="5782" class="Symbol">...</a> <a id="5786" class="Symbol">|</a> <a id="5788" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="5796" class="Symbol">=</a> <a id="5798" href="Data.List.Relation.Unary.All.html#1516" class="InductiveConstructor">[]</a>
    <a id="5805" class="Symbol">...</a> <a id="5809" class="Symbol">|</a> <a id="5811" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5816" href="Bisimulation.Soundness.html#5816" class="Bound">xs</a> <a id="5819" class="Symbol">=</a> <a id="5821" href="Bisimulation.Soundness.html#5866" class="Function">All-Any-helper</a> <a id="5836" class="Symbol">{</a><a id="5837" class="Argument">xs</a> <a id="5840" class="Symbol">=</a> <a id="5842" href="Bisimulation.Soundness.html#5816" class="Bound">xs</a><a id="5844" class="Symbol">}</a>
      <a id="5852" class="Keyword">where</a>
        <a id="5866" href="Bisimulation.Soundness.html#5866" class="Function">All-Any-helper</a> <a id="5881" class="Symbol">:</a> <a id="5883" class="Symbol">∀</a> <a id="5885" class="Symbol">{</a><a id="5886" href="Bisimulation.Soundness.html#5886" class="Bound">xs</a> <a id="5889" class="Symbol">:</a> <a id="5891" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="5896" class="Symbol">(</a><a id="5897" href="UTxO.Types.html#7180" class="Function">MonetaryPolicy</a> <a id="5912" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="5914" href="UTxO.Value.html#948" class="Function">SubValue</a><a id="5922" class="Symbol">)}</a>
          <a id="5935" class="Symbol">→</a> <a id="5937" href="Data.List.Relation.Unary.All.html#1453" class="Datatype">All</a> <a id="5941" class="Symbol">(λ</a> <a id="5944" href="Bisimulation.Soundness.html#5944" class="Bound">c</a> <a id="5946" class="Symbol">→</a> <a id="5948" href="Data.List.Relation.Unary.Any.html#1165" class="Datatype">Any</a> <a id="5952" class="Symbol">((</a><a id="5954" href="Bisimulation.Soundness.html#5944" class="Bound">c</a> <a id="5956" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡_</a><a id="5958" class="Symbol">)</a> <a id="5960" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="5962" href="UTxO.Hashing.Base.html#1199" class="Postulate Operator">_♯</a><a id="5964" class="Symbol">)</a> <a id="5966" class="Symbol">(</a><a id="5967" href="Data.List.Base.html#1553" class="Function">map</a> <a id="5971" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="5977" href="Bisimulation.Soundness.html#5886" class="Bound">xs</a><a id="5979" class="Symbol">))</a>
                <a id="5998" class="Symbol">(</a><a id="5999" href="Data.List.Base.html#1553" class="Function">map</a> <a id="6003" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="6009" class="Symbol">(</a><a id="6010" href="Data.List.Base.html#1553" class="Function">map</a> <a id="6014" class="Symbol">(</a><a id="6015" href="Prelude.Bifunctor.html#930" class="Function">map₁</a> <a id="6020" href="UTxO.Hashing.Base.html#1199" class="Postulate Operator">_♯</a><a id="6022" class="Symbol">)</a> <a id="6024" href="Bisimulation.Soundness.html#5886" class="Bound">xs</a><a id="6026" class="Symbol">))</a>
        <a id="6037" href="Bisimulation.Soundness.html#5866" class="Function">All-Any-helper</a> <a id="6052" class="Symbol">{</a><a id="6053" class="Argument">xs</a> <a id="6056" class="Symbol">=</a> <a id="6058" href="Bisimulation.Soundness.html#6058" class="Bound">xs</a><a id="6060" class="Symbol">}</a>
          <a id="6072" class="Keyword">rewrite</a> <a id="6080" href="Prelude.Lists.Core.html#425" class="Function">map-proj₁-map₁</a> <a id="6095" class="Symbol">{</a><a id="6096" class="Argument">xs</a> <a id="6099" class="Symbol">=</a> <a id="6101" href="Bisimulation.Soundness.html#6058" class="Bound">xs</a><a id="6103" class="Symbol">}</a> <a id="6105" class="Symbol">{</a><a id="6106" class="Argument">f</a> <a id="6108" class="Symbol">=</a> <a id="6110" href="UTxO.Hashing.Base.html#1199" class="Postulate Operator">_♯</a><a id="6112" class="Symbol">}</a>
                <a id="6130" class="Symbol">=</a> <a id="6132" href="Data.List.Relation.Unary.All.Properties.html#14079" class="Function">L.All.map⁺</a> <a id="6143" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="6145" href="Data.List.Relation.Unary.All.html#2944" class="Function">L.All.map</a> <a id="6155" href="Data.List.Relation.Unary.Any.Properties.html#10950" class="Function">L.Any.map⁺</a> <a id="6166" href="Prelude.Lists.Core.html#2340" class="Function">All-Any-refl</a>

    <a id="6184" href="Bisimulation.Soundness.html#6184" class="Function">vl′</a> <a id="6188" class="Symbol">:</a> <a id="6190" href="UTxO.Validity.html#2261" class="Datatype">ValidLedger</a> <a id="6202" class="Symbol">(</a><a id="6203" href="Bisimulation.Soundness.html#2161" class="Function">tx</a> <a id="6206" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6208" href="Bisimulation.Soundness.html#1094" class="Bound">l</a><a id="6209" class="Symbol">)</a>
    <a id="6215" href="Bisimulation.Soundness.html#6184" class="Function">vl′</a> <a id="6219" class="Symbol">=</a> <a id="6221" href="Bisimulation.Soundness.html#1098" class="Bound">vl</a> <a id="6224" href="UTxO.Validity.html#2319" class="InductiveConstructor Operator">⊕</a> <a id="6226" href="Bisimulation.Soundness.html#2161" class="Function">tx</a> <a id="6229" href="UTxO.Validity.html#2319" class="InductiveConstructor Operator">∶-</a> <a id="6232" href="Bisimulation.Soundness.html#2677" class="Function">vtx</a>

    <a id="6241" href="Bisimulation.Soundness.html#6241" class="Function">vl→vl′</a> <a id="6248" class="Symbol">:</a> <a id="6250" href="Bisimulation.Soundness.html#1098" class="Bound">vl</a> <a id="6253" href="Bisimulation.Base.html#695" class="Function Operator">—→[</a> <a id="6257" href="Bisimulation.Soundness.html#2161" class="Function">tx</a> <a id="6260" href="Bisimulation.Base.html#695" class="Function Operator">∶-</a> <a id="6263" href="Bisimulation.Soundness.html#2677" class="Function">vtx</a> <a id="6267" href="Bisimulation.Base.html#695" class="Function Operator">]</a> <a id="6269" href="Bisimulation.Soundness.html#6184" class="Function">vl′</a>
    <a id="6277" href="Bisimulation.Soundness.html#6241" class="Function">vl→vl′</a> <a id="6284" class="Symbol">=</a> <a id="6286" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>

    <a id="6296" href="Bisimulation.Soundness.html#6296" class="Function">vl′~s′</a> <a id="6303" class="Symbol">:</a> <a id="6305" href="Bisimulation.Soundness.html#6184" class="Function">vl′</a> <a id="6309" href="Bisimulation.Base.html#835" class="Function Operator">~</a> <a id="6311" href="Bisimulation.Soundness.html#1083" class="Bound">s′</a>
    <a id="6318" href="Bisimulation.Soundness.html#6296" class="Function">vl′~s′</a> <a id="6325" class="Symbol">=</a>
      <a id="6333" href="Data.List.Membership.Propositional.Properties.html#3377" class="Function">∈-map⁺</a> <a id="6340" class="Symbol">(</a><a id="6341" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="6351" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="6353" href="UTxO.TxUtilities.html#599" class="Field">out</a><a id="6356" class="Symbol">)</a>
        <a id="6366" class="Symbol">(</a><a id="6367" href="Data.List.Membership.Propositional.Properties.html#8500" class="Function">∈-filter⁺</a> <a id="6377" class="Symbol">((</a><a id="6379" href="Prelude.DecEq.Core.html#190" class="Field Operator">_≟</a> <a id="6382" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="6386" class="Symbol">)</a> <a id="6388" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="6390" class="Symbol">(</a><a id="6391" href="UTxO.Value.html#2341" class="Function Operator">_≥ᶜ</a> <a id="6395" href="StateMachine.Base.html#3185" class="Function">threadₛₘ</a><a id="6403" class="Symbol">)</a> <a id="6405" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="6407" href="UTxO.Types.html#4906" class="Field">value</a> <a id="6413" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="6415" href="UTxO.TxUtilities.html#599" class="Field">out</a><a id="6418" class="Symbol">)</a>
          <a id="6430" class="Symbol">(</a><a id="6431" href="Data.List.Membership.Propositional.Properties.html#8500" class="Function">∈-filter⁺</a> <a id="6441" class="Symbol">((</a><a id="6443" href="StateMachine.Base.html#3741" class="Function">𝕍</a> <a id="6445" href="Prelude.DecEq.Core.html#190" class="Field Operator">≟_</a><a id="6447" class="Symbol">)</a> <a id="6449" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="6451" href="UTxO.Types.html#4847" class="Field">address</a> <a id="6459" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="6461" href="UTxO.TxUtilities.html#599" class="Field">out</a><a id="6464" class="Symbol">)</a>
            <a id="6478" class="Symbol">(</a><a id="6479" href="Data.List.Membership.Propositional.Properties.html#4054" class="Function">∈-++⁺ʳ</a> <a id="6486" class="Symbol">(</a><a id="6487" href="Data.List.Base.html#8101" class="Function">filter</a> <a id="6494" class="Symbol">((</a><a id="6496" href="Prelude.Membership.html#613" class="Function Operator">_∉?</a> <a id="6500" href="UTxO.Types.html#8024" class="Function">outputRefs</a> <a id="6511" href="Bisimulation.Soundness.html#2161" class="Function">tx</a><a id="6513" class="Symbol">)</a> <a id="6515" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="6517" href="UTxO.TxUtilities.html#572" class="Field">outRef</a><a id="6523" class="Symbol">)</a> <a id="6525" class="Symbol">(</a><a id="6526" href="UTxO.TxUtilities.html#837" class="Function">utxo</a> <a id="6531" href="Bisimulation.Soundness.html#1094" class="Bound">l</a><a id="6532" class="Symbol">))</a> <a id="6535" class="Symbol">(</a><a id="6536" href="Data.List.Relation.Unary.Any.html#1228" class="InductiveConstructor">here</a> <a id="6541" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a><a id="6545" class="Symbol">))</a>
            <a id="6560" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a><a id="6564" class="Symbol">)</a>
          <a id="6576" class="Symbol">(</a><a id="6577" href="Prelude.General.html#4148" class="Function">T⇒true</a> <a id="6584" class="Symbol">(</a><a id="6585" href="UTxO.Value.html#4138" class="Postulate">≥ᶜ-+ᶜ</a> <a id="6591" class="Symbol">{</a><a id="6592" class="Argument">x</a> <a id="6594" class="Symbol">=</a> <a id="6596" href="UTxO.Types.html#7735" class="Field">forge</a> <a id="6602" href="Bisimulation.Soundness.html#2161" class="Function">tx</a><a id="6604" class="Symbol">}</a> <a id="6606" class="Symbol">{</a><a id="6607" class="Argument">y</a> <a id="6609" class="Symbol">=</a> <a id="6611" href="Bisimulation.Soundness.html#1614" class="Function">v</a><a id="6612" class="Symbol">}</a> <a id="6614" class="Symbol">{</a><a id="6615" class="Argument">z</a> <a id="6617" class="Symbol">=</a> <a id="6619" href="StateMachine.Base.html#3185" class="Function">threadₛₘ</a><a id="6627" class="Symbol">}</a> <a id="6629" class="Symbol">(</a><a id="6630" href="Prelude.General.html#4098" class="Function">true⇒T</a> <a id="6637" href="Bisimulation.Soundness.html#1974" class="Function">threadToken≡</a><a id="6649" class="Symbol">))))</a>
</pre></body></html>