<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Bisimulation.Base</title><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css'/><style>.github-fork-ribbon:before { background-color: #333; }</style><link rel="stylesheet" href="css/Agda.css"></head><body><a class='github-fork-ribbon'href='https://github.com/omelkonian/formal-utxo/tree/master/Bisimulation/Base.agda'data-ribbon='Source code on Github' title='Source code on Github'>Source code on Github</a><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Data.List.Membership.Propositional.Properties.html" class="Module">Data.List.Membership.Propositional.Properties</a> <a id="59" class="Keyword">using</a> <a id="65" class="Symbol">(</a><a id="66" href="Data.List.Membership.Propositional.Properties.html#3491" class="Function">∈-map⁻</a><a id="72" class="Symbol">;</a> <a id="74" href="Data.List.Membership.Propositional.Properties.html#3377" class="Function">∈-map⁺</a><a id="80" class="Symbol">;</a> <a id="82" href="Data.List.Membership.Propositional.Properties.html#8622" class="Function">∈-filter⁻</a><a id="91" class="Symbol">)</a>

<a id="94" class="Keyword">open</a> <a id="99" class="Keyword">import</a> <a id="106" href="Prelude.Init.html" class="Module">Prelude.Init</a> <a id="119" class="Keyword">hiding</a> <a id="126" class="Symbol">(</a><a id="127" href="Function.Base.html#4571" class="Function Operator">_∋_</a><a id="130" class="Symbol">)</a>
<a id="132" class="Keyword">open</a> <a id="137" class="Keyword">import</a> <a id="144" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="160" class="Keyword">open</a> <a id="165" class="Keyword">import</a> <a id="172" href="Prelude.Lists.html" class="Module">Prelude.Lists</a>
<a id="186" class="Keyword">open</a> <a id="191" class="Keyword">import</a> <a id="198" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="212" class="Keyword">open</a> <a id="217" class="Keyword">import</a> <a id="224" href="Prelude.ToN.html" class="Module">Prelude.ToN</a>
<a id="236" class="Keyword">open</a> <a id="241" class="Keyword">import</a> <a id="248" href="Prelude.Membership.html" class="Module">Prelude.Membership</a>

<a id="268" class="Keyword">open</a> <a id="273" class="Keyword">import</a> <a id="280" href="UTxO.Hashing.html" class="Module">UTxO.Hashing</a>
<a id="293" class="Keyword">open</a> <a id="298" class="Keyword">import</a> <a id="305" href="UTxO.Value.html" class="Module">UTxO.Value</a>
<a id="316" class="Keyword">open</a> <a id="321" class="Keyword">import</a> <a id="328" href="UTxO.Types.html" class="Module">UTxO.Types</a> <a id="339" class="Keyword">hiding</a> <a id="346" class="Symbol">(</a><a id="347" href="UTxO.Types.html#925" class="InductiveConstructor">I</a><a id="348" class="Symbol">)</a>
<a id="350" class="Keyword">open</a> <a id="355" class="Keyword">import</a> <a id="362" href="UTxO.TxUtilities.html" class="Module">UTxO.TxUtilities</a>
<a id="379" class="Keyword">open</a> <a id="384" class="Keyword">import</a> <a id="391" href="UTxO.Validity.html" class="Module">UTxO.Validity</a>
<a id="405" class="Keyword">open</a> <a id="410" class="Keyword">import</a> <a id="417" href="StateMachine.Base.html" class="Module">StateMachine.Base</a>

<a id="436" class="Keyword">open</a> <a id="441" href="UTxO.Types.html#4637" class="Module">InputInfo</a>

<a id="452" class="Keyword">module</a> <a id="459" href="Bisimulation.Base.html" class="Module">Bisimulation.Base</a>
  <a id="479" class="Symbol">{</a><a id="480" href="Bisimulation.Base.html#480" class="Bound">S</a> <a id="482" href="Bisimulation.Base.html#482" class="Bound">I</a> <a id="484" class="Symbol">:</a> <a id="486" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="489" class="Symbol">}</a> <a id="491" class="Symbol">{{</a><a id="493" href="Bisimulation.Base.html#493" class="Bound">_</a> <a id="495" class="Symbol">:</a> <a id="497" href="UTxO.Types.html#1155" class="Record">IsData</a> <a id="504" href="Bisimulation.Base.html#480" class="Bound">S</a><a id="505" class="Symbol">}}</a> <a id="508" class="Symbol">{{</a><a id="510" href="Bisimulation.Base.html#510" class="Bound">_</a> <a id="512" class="Symbol">:</a> <a id="514" href="UTxO.Types.html#1155" class="Record">IsData</a> <a id="521" href="Bisimulation.Base.html#482" class="Bound">I</a><a id="522" class="Symbol">}}</a> <a id="525" class="Symbol">{</a><a id="526" href="Bisimulation.Base.html#526" class="Bound">sm</a> <a id="529" class="Symbol">:</a> <a id="531" href="StateMachine.Base.html#1973" class="Record">StateMachine</a> <a id="544" href="Bisimulation.Base.html#480" class="Bound">S</a> <a id="546" href="Bisimulation.Base.html#482" class="Bound">I</a><a id="547" class="Symbol">}</a>
  <a id="551" class="Keyword">where</a>

<a id="558" class="Keyword">open</a> <a id="563" href="StateMachine.Base.html#2219" class="Module">CEM</a> <a id="567" class="Symbol">{</a><a id="568" class="Argument">sm</a> <a id="571" class="Symbol">=</a> <a id="573" href="Bisimulation.Base.html#526" class="Bound">sm</a><a id="575" class="Symbol">}</a>

<a id="_—→[_]_"></a><a id="578" href="Bisimulation.Base.html#578" class="Function Operator">_—→[_]_</a> <a id="586" class="Symbol">:</a> <a id="588" href="Bisimulation.Base.html#480" class="Bound">S</a> <a id="590" class="Symbol">→</a> <a id="592" href="Bisimulation.Base.html#482" class="Bound">I</a> <a id="594" class="Symbol">→</a> <a id="596" class="Symbol">(</a><a id="597" href="Bisimulation.Base.html#480" class="Bound">S</a> <a id="599" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="601" href="StateMachine.Base.html#1178" class="Record">TxConstraints</a><a id="614" class="Symbol">)</a> <a id="616" class="Symbol">→</a> <a id="618" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="622" href="Bisimulation.Base.html#622" class="Bound">s</a> <a id="624" href="Bisimulation.Base.html#578" class="Function Operator">—→[</a> <a id="628" href="Bisimulation.Base.html#628" class="Bound">i</a> <a id="630" href="Bisimulation.Base.html#578" class="Function Operator">]</a> <a id="632" class="Symbol">(</a><a id="633" href="Bisimulation.Base.html#633" class="Bound">s′</a> <a id="636" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="638" href="Bisimulation.Base.html#638" class="Bound">tx≡</a><a id="641" class="Symbol">)</a> <a id="643" class="Symbol">=</a> <a id="645" href="StateMachine.Base.html#2332" class="Function">stepₛₘ</a> <a id="652" href="Bisimulation.Base.html#622" class="Bound">s</a> <a id="654" href="Bisimulation.Base.html#628" class="Bound">i</a> <a id="656" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="658" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="663" class="Symbol">(</a><a id="664" href="Bisimulation.Base.html#633" class="Bound">s′</a> <a id="667" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="669" href="Bisimulation.Base.html#638" class="Bound">tx≡</a><a id="672" class="Symbol">)</a>

<a id="675" class="Keyword">infix</a> <a id="681" class="Number">30</a> <a id="684" href="Bisimulation.Base.html#695" class="Function Operator">_—→[_∶-_]_</a>
<a id="_—→[_∶-_]_"></a><a id="695" href="Bisimulation.Base.html#695" class="Function Operator">_—→[_∶-_]_</a> <a id="706" class="Symbol">:</a> <a id="708" class="Symbol">∀</a> <a id="710" class="Symbol">{</a><a id="711" href="Bisimulation.Base.html#711" class="Bound">l</a><a id="712" class="Symbol">}</a> <a id="714" class="Symbol">→</a> <a id="716" href="UTxO.Validity.html#2261" class="Datatype">ValidLedger</a> <a id="728" href="Bisimulation.Base.html#711" class="Bound">l</a> <a id="730" class="Symbol">→</a> <a id="732" class="Symbol">(</a><a id="733" href="Bisimulation.Base.html#733" class="Bound">tx</a> <a id="736" class="Symbol">:</a> <a id="738" href="UTxO.Types.html#7568" class="Record">Tx</a><a id="740" class="Symbol">)</a> <a id="742" class="Symbol">→</a> <a id="744" href="UTxO.Validity.html#1336" class="Record">IsValidTx</a> <a id="754" href="Bisimulation.Base.html#733" class="Bound">tx</a> <a id="757" href="Bisimulation.Base.html#711" class="Bound">l</a> <a id="759" class="Symbol">→</a> <a id="761" href="UTxO.Validity.html#2261" class="Datatype">ValidLedger</a> <a id="773" class="Symbol">(</a><a id="774" href="Bisimulation.Base.html#733" class="Bound">tx</a> <a id="777" class="InductiveConstructor Operator">∷</a> <a id="779" href="Bisimulation.Base.html#711" class="Bound">l</a><a id="780" class="Symbol">)</a> <a id="782" class="Symbol">→</a> <a id="784" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="788" href="Bisimulation.Base.html#788" class="Bound">vl</a> <a id="791" href="Bisimulation.Base.html#695" class="Function Operator">—→[</a> <a id="795" href="Bisimulation.Base.html#795" class="Bound">tx</a> <a id="798" href="Bisimulation.Base.html#695" class="Function Operator">∶-</a> <a id="801" href="Bisimulation.Base.html#801" class="Bound">vtx</a> <a id="805" href="Bisimulation.Base.html#695" class="Function Operator">]</a> <a id="807" href="Bisimulation.Base.html#807" class="Bound">vl′</a> <a id="811" class="Symbol">=</a> <a id="813" href="Bisimulation.Base.html#807" class="Bound">vl′</a> <a id="817" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="819" href="Bisimulation.Base.html#788" class="Bound">vl</a> <a id="822" href="UTxO.Validity.html#2319" class="InductiveConstructor Operator">⊕</a> <a id="824" href="Bisimulation.Base.html#795" class="Bound">tx</a> <a id="827" href="UTxO.Validity.html#2319" class="InductiveConstructor Operator">∶-</a> <a id="830" href="Bisimulation.Base.html#801" class="Bound">vtx</a>

<a id="_~_"></a><a id="835" href="Bisimulation.Base.html#835" class="Function Operator">_~_</a> <a id="839" class="Symbol">:</a> <a id="841" class="Symbol">∀</a> <a id="843" class="Symbol">{</a><a id="844" href="Bisimulation.Base.html#844" class="Bound">l</a><a id="845" class="Symbol">}</a> <a id="847" class="Symbol">→</a> <a id="849" href="UTxO.Validity.html#2261" class="Datatype">ValidLedger</a> <a id="861" href="Bisimulation.Base.html#844" class="Bound">l</a> <a id="863" class="Symbol">→</a> <a id="865" href="Bisimulation.Base.html#480" class="Bound">S</a> <a id="867" class="Symbol">→</a> <a id="869" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="873" href="Bisimulation.Base.html#835" class="Function Operator">_~_</a> <a id="877" class="Symbol">{</a><a id="878" href="Bisimulation.Base.html#878" class="Bound">l</a><a id="879" class="Symbol">}</a> <a id="881" class="Symbol">_</a> <a id="883" href="Bisimulation.Base.html#883" class="Bound">s</a> <a id="885" class="Symbol">=</a> <a id="887" class="Symbol">(</a><a id="888" href="UTxO.Types.html#1196" class="Field">toData</a> <a id="895" href="Bisimulation.Base.html#883" class="Bound">s</a><a id="896" class="Symbol">)</a> <a id="898" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a> <a id="901" href="Prelude.Membership.html#428" class="Field Operator">∈</a> <a id="903" class="Symbol">(</a> <a id="905" href="Data.List.Base.html#1553" class="Function">map</a> <a id="909" class="Symbol">(</a><a id="910" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="920" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="922" href="UTxO.TxUtilities.html#599" class="Field">out</a><a id="925" class="Symbol">)</a>
                              <a id="957" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="959" href="Data.List.Base.html#8101" class="Function">filter</a> <a id="966" class="Symbol">((</a><a id="968" href="Prelude.DecEq.Core.html#190" class="Field Operator">_≟</a> <a id="971" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="975" class="Symbol">)</a> <a id="977" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="979" class="Symbol">(</a><a id="980" href="UTxO.Value.html#2341" class="Function Operator">_≥ᶜ</a> <a id="984" href="StateMachine.Base.html#3185" class="Function">threadₛₘ</a><a id="992" class="Symbol">)</a> <a id="994" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="996" href="UTxO.Types.html#4906" class="Field">value</a> <a id="1002" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1004" href="UTxO.TxUtilities.html#599" class="Field">out</a><a id="1007" class="Symbol">)</a>
                              <a id="1039" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1041" href="Data.List.Base.html#8101" class="Function">filter</a> <a id="1048" class="Symbol">((</a><a id="1050" href="StateMachine.Base.html#3741" class="Function">𝕍</a> <a id="1052" href="Prelude.DecEq.Core.html#190" class="Field Operator">≟_</a><a id="1054" class="Symbol">)</a> <a id="1056" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1058" href="UTxO.Types.html#4847" class="Field">address</a> <a id="1066" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1068" href="UTxO.TxUtilities.html#599" class="Field">out</a><a id="1071" class="Symbol">)</a>
                              <a id="1103" class="Comment">-- ∘ map out</a>
                              <a id="1146" class="Symbol">)</a> <a id="1148" class="Symbol">(</a><a id="1149" href="UTxO.TxUtilities.html#837" class="Function">utxo</a> <a id="1154" href="Bisimulation.Base.html#878" class="Bound">l</a><a id="1155" class="Symbol">)</a>

<a id="1158" class="Comment">-- alternative definition (T0D0: replace everywhere)</a>
<a id="1211" class="Comment">-- _~′_ : ∀ {l} → ValidLedger l → S → Set</a>
<a id="1253" class="Comment">-- _~′_ {l} _ s = Any (λ o → (address o ≡ 𝕍) × (datumHash o ≡ toData s ♯ᵈ) × (nftₛₘ ∈ᶜ value o)) (map out $ utxo l)</a>

<a id="view-~"></a><a id="1370" href="Bisimulation.Base.html#1370" class="Function">view-~</a> <a id="1377" class="Symbol">:</a> <a id="1379" class="Symbol">∀</a> <a id="1381" class="Symbol">{</a><a id="1382" href="Bisimulation.Base.html#1382" class="Bound">l</a><a id="1383" class="Symbol">}</a> <a id="1385" class="Symbol">{</a><a id="1386" href="Bisimulation.Base.html#1386" class="Bound">s</a> <a id="1388" class="Symbol">:</a> <a id="1390" href="Bisimulation.Base.html#480" class="Bound">S</a><a id="1391" class="Symbol">}</a> <a id="1393" class="Symbol">{</a><a id="1394" href="Bisimulation.Base.html#1394" class="Bound">vl</a> <a id="1397" class="Symbol">:</a> <a id="1399" href="UTxO.Validity.html#2261" class="Datatype">ValidLedger</a> <a id="1411" href="Bisimulation.Base.html#1382" class="Bound">l</a><a id="1412" class="Symbol">}</a>
  <a id="1416" class="Symbol">→</a> <a id="1418" href="Bisimulation.Base.html#1394" class="Bound">vl</a> <a id="1421" href="Bisimulation.Base.html#835" class="Function Operator">~</a> <a id="1423" href="Bisimulation.Base.html#1386" class="Bound">s</a>
  <a id="1427" class="Symbol">→</a> <a id="1429" href="Data.Product.html#1378" class="Function">∃</a> <a id="1431" class="Symbol">λ</a> <a id="1433" href="Bisimulation.Base.html#1433" class="Bound">prevTx</a> <a id="1440" class="Symbol">→</a> <a id="1442" href="Data.Product.html#1378" class="Function">∃</a> <a id="1444" class="Symbol">λ</a> <a id="1446" href="Bisimulation.Base.html#1446" class="Bound">v</a> <a id="1448" class="Symbol">→</a> <a id="1450" href="Agda.Builtin.Sigma.html#148" class="Record">Σ</a> <a id="1452" class="Symbol">(</a><a id="1453" href="Bisimulation.Base.html#1386" class="Bound">s</a> <a id="1455" href="StateMachine.Base.html#4062" class="Function Operator">—→</a> <a id="1458" href="Bisimulation.Base.html#1446" class="Bound">v</a> <a id="1460" href="Prelude.Membership.html#428" class="Field Operator">∈</a> <a id="1462" href="UTxO.Types.html#7700" class="Field">outputs</a> <a id="1470" href="Bisimulation.Base.html#1433" class="Bound">prevTx</a><a id="1476" class="Symbol">)</a> <a id="1478" class="Symbol">λ</a> <a id="1480" href="Bisimulation.Base.html#1480" class="Bound">prevOut∈</a> <a id="1489" class="Symbol">→</a>
      <a id="1497" class="Keyword">let</a>
        <a id="1509" href="Bisimulation.Base.html#1509" class="Bound">oRef</a> <a id="1514" class="Symbol">=</a> <a id="1516" class="Symbol">(</a><a id="1517" href="Bisimulation.Base.html#1433" class="Bound">prevTx</a> <a id="1524" href="UTxO.Hashing.Types.html#1170" class="Function Operator">♯ₜₓ</a><a id="1527" class="Symbol">)</a> <a id="1529" href="UTxO.Types.html#4242" class="InductiveConstructor Operator">indexed-at</a> <a id="1540" href="Prelude.ToN.html#139" class="Field">toℕ</a> <a id="1544" class="Symbol">(</a><a id="1545" href="Data.List.Relation.Unary.Any.html#1826" class="Function">L.Any.index</a> <a id="1557" href="Bisimulation.Base.html#1480" class="Bound">prevOut∈</a><a id="1565" class="Symbol">)</a>
        <a id="1575" href="Bisimulation.Base.html#1575" class="Bound">out</a>  <a id="1580" class="Symbol">=</a> <a id="1582" class="Keyword">record</a> <a id="1589" class="Symbol">{</a> <a id="1591" class="Field">address</a> <a id="1599" class="Symbol">=</a> <a id="1601" href="StateMachine.Base.html#3741" class="Function">𝕍</a><a id="1602" class="Symbol">;</a> <a id="1604" class="Field">datumHash</a> <a id="1614" class="Symbol">=</a> <a id="1616" href="UTxO.Types.html#1196" class="Field">toData</a> <a id="1623" href="Bisimulation.Base.html#1386" class="Bound">s</a> <a id="1625" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a><a id="1627" class="Symbol">;</a> <a id="1629" class="Field">value</a> <a id="1635" class="Symbol">=</a> <a id="1637" href="Bisimulation.Base.html#1446" class="Bound">v</a> <a id="1639" class="Symbol">}</a>
        <a id="1649" href="Bisimulation.Base.html#1649" class="Bound">u</a>    <a id="1654" class="Symbol">=</a> <a id="1656" class="Keyword">record</a> <a id="1663" class="Symbol">{</a> <a id="1665" class="Field">prevTx</a> <a id="1672" class="Symbol">=</a> <a id="1674" href="Bisimulation.Base.html#1433" class="Bound">prevTx</a><a id="1680" class="Symbol">;</a> <a id="1682" class="Field">out</a> <a id="1686" class="Symbol">=</a> <a id="1688" href="Bisimulation.Base.html#1575" class="Bound">out</a><a id="1691" class="Symbol">;</a> <a id="1693" class="Field">outRef</a> <a id="1700" class="Symbol">=</a> <a id="1702" href="Bisimulation.Base.html#1509" class="Bound">oRef</a> <a id="1707" class="Symbol">}</a>
      <a id="1715" class="Keyword">in</a> <a id="1718" class="Symbol">(</a> <a id="1720" href="Bisimulation.Base.html#1649" class="Bound">u</a> <a id="1722" href="Prelude.Membership.html#428" class="Field Operator">∈</a> <a id="1724" href="UTxO.TxUtilities.html#837" class="Function">utxo</a> <a id="1729" href="Bisimulation.Base.html#1382" class="Bound">l</a>
         <a id="1740" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="1742" href="Bisimulation.Base.html#1433" class="Bound">prevTx</a> <a id="1749" href="Prelude.Membership.html#428" class="Field Operator">∈</a> <a id="1751" href="Bisimulation.Base.html#1382" class="Bound">l</a>
         <a id="1762" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="1764" href="Bisimulation.Base.html#1509" class="Bound">oRef</a> <a id="1769" href="Prelude.Membership.html#428" class="Field Operator">∈</a> <a id="1771" href="Data.List.Base.html#1553" class="Function">map</a> <a id="1775" href="UTxO.TxUtilities.html#572" class="Field">outRef</a> <a id="1782" class="Symbol">(</a><a id="1783" href="UTxO.TxUtilities.html#837" class="Function">utxo</a> <a id="1788" href="Bisimulation.Base.html#1382" class="Bound">l</a><a id="1789" class="Symbol">)</a>
         <a id="1800" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="1802" class="Symbol">(</a><a id="1803" href="UTxO.TxUtilities.html#4888" class="Function">getSpentOutputRef</a> <a id="1821" href="Bisimulation.Base.html#1382" class="Bound">l</a> <a id="1823" href="Bisimulation.Base.html#1509" class="Bound">oRef</a> <a id="1828" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1830" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="1835" href="Bisimulation.Base.html#1575" class="Bound">out</a><a id="1838" class="Symbol">)</a>
         <a id="1849" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="1851" class="Symbol">((</a><a id="1853" href="Bisimulation.Base.html#1446" class="Bound">v</a> <a id="1855" href="UTxO.Value.html#2341" class="Function Operator">≥ᶜ</a> <a id="1858" href="StateMachine.Base.html#3185" class="Function">threadₛₘ</a><a id="1866" class="Symbol">)</a> <a id="1868" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1870" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="1874" class="Symbol">)</a>
         <a id="1885" class="Symbol">)</a>
<a id="1887" href="Bisimulation.Base.html#1370" class="Function">view-~</a> <a id="1894" class="Symbol">{</a><a id="1895" href="Bisimulation.Base.html#1895" class="Bound">l</a><a id="1896" class="Symbol">}</a> <a id="1898" class="Symbol">{</a><a id="1899" href="Bisimulation.Base.html#1899" class="Bound">s</a><a id="1900" class="Symbol">}</a> <a id="1902" href="Bisimulation.Base.html#1902" class="Bound">vl~s</a>
  <a id="1909" class="Keyword">with</a> <a id="1914" href="Data.List.Membership.Propositional.Properties.html#3491" class="Function">∈-map⁻</a> <a id="1921" class="Symbol">(</a><a id="1922" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="1932" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1934" href="UTxO.TxUtilities.html#599" class="Field">out</a><a id="1937" class="Symbol">)</a> <a id="1939" href="Bisimulation.Base.html#1902" class="Bound">vl~s</a>
<a id="1944" class="Symbol">...</a> <a id="1948" class="Symbol">|</a> <a id="1950" href="Bisimulation.Base.html#1950" class="Bound">u</a><a id="1951" class="Symbol">@(</a><a id="1953" class="Keyword">record</a> <a id="1960" class="Symbol">{</a><a id="1961" href="UTxO.TxUtilities.html#623" class="Field">prevTx</a> <a id="1968" class="Symbol">=</a> <a id="1970" href="Bisimulation.Base.html#1970" class="Bound">prevTx</a><a id="1976" class="Symbol">;</a> <a id="1978" href="UTxO.TxUtilities.html#599" class="Field">out</a> <a id="1982" class="Symbol">=</a> <a id="1984" class="Keyword">record</a> <a id="1991" class="Symbol">{</a><a id="1992" href="UTxO.Types.html#4906" class="Field">value</a> <a id="1998" class="Symbol">=</a> <a id="2000" href="Bisimulation.Base.html#2000" class="Bound">v</a><a id="2001" class="Symbol">}})</a> <a id="2005" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2007" href="Bisimulation.Base.html#2007" class="Bound">out∈</a> <a id="2012" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2014" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>
  <a id="2021" class="Keyword">with</a> <a id="2026" href="Data.List.Membership.Propositional.Properties.html#8622" class="Function">∈-filter⁻</a> <a id="2036" class="Symbol">((</a><a id="2038" href="Prelude.DecEq.Core.html#190" class="Field Operator">_≟</a> <a id="2041" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="2045" class="Symbol">)</a> <a id="2047" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2049" class="Symbol">(</a><a id="2050" href="UTxO.Value.html#2341" class="Function Operator">_≥ᶜ</a> <a id="2054" href="StateMachine.Base.html#3185" class="Function">threadₛₘ</a><a id="2062" class="Symbol">)</a> <a id="2064" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2066" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2072" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2074" href="UTxO.TxUtilities.html#599" class="Field">out</a><a id="2077" class="Symbol">)</a> <a id="2079" class="Symbol">{</a><a id="2080" class="Argument">xs</a> <a id="2083" class="Symbol">=</a> <a id="2085" href="Data.List.Base.html#8101" class="Function">filter</a> <a id="2092" class="Symbol">_</a> <a id="2094" class="Symbol">(</a><a id="2095" href="UTxO.TxUtilities.html#837" class="Function">utxo</a> <a id="2100" class="Bound">l</a><a id="2101" class="Symbol">)}</a> <a id="2104" href="Bisimulation.Base.html#2007" class="Bound">out∈</a>
<a id="2109" class="Symbol">...</a> <a id="2113" class="Symbol">|</a> <a id="2115" href="Bisimulation.Base.html#2115" class="Bound">u∈′</a> <a id="2119" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2121" href="Bisimulation.Base.html#2121" class="Bound">threadToken≡</a>
  <a id="2136" class="Keyword">with</a> <a id="2141" href="Data.List.Membership.Propositional.Properties.html#8622" class="Function">∈-filter⁻</a> <a id="2151" class="Symbol">((</a><a id="2153" href="StateMachine.Base.html#3741" class="Function">𝕍</a> <a id="2155" href="Prelude.DecEq.Core.html#190" class="Field Operator">≟_</a><a id="2157" class="Symbol">)</a> <a id="2159" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2161" href="UTxO.Types.html#4847" class="Field">address</a> <a id="2169" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2171" href="UTxO.TxUtilities.html#599" class="Field">out</a><a id="2174" class="Symbol">)</a> <a id="2176" class="Symbol">{</a><a id="2177" class="Argument">xs</a> <a id="2180" class="Symbol">=</a> <a id="2182" href="UTxO.TxUtilities.html#837" class="Function">utxo</a> <a id="2187" class="Bound">l</a><a id="2188" class="Symbol">}</a> <a id="2190" href="Bisimulation.Base.html#2115" class="Bound">u∈′</a>
<a id="2194" class="Symbol">...</a> <a id="2198" class="Symbol">|</a> <a id="2200" href="Bisimulation.Base.html#2200" class="Bound">u∈</a> <a id="2203" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2205" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>
  <a id="2212" class="Keyword">with</a> <a id="2217" href="UTxO.TxUtilities.html#2014" class="Function">∈utxo⇒outRef≡</a> <a id="2231" class="Symbol">{</a><a id="2232" class="Argument">u</a> <a id="2234" class="Symbol">=</a> <a id="2236" class="Bound">u</a><a id="2237" class="Symbol">}</a> <a id="2239" class="Symbol">{</a><a id="2240" class="Argument">l</a> <a id="2242" class="Symbol">=</a> <a id="2244" class="Bound">l</a><a id="2245" class="Symbol">}</a> <a id="2247" href="Bisimulation.Base.html#2200" class="Bound">u∈</a>
<a id="2250" class="Symbol">...</a> <a id="2254" class="Symbol">|</a> <a id="2256" href="Bisimulation.Base.html#2256" class="Bound">prev∈</a> <a id="2262" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2264" href="Bisimulation.Base.html#2264" class="Bound">prevOut∈</a> <a id="2273" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2275" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>
    <a id="2284" class="Symbol">=</a> <a id="2286" class="Bound">prevTx</a> <a id="2293" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2295" class="Bound">v</a> <a id="2297" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2299" href="Bisimulation.Base.html#2264" class="Bound">prevOut∈</a> <a id="2308" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2310" class="Bound">u∈</a> <a id="2313" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2315" href="Bisimulation.Base.html#2256" class="Bound">prev∈</a> <a id="2321" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2323" href="Data.List.Membership.Propositional.Properties.html#3377" class="Function">∈-map⁺</a> <a id="2330" href="UTxO.TxUtilities.html#572" class="Field">outRef</a> <a id="2337" class="Bound">u∈</a> <a id="2340" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2342" href="Bisimulation.Base.html#2571" class="Function">spent≡</a> <a id="2349" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2351" class="Bound">threadToken≡</a>
  <a id="2366" class="Keyword">where</a>
    <a id="2376" href="Bisimulation.Base.html#2376" class="Function">oRef</a> <a id="2381" class="Symbol">=</a> <a id="2383" class="Symbol">(</a><a id="2384" class="Bound">prevTx</a> <a id="2391" href="UTxO.Hashing.Types.html#1170" class="Function Operator">♯ₜₓ</a><a id="2394" class="Symbol">)</a> <a id="2396" href="UTxO.Types.html#4242" class="InductiveConstructor Operator">indexed-at</a> <a id="2407" href="Prelude.ToN.html#139" class="Field">toℕ</a> <a id="2411" class="Symbol">(</a><a id="2412" href="Data.List.Relation.Unary.Any.html#1826" class="Function">L.Any.index</a> <a id="2424" href="Bisimulation.Base.html#2264" class="Bound">prevOut∈</a><a id="2432" class="Symbol">)</a>
    <a id="2438" href="Bisimulation.Base.html#2438" class="Function">o</a>    <a id="2443" class="Symbol">=</a> <a id="2445" class="Keyword">record</a> <a id="2452" class="Symbol">{</a> <a id="2454" href="UTxO.Types.html#4847" class="Field">address</a> <a id="2462" class="Symbol">=</a> <a id="2464" href="StateMachine.Base.html#3741" class="Function">𝕍</a><a id="2465" class="Symbol">;</a> <a id="2467" href="UTxO.Types.html#4928" class="Field">datumHash</a> <a id="2477" class="Symbol">=</a> <a id="2479" href="UTxO.Types.html#1196" class="Field">toData</a> <a id="2486" class="Bound">s</a> <a id="2488" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a><a id="2490" class="Symbol">;</a> <a id="2492" href="UTxO.Types.html#4906" class="Field">value</a> <a id="2498" class="Symbol">=</a> <a id="2500" class="Bound">v</a> <a id="2502" class="Symbol">}</a>
    <a id="2508" href="Bisimulation.Base.html#2508" class="Function">u′</a>   <a id="2513" class="Symbol">=</a> <a id="2515" class="Keyword">record</a> <a id="2522" class="Symbol">{</a> <a id="2524" href="UTxO.TxUtilities.html#623" class="Field">prevTx</a> <a id="2531" class="Symbol">=</a> <a id="2533" class="Bound">prevTx</a><a id="2539" class="Symbol">;</a> <a id="2541" href="UTxO.TxUtilities.html#599" class="Field">out</a> <a id="2545" class="Symbol">=</a> <a id="2547" href="Bisimulation.Base.html#2438" class="Function">o</a><a id="2548" class="Symbol">;</a> <a id="2550" href="UTxO.TxUtilities.html#572" class="Field">outRef</a> <a id="2557" class="Symbol">=</a> <a id="2559" href="Bisimulation.Base.html#2376" class="Function">oRef</a> <a id="2564" class="Symbol">}</a>

    <a id="2571" href="Bisimulation.Base.html#2571" class="Function">spent≡</a> <a id="2578" class="Symbol">:</a> <a id="2580" href="UTxO.TxUtilities.html#4888" class="Function">getSpentOutputRef</a> <a id="2598" class="Bound">l</a> <a id="2600" href="Bisimulation.Base.html#2376" class="Function">oRef</a> <a id="2605" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="2607" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="2612" href="Bisimulation.Base.html#2438" class="Function">o</a>
    <a id="2618" href="Bisimulation.Base.html#2571" class="Function">spent≡</a> <a id="2625" class="Symbol">=</a> <a id="2627" href="UTxO.TxUtilities.html#5128" class="Function">utxo-getSpent</a> <a id="2641" class="Symbol">{</a><a id="2642" class="Argument">l</a> <a id="2644" class="Symbol">=</a> <a id="2646" class="Bound">l</a><a id="2647" class="Symbol">}</a> <a id="2649" class="Symbol">{</a><a id="2650" class="Argument">u</a> <a id="2652" class="Symbol">=</a> <a id="2654" href="Bisimulation.Base.html#2508" class="Function">u′</a><a id="2656" class="Symbol">}</a> <a id="2658" class="Bound">u∈</a>

<a id="Satisfiable"></a><a id="2662" href="Bisimulation.Base.html#2662" class="Function">Satisfiable</a> <a id="2674" class="Symbol">:</a> <a id="2676" class="Symbol">∀</a> <a id="2678" class="Symbol">{</a><a id="2679" href="Bisimulation.Base.html#2679" class="Bound">s</a> <a id="2681" href="Bisimulation.Base.html#2681" class="Bound">l</a><a id="2682" class="Symbol">}</a> <a id="2684" class="Symbol">{</a><a id="2685" href="Bisimulation.Base.html#2685" class="Bound">vl</a> <a id="2688" class="Symbol">:</a> <a id="2690" href="UTxO.Validity.html#2261" class="Datatype">ValidLedger</a> <a id="2702" href="Bisimulation.Base.html#2681" class="Bound">l</a><a id="2703" class="Symbol">}</a>
  <a id="2707" class="Symbol">→</a> <a id="2709" href="StateMachine.Base.html#1178" class="Record">TxConstraints</a>
  <a id="2725" class="Symbol">→</a> <a id="2727" href="Bisimulation.Base.html#2685" class="Bound">vl</a> <a id="2730" href="Bisimulation.Base.html#835" class="Function Operator">~</a> <a id="2732" href="Bisimulation.Base.html#2679" class="Bound">s</a>
  <a id="2736" class="Symbol">→</a> <a id="2738" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="2742" href="Bisimulation.Base.html#2662" class="Function">Satisfiable</a> <a id="2754" class="Symbol">{</a><a id="2755" class="Argument">l</a> <a id="2757" class="Symbol">=</a> <a id="2759" href="Bisimulation.Base.html#2759" class="Bound">l</a><a id="2760" class="Symbol">}</a> <a id="2762" class="Symbol">{</a><a id="2763" href="Bisimulation.Base.html#2763" class="Bound">vl</a><a id="2765" class="Symbol">}</a> <a id="2767" href="Bisimulation.Base.html#2767" class="Bound">tx≡</a> <a id="2771" href="Bisimulation.Base.html#2771" class="Bound">vl~s</a>
  <a id="2778" class="Keyword">with</a> <a id="2783" href="Bisimulation.Base.html#1370" class="Function">view-~</a> <a id="2790" class="Symbol">{</a><a id="2791" class="Argument">vl</a> <a id="2794" class="Symbol">=</a> <a id="2796" href="Bisimulation.Base.html#2763" class="Bound">vl</a><a id="2798" class="Symbol">}</a> <a id="2800" href="Bisimulation.Base.html#2771" class="Bound">vl~s</a>
<a id="2805" class="Symbol">...</a> <a id="2809" class="Symbol">|</a> <a id="2811" class="Symbol">_</a> <a id="2813" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2815" href="Bisimulation.Base.html#2815" class="Bound">v</a> <a id="2817" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2819" class="Symbol">_</a>
    <a id="2825" class="Symbol">=</a> <a id="2827" class="Symbol">(</a><a id="2828" href="StateMachine.Base.html#1242" class="Field">range≡</a> <a id="2835" class="Bound">tx≡</a> <a id="2839" href="StateMachine.Base.html#1474" class="Function Operator">&gt;&gt;=ₜ</a> <a id="2844" class="Symbol">(</a><a id="2845" href="UTxO.Types.html#3851" class="Function Operator">_∋</a> <a id="2848" href="Data.List.Base.html#4873" class="Function">length</a> <a id="2855" class="Bound">l</a><a id="2856" class="Symbol">)</a> <a id="2858" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="2860" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="2864" class="Symbol">)</a>
    <a id="2870" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="2872" class="Symbol">(</a><a id="2873" href="StateMachine.Base.html#1271" class="Field">spent≥</a> <a id="2880" class="Bound">tx≡</a> <a id="2884" href="StateMachine.Base.html#1474" class="Function Operator">&gt;&gt;=ₜ</a> <a id="2889" class="Symbol">(</a><a id="2890" href="Bisimulation.Base.html#2815" class="Bound">v</a> <a id="2892" href="UTxO.Value.html#2341" class="Function Operator">≥ᶜ_</a><a id="2895" class="Symbol">)</a> <a id="2897" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="2899" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="2903" class="Symbol">)</a>
    <a id="2909" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="2911" class="Symbol">(∀</a> <a id="2914" href="Bisimulation.Base.html#2914" class="Bound">tx</a> <a id="2917" class="Symbol">→</a>
        <a id="2927" href="Data.List.Relation.Unary.All.html#1453" class="Datatype">All</a> <a id="2931" class="Symbol">{</a><a id="2932" class="Argument">A</a> <a id="2934" class="Symbol">=</a> <a id="2936" href="UTxO.Types.html#7180" class="Function">MonetaryPolicy</a><a id="2950" class="Symbol">}</a>
            <a id="2964" class="Symbol">(λ</a> <a id="2967" href="Bisimulation.Base.html#2967" class="Bound">f</a> <a id="2969" class="Symbol">→</a> <a id="2971" href="Data.Bool.Base.html#1460" class="Function">T</a> <a id="2973" class="Symbol">(</a><a id="2974" href="Bisimulation.Base.html#2967" class="Bound">f</a> <a id="2976" class="Symbol">(</a><a id="2977" href="UTxO.TxUtilities.html#6321" class="Function">toPendingMPS</a> <a id="2990" class="Bound">l</a> <a id="2992" href="Bisimulation.Base.html#2914" class="Bound">tx</a> <a id="2995" class="Symbol">(</a><a id="2996" href="Bisimulation.Base.html#2967" class="Bound">f</a> <a id="2998" href="UTxO.Hashing.Base.html#1199" class="Postulate Operator">♯</a><a id="2999" class="Symbol">))))</a>
            <a id="3016" class="Symbol">(</a><a id="3017" href="Data.Maybe.Base.html#1371" class="Function">maybe</a> <a id="3023" class="Symbol">(</a><a id="3024" href="Data.List.Base.html#1553" class="Function">map</a> <a id="3028" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a><a id="3033" class="Symbol">)</a> <a id="3035" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="3038" class="Symbol">(</a><a id="3039" href="StateMachine.Base.html#1216" class="Field">forge≡</a> <a id="3046" class="Bound">tx≡</a><a id="3049" class="Symbol">)))</a>

<a id="mkTx"></a><a id="3054" href="Bisimulation.Base.html#3054" class="Function">mkTx</a> <a id="3059" class="Symbol">:</a> <a id="3061" class="Symbol">∀</a> <a id="3063" class="Symbol">{</a><a id="3064" href="Bisimulation.Base.html#3064" class="Bound">l</a><a id="3065" class="Symbol">}</a> <a id="3067" class="Symbol">{</a><a id="3068" href="Bisimulation.Base.html#3068" class="Bound">s</a> <a id="3070" href="Bisimulation.Base.html#3070" class="Bound">s′</a> <a id="3073" class="Symbol">:</a> <a id="3075" href="Bisimulation.Base.html#480" class="Bound">S</a><a id="3076" class="Symbol">}</a> <a id="3078" class="Symbol">{</a><a id="3079" href="Bisimulation.Base.html#3079" class="Bound">i</a> <a id="3081" class="Symbol">:</a> <a id="3083" href="Bisimulation.Base.html#482" class="Bound">I</a><a id="3084" class="Symbol">}</a> <a id="3086" class="Symbol">{</a><a id="3087" href="Bisimulation.Base.html#3087" class="Bound">vl</a> <a id="3090" class="Symbol">:</a> <a id="3092" href="UTxO.Validity.html#2261" class="Datatype">ValidLedger</a> <a id="3104" href="Bisimulation.Base.html#3064" class="Bound">l</a><a id="3105" class="Symbol">}</a> <a id="3107" class="Symbol">{</a><a id="3108" href="Bisimulation.Base.html#3108" class="Bound">vl~s</a> <a id="3113" class="Symbol">:</a> <a id="3115" href="Bisimulation.Base.html#3087" class="Bound">vl</a> <a id="3118" href="Bisimulation.Base.html#835" class="Function Operator">~</a> <a id="3120" href="Bisimulation.Base.html#3068" class="Bound">s</a><a id="3121" class="Symbol">}</a>
  <a id="3125" class="Symbol">→</a> <a id="3127" class="Symbol">(</a><a id="3128" href="Bisimulation.Base.html#3128" class="Bound">tx≡</a> <a id="3132" class="Symbol">:</a> <a id="3134" href="StateMachine.Base.html#1178" class="Record">TxConstraints</a><a id="3147" class="Symbol">)</a>
  <a id="3151" class="Symbol">→</a> <a id="3153" href="Bisimulation.Base.html#2662" class="Function">Satisfiable</a> <a id="3165" class="Symbol">{</a><a id="3166" class="Argument">vl</a> <a id="3169" class="Symbol">=</a> <a id="3171" href="Bisimulation.Base.html#3087" class="Bound">vl</a><a id="3173" class="Symbol">}</a> <a id="3175" href="Bisimulation.Base.html#3128" class="Bound">tx≡</a> <a id="3179" href="Bisimulation.Base.html#3108" class="Bound">vl~s</a>
  <a id="3186" class="Symbol">→</a> <a id="3188" href="Data.Product.html#925" class="Function">Σ[</a> <a id="3191" href="Bisimulation.Base.html#3191" class="Bound">tx</a> <a id="3194" href="Data.Product.html#925" class="Function">∈</a> <a id="3196" href="UTxO.Types.html#7568" class="Record">Tx</a> <a id="3199" href="Data.Product.html#925" class="Function">]</a> <a id="3201" class="Symbol">(</a><a id="3202" href="StateMachine.Base.html#1796" class="Function">verifyTx</a> <a id="3211" href="Bisimulation.Base.html#3064" class="Bound">l</a> <a id="3213" href="Bisimulation.Base.html#3191" class="Bound">tx</a> <a id="3216" href="Bisimulation.Base.html#3128" class="Bound">tx≡</a> <a id="3220" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="3222" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="3226" class="Symbol">)</a>
<a id="3228" href="Bisimulation.Base.html#3054" class="Function">mkTx</a> <a id="3233" class="Symbol">{</a><a id="3234" href="Bisimulation.Base.html#3234" class="Bound">l</a><a id="3235" class="Symbol">}</a> <a id="3237" class="Symbol">{</a><a id="3238" href="Bisimulation.Base.html#3238" class="Bound">s</a><a id="3239" class="Symbol">}</a> <a id="3241" class="Symbol">{</a><a id="3242" href="Bisimulation.Base.html#3242" class="Bound">s′</a><a id="3244" class="Symbol">}</a> <a id="3246" class="Symbol">{</a><a id="3247" href="Bisimulation.Base.html#3247" class="Bound">i</a><a id="3248" class="Symbol">}</a> <a id="3250" class="Symbol">{</a><a id="3251" href="Bisimulation.Base.html#3251" class="Bound">vl</a><a id="3253" class="Symbol">}</a> <a id="3255" class="Symbol">{</a><a id="3256" href="Bisimulation.Base.html#3256" class="Bound">vl~s</a><a id="3260" class="Symbol">}</a> <a id="3262" href="Bisimulation.Base.html#3262" class="Bound">tx≡</a> <a id="3266" class="Symbol">(</a><a id="3267" href="Bisimulation.Base.html#3267" class="Bound">r≡</a> <a id="3270" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3272" href="Bisimulation.Base.html#3272" class="Bound">s≥</a> <a id="3275" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3277" class="Symbol">_)</a>
  <a id="3282" class="Keyword">with</a> <a id="3287" href="Bisimulation.Base.html#1370" class="Function">view-~</a> <a id="3294" class="Symbol">{</a><a id="3295" class="Argument">vl</a> <a id="3298" class="Symbol">=</a> <a id="3300" href="Bisimulation.Base.html#3251" class="Bound">vl</a><a id="3302" class="Symbol">}</a> <a id="3304" href="Bisimulation.Base.html#3256" class="Bound">vl~s</a>
<a id="3309" class="Symbol">...</a> <a id="3313" class="Symbol">|</a> <a id="3315" href="Bisimulation.Base.html#3315" class="Bound">prevTx</a> <a id="3322" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3324" href="Bisimulation.Base.html#3324" class="Bound">v</a> <a id="3326" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3328" href="Bisimulation.Base.html#3328" class="Bound">prevOut∈</a> <a id="3337" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3339" class="Symbol">_</a> <a id="3341" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3343" class="Symbol">_</a> <a id="3345" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3347" class="Symbol">_</a> <a id="3349" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3351" href="Bisimulation.Base.html#3351" class="Bound">getSpent≡</a> <a id="3361" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3363" class="Symbol">_</a>
    <a id="3369" class="Symbol">=</a> <a id="3371" href="Bisimulation.Base.html#3610" class="Function">tx</a> <a id="3374" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3376" href="Bisimulation.Base.html#4490" class="Function">verify≡</a>
    <a id="3388" class="Keyword">where</a>
      <a id="3400" href="Bisimulation.Base.html#3400" class="Function">frg</a> <a id="3404" class="Symbol">=</a> <a id="3406" href="Data.Maybe.Base.html#1371" class="Function">maybe</a> <a id="3412" href="UTxO.Types.html#7359" class="Function">toValue</a> <a id="3420" href="UTxO.Value.html#1156" class="Function">$0</a> <a id="3423" class="Symbol">(</a><a id="3424" href="StateMachine.Base.html#1216" class="Field">forge≡</a> <a id="3431" class="Bound">tx≡</a><a id="3434" class="Symbol">)</a>
      <a id="3442" href="Bisimulation.Base.html#3442" class="Function">rng</a> <a id="3446" class="Symbol">=</a> <a id="3448" href="Data.Maybe.Base.html#1641" class="Function">M.fromMaybe</a> <a id="3460" class="Symbol">(</a><a id="3461" href="UTxO.Types.html#3488" class="InductiveConstructor">-∞</a> <a id="3464" href="UTxO.Types.html#3624" class="InductiveConstructor Operator">⋯</a> <a id="3466" href="UTxO.Types.html#3491" class="InductiveConstructor">+∞</a><a id="3468" class="Symbol">)</a> <a id="3470" class="Symbol">(</a><a id="3471" href="StateMachine.Base.html#1242" class="Field">range≡</a> <a id="3478" class="Bound">tx≡</a><a id="3481" class="Symbol">)</a>
      <a id="3489" href="Bisimulation.Base.html#3489" class="Function">plc</a> <a id="3493" class="Symbol">=</a> <a id="3495" href="Data.Maybe.Base.html#1371" class="Function">maybe</a> <a id="3501" class="Symbol">(</a><a id="3502" href="Data.List.Base.html#1553" class="Function">map</a> <a id="3506" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a><a id="3511" class="Symbol">)</a> <a id="3513" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="3516" class="Symbol">(</a><a id="3517" href="StateMachine.Base.html#1216" class="Field">forge≡</a> <a id="3524" class="Bound">tx≡</a><a id="3527" class="Symbol">)</a>

      <a id="3536" href="Bisimulation.Base.html#3536" class="Function">i₀</a> <a id="3539" class="Symbol">=</a> <a id="3541" class="Symbol">(</a><a id="3542" href="Bisimulation.Base.html#3315" class="Bound">prevTx</a> <a id="3549" href="UTxO.Hashing.Types.html#1170" class="Function Operator">♯ₜₓ</a><a id="3552" class="Symbol">)</a> <a id="3554" href="UTxO.Types.html#4242" class="InductiveConstructor Operator">indexed-at</a> <a id="3565" href="Prelude.ToN.html#139" class="Field">toℕ</a> <a id="3569" class="Symbol">(</a><a id="3570" href="Data.List.Relation.Unary.Any.html#1826" class="Function">L.Any.index</a> <a id="3582" href="Bisimulation.Base.html#3328" class="Bound">prevOut∈</a><a id="3590" class="Symbol">)</a> <a id="3592" href="StateMachine.Base.html#3825" class="Function Operator">←—</a> <a id="3595" class="Symbol">(</a><a id="3596" class="Bound">i</a> <a id="3598" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3600" class="Bound">s</a><a id="3601" class="Symbol">)</a>

      <a id="3610" href="Bisimulation.Base.html#3610" class="Function">tx</a> <a id="3613" class="Symbol">=</a> <a id="3615" class="Keyword">record</a> <a id="3622" class="Symbol">{</a> <a id="3624" href="UTxO.Types.html#7595" class="Field">inputs</a>   <a id="3633" class="Symbol">=</a> <a id="3635" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="3637" href="Bisimulation.Base.html#3536" class="Function">i₀</a> <a id="3640" href="Data.List.Base.html#5034" class="Function Operator">]</a>
                  <a id="3660" class="Symbol">;</a> <a id="3662" href="UTxO.Types.html#7700" class="Field">outputs</a>  <a id="3671" class="Symbol">=</a> <a id="3673" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="3675" class="Bound">s′</a> <a id="3678" href="StateMachine.Base.html#4062" class="Function Operator">—→</a> <a id="3681" class="Symbol">(</a><a id="3682" href="Bisimulation.Base.html#3400" class="Function">frg</a> <a id="3686" href="UTxO.Value.html#2000" class="Function Operator">+ᶜ</a> <a id="3689" href="Bisimulation.Base.html#3324" class="Bound">v</a><a id="3690" class="Symbol">)</a> <a id="3692" href="Data.List.Base.html#5034" class="Function Operator">]</a>
                  <a id="3712" class="Symbol">;</a> <a id="3714" href="UTxO.Types.html#7762" class="Field">policies</a> <a id="3723" class="Symbol">=</a> <a id="3725" href="Bisimulation.Base.html#3489" class="Function">plc</a>
                  <a id="3747" class="Symbol">;</a> <a id="3749" href="UTxO.Types.html#7735" class="Field">forge</a>    <a id="3758" class="Symbol">=</a> <a id="3760" href="Bisimulation.Base.html#3400" class="Function">frg</a>
                  <a id="3782" class="Symbol">;</a> <a id="3784" href="UTxO.Types.html#7803" class="Field">range</a>    <a id="3793" class="Symbol">=</a> <a id="3795" href="Bisimulation.Base.html#3442" class="Function">rng</a>
                  <a id="3817" class="Symbol">;</a> <a id="3819" href="UTxO.Types.html#7834" class="Field">datumWitnesses</a> <a id="3834" class="Symbol">=</a> <a id="3836" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="3838" href="UTxO.Types.html#1196" class="Field">toData</a> <a id="3845" class="Bound">s′</a> <a id="3848" href="UTxO.Hashing.Types.html#593" class="Function Operator">♯ᵈ</a> <a id="3851" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3853" href="UTxO.Types.html#1196" class="Field">toData</a> <a id="3860" class="Bound">s′</a> <a id="3863" href="Data.List.Base.html#5034" class="Function Operator">]</a> <a id="3865" class="Symbol">}</a>

      <a id="3874" href="Bisimulation.Base.html#3874" class="Function">txi</a> <a id="3878" class="Symbol">=</a> <a id="3880" href="UTxO.TxUtilities.html#5856" class="Function">mkTxInfo</a> <a id="3889" class="Bound">l</a> <a id="3891" href="Bisimulation.Base.html#3610" class="Function">tx</a>

      <a id="3901" href="Bisimulation.Base.html#3901" class="Function">frgT</a> <a id="3906" class="Symbol">:</a> <a id="3908" class="Symbol">(</a><a id="3909" href="StateMachine.Base.html#1216" class="Field">forge≡</a> <a id="3916" class="Bound">tx≡</a> <a id="3920" href="StateMachine.Base.html#1474" class="Function Operator">&gt;&gt;=ₜ</a> <a id="3925" class="Symbol">λ</a> <a id="3927" href="Bisimulation.Base.html#3927" class="Bound">v</a> <a id="3929" class="Symbol">→</a> <a id="3931" href="Relation.Nullary.Decidable.Core.html#1321" class="Function Operator">⌊</a> <a id="3933" href="UTxO.Types.html#5172" class="Field">TxInfo.forge</a> <a id="3946" href="Bisimulation.Base.html#3874" class="Function">txi</a> <a id="3950" href="Prelude.DecEq.Core.html#190" class="Field Operator">≟</a> <a id="3952" href="UTxO.Types.html#7359" class="Function">toValue</a> <a id="3960" href="Bisimulation.Base.html#3927" class="Bound">v</a> <a id="3962" href="Relation.Nullary.Decidable.Core.html#1321" class="Function Operator">⌋</a><a id="3963" class="Symbol">)</a> <a id="3965" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="3967" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
      <a id="3978" href="Bisimulation.Base.html#3901" class="Function">frgT</a> <a id="3983" class="Keyword">with</a> <a id="3988" href="StateMachine.Base.html#1216" class="Field">forge≡</a> <a id="3995" class="Bound">tx≡</a>
      <a id="4005" href="Bisimulation.Base.html#3901" class="Function">...</a> <a id="4009" class="Symbol">|</a> <a id="4011" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="4019" class="Symbol">=</a> <a id="4021" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>
      <a id="4032" href="Bisimulation.Base.html#3901" class="Function">...</a> <a id="4036" class="Symbol">|</a> <a id="4038" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="4043" href="Bisimulation.Base.html#4043" class="Bound">v</a>  <a id="4046" class="Keyword">rewrite</a> <a id="4054" href="Prelude.DecEq.WithK.html#170" class="Function">≟-refl</a> <a id="4061" class="Symbol">(</a><a id="4062" href="UTxO.Types.html#7359" class="Function">toValue</a> <a id="4070" href="Bisimulation.Base.html#4043" class="Bound">v</a><a id="4071" class="Symbol">)</a> <a id="4073" class="Symbol">=</a> <a id="4075" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>

      <a id="4087" href="Bisimulation.Base.html#4087" class="Function">rngT</a> <a id="4092" class="Symbol">:</a> <a id="4094" class="Symbol">(</a><a id="4095" href="StateMachine.Base.html#1242" class="Field">range≡</a> <a id="4102" class="Bound">tx≡</a> <a id="4106" href="StateMachine.Base.html#1474" class="Function Operator">&gt;&gt;=ₜ</a> <a id="4111" class="Symbol">λ</a> <a id="4113" href="Bisimulation.Base.html#4113" class="Bound">r</a> <a id="4115" class="Symbol">→</a> <a id="4117" href="Relation.Nullary.Decidable.Core.html#1321" class="Function Operator">⌊</a> <a id="4119" href="UTxO.Types.html#5240" class="Field">TxInfo.range</a> <a id="4132" href="Bisimulation.Base.html#3874" class="Function">txi</a> <a id="4136" href="Prelude.DecEq.Core.html#190" class="Field Operator">≟</a> <a id="4138" href="Bisimulation.Base.html#4113" class="Bound">r</a> <a id="4140" href="Relation.Nullary.Decidable.Core.html#1321" class="Function Operator">⌋</a><a id="4141" class="Symbol">)</a> <a id="4143" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4145" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
      <a id="4156" href="Bisimulation.Base.html#4087" class="Function">rngT</a> <a id="4161" class="Keyword">with</a> <a id="4166" href="StateMachine.Base.html#1242" class="Field">range≡</a> <a id="4173" class="Bound">tx≡</a>
      <a id="4183" href="Bisimulation.Base.html#4087" class="Function">...</a> <a id="4187" class="Symbol">|</a> <a id="4189" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="4197" class="Symbol">=</a> <a id="4199" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>
      <a id="4210" href="Bisimulation.Base.html#4087" class="Function">...</a> <a id="4214" class="Symbol">|</a> <a id="4216" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="4221" href="Bisimulation.Base.html#4221" class="Bound">v</a>  <a id="4224" class="Keyword">rewrite</a> <a id="4232" href="Prelude.DecEq.WithK.html#170" class="Function">≟-refl</a> <a id="4239" href="Bisimulation.Base.html#4221" class="Bound">v</a> <a id="4241" class="Symbol">=</a> <a id="4243" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>

      <a id="4255" href="Bisimulation.Base.html#4255" class="Function">v≡</a> <a id="4258" class="Symbol">:</a> <a id="4260" href="UTxO.Types.html#5895" class="Function">valueSpent</a> <a id="4271" href="Bisimulation.Base.html#3874" class="Function">txi</a> <a id="4275" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4277" href="Bisimulation.Base.html#3324" class="Bound">v</a>
      <a id="4285" href="Bisimulation.Base.html#4255" class="Function">v≡</a> <a id="4288" class="Keyword">rewrite</a> <a id="4296" href="UTxO.Value.html#8406" class="Function">sum-single</a> <a id="4307" class="Symbol">{</a><a id="4308" class="Argument">v</a> <a id="4310" class="Symbol">=</a> <a id="4312" href="UTxO.Types.html#4784" class="Field">InputInfo.value</a> <a id="4328" class="Symbol">(</a><a id="4329" href="UTxO.TxUtilities.html#5592" class="Function">mkInputInfo</a> <a id="4341" class="Bound">l</a> <a id="4343" href="Bisimulation.Base.html#3536" class="Function">i₀</a><a id="4345" class="Symbol">)}</a>
               <a id="4363" class="Symbol">|</a> <a id="4365" href="Bisimulation.Base.html#3351" class="Bound">getSpent≡</a>
               <a id="4390" class="Symbol">=</a> <a id="4392" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>

      <a id="4404" href="Bisimulation.Base.html#4404" class="Function">spT</a>  <a id="4409" class="Symbol">:</a> <a id="4411" class="Symbol">(</a><a id="4412" href="StateMachine.Base.html#1271" class="Field">spent≥</a> <a id="4419" class="Bound">tx≡</a> <a id="4423" href="StateMachine.Base.html#1474" class="Function Operator">&gt;&gt;=ₜ</a> <a id="4428" class="Symbol">(</a><a id="4429" href="UTxO.Types.html#5895" class="Function">valueSpent</a> <a id="4440" href="Bisimulation.Base.html#3874" class="Function">txi</a> <a id="4444" href="UTxO.Value.html#2341" class="Function Operator">≥ᶜ_</a><a id="4447" class="Symbol">))</a> <a id="4450" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4452" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
      <a id="4463" href="Bisimulation.Base.html#4404" class="Function">spT</a> <a id="4467" class="Keyword">rewrite</a> <a id="4475" href="Bisimulation.Base.html#4255" class="Function">v≡</a> <a id="4478" class="Symbol">=</a> <a id="4480" class="Bound">s≥</a>

      <a id="4490" href="Bisimulation.Base.html#4490" class="Function">verify≡</a> <a id="4498" class="Symbol">:</a> <a id="4500" href="StateMachine.Base.html#1796" class="Function">verifyTx</a> <a id="4509" class="Bound">l</a> <a id="4511" href="Bisimulation.Base.html#3610" class="Function">tx</a> <a id="4514" class="Bound">tx≡</a> <a id="4518" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4520" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
      <a id="4531" href="Bisimulation.Base.html#4490" class="Function">verify≡</a> <a id="4539" class="Keyword">rewrite</a> <a id="4547" href="Bisimulation.Base.html#3901" class="Function">frgT</a> <a id="4552" class="Symbol">|</a> <a id="4554" href="Bisimulation.Base.html#4087" class="Function">rngT</a> <a id="4559" class="Symbol">|</a> <a id="4561" href="Bisimulation.Base.html#4404" class="Function">spT</a> <a id="4565" class="Symbol">=</a> <a id="4567" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>
</pre></body></html>